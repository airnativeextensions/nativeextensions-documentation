<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="air native extensions Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="air native extensions Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-188619114-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="air native extensions" href="/opensearch.xml"><title data-react-helmet="true">Promotions | air native extensions</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" property="og:url" content="https://docs.airnativeextensions.com/docs/inappbilling/promotions"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Promotions | air native extensions"><meta data-react-helmet="true" name="description" content="With iOS 11, users can browse in-app purchases directly on the App Store and start a purchase even before downloading your app."><meta data-react-helmet="true" property="og:description" content="With iOS 11, users can browse in-app purchases directly on the App Store and start a purchase even before downloading your app."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.airnativeextensions.com/docs/inappbilling/promotions"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/inappbilling/promotions" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/inappbilling/promotions" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f49ec264.css">
<link rel="preload" href="/assets/js/runtime~main.0cf81893.js" as="script">
<link rel="preload" href="/assets/js/main.9f6f4e02.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1boX">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/ane-icon-black.png" alt="AIR Native Extensions" class="themedImage_3oOy themedImage--light_3ouy navbar__logo"><img src="/img/ane-icon-white.png" alt="AIR Native Extensions" class="themedImage_3oOy themedImage--dark_3zJb navbar__logo"><b class="navbar__title">AIR Native Extensions</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/news/">News</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2ySP react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_2iFN"> </span></div><div class="react-toggle-track-x"><span class="toggle_2iFN"> </span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3zOJ"><button class="clean-btn backToTopButton_DkI0" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_G8MK"><div class="sidebar_1tWv"><nav class="menu thin-scrollbar menu_1Iah menuWithAnnouncementBar_3acx"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/inappbilling/">InAppBilling</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/inappbilling/overview">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Billing Services</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Setup the Extension</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/add-the-extension">Add the Extension</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/billing-service">Billing Service</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Usage</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/products">Products</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/make-a-purchase">Make a Purchase</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/pending-purchases">Pending Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/restore-purchases">Restore Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/get-purchases">Get Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/consuming-purchases">Consuming Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/change-a-purchase">Change a Purchase</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/inappbilling/promotions">Promotions</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Subscription Discounts and Offers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inappbilling/testing">Testing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">In-App Updates</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Help</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Advanced</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Other</a></li></ul></nav></div></aside><main class="docMainContainer_3Zec"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2q91"><div class="docItemContainer_37q2"><article><div class="tocCollapsible_3moT tocMobile_2bxg"><button type="button" class="clean-btn tocCollapsibleButton_3OYu">On this page</button></div><div class="markdown"><header><h1>Promotions</h1></header><p>With iOS 11, users can browse in-app purchases directly on the App Store and start a purchase even before downloading your app.
Promoted in-app purchases appear on your product page, can display in search results, and may be featured on the Today, Games, and Apps tabs.</p><p>Promoting in-app purchases can also encourage downloads of your app. When a user doesn’t have your app installed but wants to buy a promoted in-app purchase, they&#x27;ll receive a prompt to download the app first. Once the app is downloaded, the transaction will continue in the app.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="checking-for-support"></a>Checking for Support<a class="hash-link" href="#checking-for-support" title="Direct link to heading">#</a></h2><p>You can use the <code>isSupported</code> flags to check whether the current device (and platform) supports the promotions functionality:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">if (InAppBilling.isSupported)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (InAppBilling.service.promotions.isSupported)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Promotions functionality supported</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="handling-promotion-purchases"></a>Handling Promotion Purchases<a class="hash-link" href="#handling-promotion-purchases" title="Direct link to heading">#</a></h2><p>When a user starts an in-app purchase on the App Store, they are taken into your app to continue the transaction.</p><p>Consider presenting the payment sheet as soon as they are in the app to make the process of completing their purchase as easy as possible. Avoid unnecessary interstitials and messaging, as each extra step you require may decrease the likelihood that the user will complete the purchase.</p><p>Purchases that are initiated in the Store trigger an event in your application which allows you to decide whether to proceed with the purchase.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PurchaseRequestEvent.SHOULD_ADD_PURCHASE, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    shouldAddPurchaseHandler );</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>You then respond to the request by calling the <code>shouldAddPurchase()</code> function, with the <code>request</code> property from the event and a <code>Boolean</code> flag indicating whether the purchase should be started or cancelled.
For example, you may need to cancel a transaction if the user has already unlocked the product they are trying to buy.</p><p>If you respond with <code>true</code> the purchase flow UI will start, similar to if you called <code>makePurchase</code> with a similar purchase request. If you respond <code>false</code> the purchase will be cancelled and no UI will be presented.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">function shouldAddPurchaseHandler( event:PurchaseRequestEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    //</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  Do any checks to see whether this should be added to the queue</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var request:PurchaseRequest = event.request;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var shouldAddPurchaseToQueue:Boolean = true;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    InAppBilling.service.shouldAddPurchase( request, shouldAddPurchaseToQueue );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>You can hold onto the <code>event.request</code> property and call the <code>shouldAddPurchase()</code> function at a later point if you wish to delay the initiation of the purchase until your application is ready to process the purchase.</p><p>For example, you may need to defer a transaction if the user is in the middle of onboarding, and continue it after onboarding is completed.</p><blockquote><p>This delay will not work across application restarts or disposal of the extension.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="application-state"></a>Application State<a class="hash-link" href="#application-state" title="Direct link to heading">#</a></h3><p>If your app is not installed when the user taps or clicks Buy, the App Store automatically downloads the app or prompts the user to buy it. If the installed version of your app is an older version that doesn’t support in-app purchase promotions, the App Store prompts the user to upgrade the app. If your application is not running, the app will be started.</p><p>When your application was not running you won&#x27;t immediately receive the <code>PurchaseRequestEvent.SHOULD_ADD_PURCHASE</code> event. You should start your application normally and add a listener for the event before you call <code>setup()</code> (this is similar to how you should be handling pending purchases with the <code>PurchaseEvent.PURCHASES_UPDATED</code> event).</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PurchaseRequestEvent.SHOULD_ADD_PURCHASE, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    shouldAddPurchaseHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// OTHER EVENT LISTENERS </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.setup(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        new BillingService()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY )</span></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>If your application was started from a promotion purchase you will receive the event after the call to <code>setup()</code> so you should be prepared to handle it at this stage, or at least prepared to store the <code>request</code> until your application is ready.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="ios"></a>iOS<a class="hash-link" href="#ios" title="Direct link to heading">#</a></h3><p>You can open the following link on a device to replicate the promotional purchase (changing the product and bundle ID&#x27;s appropriately):</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB"><pre tabindex="0" class="prism-code language-undefined codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">itms-services://?action=purchaseIntent&amp;bundleId=com.example.app&amp;productIdentifier=com.example.product_id</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>Send this URL to yourself in an email or iMessage and open it from your device. You will know the test is running when your app opens automatically. You can then test your promoted in-app purchase.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="customising-promotions"></a>Customising Promotions<a class="hash-link" href="#customising-promotions" title="Direct link to heading">#</a></h2><p>From your application you can control some aspects of the promotions displayed to your user.
This can be useful to emphasise different promotions as your user progresses through your
application or game, and to hide promotions that are no longer or not yet applicable to your user.</p><p>For example, your user may have to reach a certain level in your game before a certain promotion is available to them.</p><p>The default order and visibility of in-app purchases are set in iTunes Connect. Your overrides are per device, and are not synced to an iCloud account. Note that this feature relies on local device storage, and the API can only run after the app has launched on a device at least once.</p><p>Implementing these advanced features is optional. They are not required for your in-app purchases to appear on the App Store.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="visibility"></a>Visibility<a class="hash-link" href="#visibility" title="Direct link to heading">#</a></h3><p>To get whether a promotion is visible to a user you can use the <code>getStoreVisibility()</code> function with the product id of the promotion. This call will dispatch one of two events:</p><ul><li><code>PromotionsEvent.GET_STORE_VISIBILITY_COMPLETE</code> on success</li><li><code>PromotionsEvent.GET_STORE_VISIBILITY_ERROR</code> on failure</li></ul><p>The visibility property is one of either:</p><ul><li><code>PromotionVisibility.DEFAULT</code></li><li><code>PromotionVisibility.SHOW</code></li><li><code>PromotionVisibility.HIDE</code></li></ul><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.GET_STORE_VISIBILITY_COMPLETE, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    getStoreVisbility_completeHandler);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.GET_STORE_VISIBILITY_ERROR, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    getStoreVisbility_errorHandler);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.getStoreVisibility( &quot;com.example.product_id&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function getStoreVisbility_completeHandler( event:PromotionsEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // event.visibility contains the visibility property</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function getStoreVisbility_errorHandler( event:PromotionsEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // There was an error </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( event.error );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>You can change the visibility by using the <code>updateStoreVisibility()</code> function passing the product id of the promotion and the new visibility value to use</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.UPDATE_STORE_VISIBILITY_COMPLETE,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateStoreVisbility_completeHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.UPDATE_STORE_VISIBILITY_ERROR, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateStoreVisbility_errorHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.updateStoreVisibility( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;com.distriqt.example_id&quot;, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionVisibility.SHOW );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateStoreVisbility_completeHandler( event:PromotionsEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // event.visibility contains the visibility property</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateStoreVisbility_errorHandler( event:PromotionsEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // There was an error </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( event.error );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="display-order-override"></a>Display Order Override<a class="hash-link" href="#display-order-override" title="Direct link to heading">#</a></h3><p>You can override the order of promoted in-app purchases on the App Store product page, per device. For example, you can promote an in-app purchase product that unlocks a specific level in your game when a user reaches the level immediately before the specified level.</p><p>To override the default product order for in-app purchases, put the product identifier for the subset of products you want to reorder into an array, in the order you want them to appear in. Pass the array to the <code>updateStoreOrder</code> function.</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">var productOrder:Array = [ &quot;com.example.product_1&quot;, &quot;com.example.product_2&quot; ];</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.UPDATE_STORE_ORDER_COMPLETE, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateStoreOrder_completeHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.UPDATE_STORE_ORDER_ERROR, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    updateStoreOrder_errorHandler);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.updateStoreOrder( productOrder );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateStoreOrder_completeHandler( event:PromotionsEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    for each (var productId:String in event.productIdOrder)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        trace( &quot;storeOrder: &quot; + productId );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function updateStoreOrder_errorHandler( event:PromotionsEvent ):void </span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // There was an error </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( event.error );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><p>To read a product order override as it will appear on a given device, call the <code>getStoreOrder</code> method. You should receive an array of products whose order is overridden. <strong>If you get an empty array, you have not set any overrides and the products are in the default order.</strong></p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.GET_STORE_ORDER_COMPLETE, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    getStoreOrder_completeHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.addEventListener( </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    PromotionsEvent.GET_STORE_ORDER_ERROR, </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    getStoreOrder_errorHandler);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">InAppBilling.service.promotions.getStoreOrder();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function getStoreOrder_completeHandler( event:PromotionsEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    for each (var productId:String in event.productIdOrder)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        trace( &quot;storeOrder: &quot; + productId );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function getStoreOrder_errorHandler( event:PromotionsEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // There was an error </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( event.error );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="imports"></a>Imports<a class="hash-link" href="#imports" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">import com.distriqt.extension.inappbilling.promotions.Promotions;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.distriqt.extension.inappbilling.promotions.PromotionVisibility;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.distriqt.extension.inappbilling.PurchaseRequest;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.distriqt.extension.inappbilling.events.PromotionsEvent;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.distriqt.extension.inappbilling.events.PurchaseRequestEvent;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/inappbilling/change-a-purchase"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Change a Purchase</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/inappbilling/discounts"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Discounts »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_2pwG thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#checking-for-support" class="table-of-contents__link">Checking for Support</a></li><li><a href="#handling-promotion-purchases" class="table-of-contents__link">Handling Promotion Purchases</a><ul><li><a href="#application-state" class="table-of-contents__link">Application State</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#ios" class="table-of-contents__link">iOS</a></li></ul></li><li><a href="#customising-promotions" class="table-of-contents__link">Customising Promotions</a><ul><li><a href="#visibility" class="table-of-contents__link">Visibility</a></li><li><a href="#display-order-override" class="table-of-contents__link">Display Order Override</a></li></ul></li><li><a href="#imports" class="table-of-contents__link">Imports</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Gamua/Adobe-Runtime-Support/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>AIR discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.starling-framework.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>starling<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>stack overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">news</a></li><li class="footer__item"><a href="https://airnativeextensions.com/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://airnativeextensions.com/license" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>license<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><br><a href="https://airnativeextensions.com">airnativeextensions.com</a> copyright © 2021 <br><br><a href="https://distriqt.com"><img src="/img/logo.png" alt="distriqt"></a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.0cf81893.js"></script>
<script src="/assets/js/main.9f6f4e02.js"></script>
</body>
</html>