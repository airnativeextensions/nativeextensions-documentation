(window.webpackJsonp=window.webpackJsonp||[]).push([[492],{549:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return o})),a.d(n,"metadata",(function(){return d})),a.d(n,"rightToc",(function(){return c})),a.d(n,"default",(function(){return l}));var i=a(2),t=a(6),r=(a(0),a(889)),o={title:"Migrating to v10.2",sidebar_label:"Migrating to v10.2"},d={unversionedId:"pushnotifications/migrating-to-v10.2",id:"pushnotifications/migrating-to-v10.2",isDocsHomePage:!1,title:"Migrating to v10.2",description:"v10.2 brings the latest release of OneSignal:",source:"@site/docs/pushnotifications/migrating-to-v10.2.md",slug:"/pushnotifications/migrating-to-v10.2",permalink:"/docs/pushnotifications/migrating-to-v10.2",version:"current",sidebar_label:"Migrating to v10.2",sidebar:"pushnotifications",previous:{title:"OneSignal",permalink:"/docs/pushnotifications/onesignal/onesignal"},next:{title:"Windows - Add the Extension",permalink:"/docs/pushnotifications/windows/add-the-extension"}},c=[{value:"Payload",id:"payload",children:[]},{value:"Update Dependencies",id:"update-dependencies",children:[]},{value:"Update Manifest Additions",id:"update-manifest-additions",children:[]}],s={rightToc:c};function l(e){var n=e.components,a=Object(t.a)(e,["components"]);return Object(r.b)("wrapper",Object(i.a)({},s,a,{components:n,mdxType:"MDXLayout"}),Object(r.b)("p",null,"v10.2 brings the latest release of OneSignal:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Android v4.1.0"),Object(r.b)("li",{parentName:"ul"},"iOS v3.1.1")),Object(r.b)("p",null,"If you are updating from a version < 10 make sure you check out the changes for Firebase Cloud Messaging as well in the ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"migrating-to-v10.1"}),"Migrating to v10.1")),Object(r.b)("p",null,"We have managed to hide any major implementation changes within the native code however there are some changes to the ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"#update-dependencies"}),"dependencies"),", to the ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"#update-manifest-additions"}),"manifest additions")," and to the ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"#payload"}),"payload data structure"),"."),Object(r.b)("h2",{id:"payload"},"Payload"),Object(r.b)("div",{className:"admonition admonition-caution alert alert--warning"},Object(r.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"}),Object(r.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"})))),"Payload")),Object(r.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"The payload structure has changed due to a change in the data returned by OneSignal for a notification. Rather than reformatting to matching a legacy structure we have taken the approach to return the data as per OneSignal's design."),Object(r.b)("p",{parentName:"div"},"Importantly you will need to update any code you have that relies on the structure of the OneSignal notification payload."))),Object(r.b)("p",null,"For example on Android the previous payload structure was: "),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),'{\n    "isAppInFocus":true,\n    "shown":false,\n    "androidNotificationId":0,\n    "displayType":0,\n    "payload": {\n        "notificationId":"bb5fd966-4ac2-4070-bcec-d66fb0fbab1f",\n        "title":"asdf",\n        "body":"asdfasdf",\n        "additionalData":{\n            \n        },\n        "lockScreenVisibility":1,\n        "actionButtons":[\n            \n            ],\n        "fromProjectNumber":"616489336300",\n        "priority":5,\n        "rawPayload":"{\\"google.delivered_priority\\":\\"normal\\",\\"google.sent_time\\":1612744363074,\\"google.ttl\\":259200,\\"google.original_priority\\":\\"normal\\",\\"custom\\":\\"{\\\\\\"i\\\\\\":\\\\\\"bb5fd966-4ac2-4070-bcec-d66fb0fbab1f\\\\\\",\\\\\\"a\\\\\\":{\\\\\\"actionButtons\\\\\\":[],\\\\\\"actionId\\\\\\":\\\\\\"__DEFAULT__\\\\\\"}}\\",\\"pri\\":\\"5\\",\\"vis\\":\\"1\\",\\"from\\":\\"616489336300\\",\\"alert\\":\\"asdfasdf\\",\\"title\\":\\"asdf\\",\\"google.message_id\\":\\"0:1612744363095757%32d7332ff9fd7ecd\\",\\"google.c.sender.id\\":\\"616489336300\\"}"\n    }\n}\n')),Object(r.b)("p",null,"The new payload structure is:"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),'{\n    "androidNotificationId":0,\n    "groupedNotifications":[\n        \n    ],\n    "notificationId":"bb5fd966-4ac2-4070-bcec-d66fb0fbab1f",\n    "templateName":"",\n    "templateId":"",\n    "title":"asdf",\n    "body":"asdfasdf",\n    "lockScreenVisibility":1,\n    "fromProjectNumber":"616489336300",\n    "priority":5,\n    "additionalData":{\n        \n    },\n    "actionButtons":[\n        \n    ],\n    "rawPayload":"{\\"google.delivered_priority\\":\\"normal\\",\\"google.sent_time\\":1612744363074,\\"google.ttl\\":259200,\\"google.original_priority\\":\\"normal\\",\\"custom\\":\\"{\\\\\\"i\\\\\\":\\\\\\"bb5fd966-4ac2-4070-bcec-d66fb0fbab1f\\\\\\",\\\\\\"a\\\\\\":{\\\\\\"actionButtons\\\\\\":[],\\\\\\"actionId\\\\\\":\\\\\\"__DEFAULT__\\\\\\"}}\\",\\"pri\\":\\"5\\",\\"vis\\":\\"1\\",\\"from\\":\\"616489336300\\",\\"alert\\":\\"asdfasdf\\",\\"title\\":\\"asdf\\",\\"google.message_id\\":\\"0:1612744363095757%32d7332ff9fd7ecd\\",\\"google.c.sender.id\\":\\"616489336300\\"}"\n}\n')),Object(r.b)("h2",{id:"update-dependencies"},"Update Dependencies"),Object(r.b)("p",null,"You need to ensure you have the following extensions in your application. There are several new extensions included here, and please ensure you have updated all the dependencies to the same releases:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.distriqt.Core")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.distriqt.playservices.Base")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.distriqt.playservices.AdsIdentifier")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.distriqt.playservices.CloudMessaging")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.google.firebase.core")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.google.android.datatransport")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.google.dagger")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.google.guava")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.appcompat")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.browser")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.cardview")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.core")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.recyclerview")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.room")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.vectordrawable")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"androidx.work")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"com.jetbrains.kotlin"))),Object(r.b)("p",null,"See ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"onesignal/onesignal#required-anes"}),"Add Required ANEs")," for more information."),Object(r.b)("h2",{id:"update-manifest-additions"},"Update Manifest Additions"),Object(r.b)("p",null,"We suggest removing any OneSignal references in your manifest and adding the following. The changes have been significant! "),Object(r.b)("p",null,"You must replace ",Object(r.b)("inlineCode",{parentName:"p"},"APPLICATION_PACKAGE")," with your AIR application's Java package name, something like ",Object(r.b)("inlineCode",{parentName:"p"},"air.com.distriqt.test"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-xml"}),'        \x3c!-- ONE SIGNAL --\x3e\n        <meta-data android:name="com.onesignal.NotificationServiceExtension" android:value="com.distriqt.extension.pushnotifications.onesignal.NotificationServiceExtension" />\n\n        <receiver\n            android:name="com.onesignal.FCMBroadcastReceiver"\n            android:permission="com.google.android.c2dm.permission.SEND" >\n\n            \x3c!-- High priority so OneSignal payloads can be filtered from other FCM receivers --\x3e\n            <intent-filter android:priority="999" >\n                <action android:name="com.google.android.c2dm.intent.RECEIVE" />\n                <category android:name="APPLICATION_PACKAGE" />\n            </intent-filter>\n        </receiver>\n\n        <service\n            android:name="com.onesignal.HmsMessageServiceOneSignal"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="com.huawei.push.action.MESSAGING_EVENT" />\n            </intent-filter>\n        </service>\n\n        <activity\n            android:name="com.onesignal.NotificationOpenedActivityHMS"\n            android:noHistory="true"\n            android:theme="@android:style/Theme.Translucent.NoTitleBar" >\n            <intent-filter>\n                <action android:name="android.intent.action.VIEW" />\n            </intent-filter>\n        </activity>\n\n        <service android:name="com.onesignal.FCMIntentService" />\n        <service\n            android:name="com.onesignal.FCMIntentJobService"\n            android:permission="android.permission.BIND_JOB_SERVICE" />\n        <service\n            android:name="com.onesignal.FocusDelaySyncService"\n            android:stopWithTask="true" />\n        <service\n            android:name="com.onesignal.FocusDelaySyncJobService"\n            android:permission="android.permission.BIND_JOB_SERVICE" />\n        <service\n            android:name="com.onesignal.SyncService"\n            android:stopWithTask="true" />\n        <service\n            android:name="com.onesignal.SyncJobService"\n            android:permission="android.permission.BIND_JOB_SERVICE" />\n\n        <activity\n            android:name="com.onesignal.PermissionsActivity"\n            android:theme="@android:style/Theme.Translucent.NoTitleBar" />\n\n        <receiver android:name="com.onesignal.NotificationDismissReceiver" />\n        <receiver android:name="com.onesignal.BootUpReceiver" >\n            <intent-filter>\n                <action android:name="android.intent.action.BOOT_COMPLETED" />\n                <action android:name="android.intent.action.QUICKBOOT_POWERON" />\n            </intent-filter>\n        </receiver>\n        <receiver android:name="com.onesignal.UpgradeReceiver" >\n            <intent-filter>\n                <action android:name="android.intent.action.MY_PACKAGE_REPLACED" />\n            </intent-filter>\n        </receiver>\n\n        <activity\n            android:name="com.onesignal.NotificationOpenedReceiver"\n            android:noHistory="true"\n            android:theme="@android:style/Theme.Translucent.NoTitleBar" />\n\n        \x3c!--\n                FirebaseMessagingService performs security checks at runtime,\n                but set to not exported to explicitly avoid allowing another app to call it.\n        --\x3e\n        <service\n            android:name="com.google.firebase.messaging.FirebaseMessagingService"\n            android:exported="false" >\n            <intent-filter android:priority="-500" >\n                <action android:name="com.google.firebase.MESSAGING_EVENT" />\n            </intent-filter>\n        </service>\n\n\n        \x3c!-- FIREBASE CORE --\x3e\n        \x3c!-- common --\x3e\n        <service\n            android:name="com.google.firebase.components.ComponentDiscoveryService"\n            android:directBootAware="true"\n            android:exported="false" >\n            <meta-data\n                android:name="com.google.firebase.components:com.google.firebase.installations.FirebaseInstallationsRegistrar"\n                android:value="com.google.firebase.components.ComponentRegistrar" />\n            <meta-data\n                android:name="com.google.firebase.components:com.google.firebase.iid.Registrar"\n                android:value="com.google.firebase.components.ComponentRegistrar" />\n            <meta-data\n                android:name="com.google.firebase.components:com.google.firebase.messaging.FirebaseMessagingRegistrar"\n                android:value="com.google.firebase.components.ComponentRegistrar" />\n            <meta-data\n                android:name="com.google.firebase.components:com.google.firebase.datatransport.TransportRegistrar"\n                android:value="com.google.firebase.components.ComponentRegistrar" />\n        </service>\n        <provider\n            android:name="com.google.firebase.provider.FirebaseInitProvider"\n            android:authorities="APPLICATION_PACKAGE.firebaseinitprovider"\n            android:exported="false"\n            android:initOrder="100" />\n\n\n        \x3c!-- iid --\x3e\n        <receiver\n            android:name="com.google.firebase.iid.FirebaseInstanceIdReceiver"\n            android:exported="true"\n            android:permission="com.google.android.c2dm.permission.SEND" >\n            <intent-filter>\n                <action android:name="com.google.android.c2dm.intent.RECEIVE" />\n            </intent-filter>\n        </receiver>\n\n\n        \x3c!-- androidx.work --\x3e\n        <provider\n            android:name="androidx.work.impl.WorkManagerInitializer"\n            android:authorities="APPLICATION_PACKAGE.workmanager-init"\n            android:directBootAware="false"\n            android:exported="false"\n            android:multiprocess="true" />\n\n        <service\n            android:name="androidx.work.impl.background.systemalarm.SystemAlarmService"\n            android:directBootAware="false"\n            android:enabled="@bool/enable_system_alarm_service_default"\n            android:exported="false" />\n        <service\n            android:name="androidx.work.impl.background.systemjob.SystemJobService"\n            android:directBootAware="false"\n            android:enabled="@bool/enable_system_job_service_default"\n            android:exported="true"\n            android:permission="android.permission.BIND_JOB_SERVICE" />\n        <service\n            android:name="androidx.work.impl.foreground.SystemForegroundService"\n            android:directBootAware="false"\n            android:enabled="@bool/enable_system_foreground_service_default"\n            android:exported="false" />\n\n        <receiver\n            android:name="androidx.work.impl.utils.ForceStopRunnable$BroadcastReceiver"\n            android:directBootAware="false"\n            android:enabled="true"\n            android:exported="false" />\n        <receiver\n            android:name="androidx.work.impl.background.systemalarm.ConstraintProxy$BatteryChargingProxy"\n            android:directBootAware="false"\n            android:enabled="false"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="android.intent.action.ACTION_POWER_CONNECTED" />\n                <action android:name="android.intent.action.ACTION_POWER_DISCONNECTED" />\n            </intent-filter>\n        </receiver>\n        <receiver\n            android:name="androidx.work.impl.background.systemalarm.ConstraintProxy$BatteryNotLowProxy"\n            android:directBootAware="false"\n            android:enabled="false"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="android.intent.action.BATTERY_OKAY" />\n                <action android:name="android.intent.action.BATTERY_LOW" />\n            </intent-filter>\n        </receiver>\n        <receiver\n            android:name="androidx.work.impl.background.systemalarm.ConstraintProxy$StorageNotLowProxy"\n            android:directBootAware="false"\n            android:enabled="false"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="android.intent.action.DEVICE_STORAGE_LOW" />\n                <action android:name="android.intent.action.DEVICE_STORAGE_OK" />\n            </intent-filter>\n        </receiver>\n        <receiver\n            android:name="androidx.work.impl.background.systemalarm.ConstraintProxy$NetworkStateProxy"\n            android:directBootAware="false"\n            android:enabled="false"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="android.net.conn.CONNECTIVITY_CHANGE" />\n            </intent-filter>\n        </receiver>\n        <receiver\n            android:name="androidx.work.impl.background.systemalarm.RescheduleReceiver"\n            android:directBootAware="false"\n            android:enabled="false"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="android.intent.action.BOOT_COMPLETED" />\n                <action android:name="android.intent.action.TIME_SET" />\n                <action android:name="android.intent.action.TIMEZONE_CHANGED" />\n            </intent-filter>\n        </receiver>\n        <receiver\n            android:name="androidx.work.impl.background.systemalarm.ConstraintProxyUpdateReceiver"\n            android:directBootAware="false"\n            android:enabled="@bool/enable_system_alarm_service_default"\n            android:exported="false" >\n            <intent-filter>\n                <action android:name="androidx.work.impl.background.systemalarm.UpdateProxies" />\n            </intent-filter>\n        </receiver>\n        <receiver\n            android:name="androidx.work.impl.diagnostics.DiagnosticsReceiver"\n            android:directBootAware="false"\n            android:enabled="true"\n            android:exported="true"\n            android:permission="android.permission.DUMP" >\n            <intent-filter>\n                <action android:name="androidx.work.diagnostics.REQUEST_DIAGNOSTICS" />\n            </intent-filter>\n        </receiver>\n\n        \x3c!-- com.google.android.datatransport --\x3e\n        <service\n            android:name="com.google.android.datatransport.runtime.backends.TransportBackendDiscovery"\n            android:exported="false" >\n            <meta-data\n                android:name="backend:com.google.android.datatransport.cct.CctBackendFactory"\n                android:value="cct" />\n        </service>\n        <service\n            android:name="com.google.android.datatransport.runtime.scheduling.jobscheduling.JobInfoSchedulerService"\n            android:exported="false"\n            android:permission="android.permission.BIND_JOB_SERVICE" >\n        </service>\n\n        <receiver\n            android:name="com.google.android.datatransport.runtime.scheduling.jobscheduling.AlarmManagerSchedulerBroadcastReceiver"\n            android:exported="false" />\n\n        <service\n            android:name="androidx.room.MultiInstanceInvalidationService"\n            android:directBootAware="true"\n            android:exported="false" />\n')),Object(r.b)("p",null,"For more information see the detail in the ",Object(r.b)("a",Object(i.a)({parentName:"p"},{href:"onesignal/onesignal#manifest-additions"}),"Manifest Additions")," section."))}l.isMDXComponent=!0},889:function(e,n,a){"use strict";a.d(n,"a",(function(){return m})),a.d(n,"b",(function(){return g}));var i=a(0),t=a.n(i);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,i)}return a}function d(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?o(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function c(e,n){if(null==e)return{};var a,i,t=function(e,n){if(null==e)return{};var a,i,t={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)a=r[i],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var s=t.a.createContext({}),l=function(e){var n=t.a.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):d(d({},n),e)),a},m=function(e){var n=l(e.components);return t.a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return t.a.createElement(t.a.Fragment,{},n)}},b=t.a.forwardRef((function(e,n){var a=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),m=l(a),b=i,g=m["".concat(o,".").concat(b)]||m[b]||p[b]||r;return a?t.a.createElement(g,d(d({ref:n},s),{},{components:a})):t.a.createElement(g,d({ref:n},s))}));function g(e,n){var a=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=b;var d={};for(var c in n)hasOwnProperty.call(n,c)&&(d[c]=n[c]);d.originalType=e,d.mdxType="string"==typeof e?e:i,o[1]=d;for(var s=2;s<r;s++)o[s]=a[s];return t.a.createElement.apply(null,o)}return t.a.createElement.apply(null,a)}b.displayName="MDXCreateElement"}}]);