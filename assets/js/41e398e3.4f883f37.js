"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[16861],{22281:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/loading-5e0a6818e8ed9bd36e1436a04999e35f.png"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var t=i(96540);const s={},o=t.createContext(s);function a(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}},67811:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});var t=i(70280),s=i(74848),o=i(28453);const a={title:"Delay Loading Extensions",description:"Improve application startup time using delay load",image:"images/loading.png",authors:["marchbold"],tags:["delayload","airsdk","tips"]},r=void 0,l={authorsImageUrls:[void 0]},d=[{value:"Enabling Delay Load",id:"enabling-delay-load",level:2},{value:"Issues",id:"issues",level:3},{value:"Loading an Extension",id:"loading-an-extension",level:2},{value:"Extension Information",id:"extension-information",level:2},{value:"Known Extensions",id:"known-extensions",level:3},{value:"Extension Info",id:"extension-info",level:3}];function c(e){const n={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(22281).A+"",width:"800",height:"400"})}),"\n",(0,s.jsx)(n.p,{children:"Startup time of an application is often key in retaining your users so it can be critical to make start time as short as possible."}),"\n",(0,s.jsxs)(n.p,{children:["One factor that can contribute to the startup time of an AIR application is loading the definitions for the functionality in native extensions. This is normally done by AIR automatically however with the latest AIR release you can now specify an option on an extension in your application to ",(0,s.jsx)(n.em,{children:"delay load"})," the extension functionality."]}),"\n",(0,s.jsxs)(n.p,{children:["The loading process consists of finding and loading the bytes from the ",(0,s.jsx)(n.code,{children:"library.swf"})," within the extension, then parsing this library into the AS3 engine so that it's available when applications use symbols from within the extension. As the definitions for classes and interfaces contained within the extension aren't accessible before the extension is loaded you must ensure you have clear separation in your code structure of where you use the extensions functionality."]}),"\n",(0,s.jsx)(n.p,{children:"So we suggest separating the loading of the extensions and ensuring all of your usage of extensions are separated into classes that aren't accessed until after the load process is completed."}),"\n",(0,s.jsx)(n.h2,{id:"enabling-delay-load",children:"Enabling Delay Load"}),"\n",(0,s.jsxs)(n.p,{children:["Firstly you will need to enable delayed loading of your extensions by editing your application descriptor and changing the extensions you wish to delay load to have the ",(0,s.jsx)(n.code,{children:"delayLoad"})," attribute as below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<extensionID delayLoad="true">com.distriqt.Core</extensionID>\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"caution",children:[(0,s.jsx)(n.mdxAdmonitionTitle,{}),(0,s.jsx)(n.p,{children:"With this attribute enabled the extension symbols will not be loaded automatically at startup."}),(0,s.jsx)(n.p,{children:"If you attempt to use a definition (a class or an interface) from within an extension before it is loaded then you will encounter a runtime error."})]}),"\n",(0,s.jsx)(n.h3,{id:"issues",children:"Issues"}),"\n",(0,s.jsx)(n.p,{children:"It's important to understand the side effects of this delay load operation as you may have to restructure your code to support it."}),"\n",(0,s.jsx)(n.p,{children:"The first issue is that creating instances or calling static methods of a symbol defined in an extension will result in a runtime error. For example, a call to:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"Core.init();\n"})}),"\n",(0,s.jsx)(n.p,{children:"would result in an error:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Error #1065: Variable com.distriqt.extension.core::Core is not defined.\n"})}),"\n",(0,s.jsx)(n.p,{children:"The second issue can be more critical as it requires careful planning of your function definitions, particularly important for event handlers."}),"\n",(0,s.jsx)(n.p,{children:"If a function is defined with a parameter of a class from the extension, eg"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"// Firstly load the extension ...\n\ntestFunction( ... );\n\nfunction testFunction( param:SomeExtensionClass ):void\n{\n\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"it will result in a verify error:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"VerifyError: Error #1014: Class extension::SomeExtensionClass could not be found.\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Even though you have loaded the extension before using the function, the definition of the function causes an error."})}),"\n",(0,s.jsx)(n.p,{children:"This demonstrates why it is important to separate the extensions functionality into a separate class that isn't accessed until the extension is loaded."}),"\n",(0,s.jsxs)(n.p,{children:["i.e. if this function was moved into another class, say ",(0,s.jsx)(n.code,{children:"TestClass"}),", then you could access this same functionality via the following pseudo code:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"// Firstly load the extension ...\n\n// Then use the extension functionality in the TestClass:\nvar test:TestClass = new TestClass();\ntest.testFunction( ... );\n"})}),"\n",(0,s.jsx)(n.p,{children:"This way the definition of the function isn't used until after the extension is loaded and you won't encounter an error."}),"\n",(0,s.jsx)(n.h2,{id:"loading-an-extension",children:"Loading an Extension"}),"\n",(0,s.jsxs)(n.p,{children:["To load the extension you use methods of the ",(0,s.jsx)(n.code,{children:"flash.external.ExtensionContext"})," class. Loading an extension is a synchronous process and requires the ",(0,s.jsx)(n.code,{children:"extensionID"})," as a parameter:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"ExtensionContext.loadExtension( extensionID, null );\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Immediately after this call the symbols from the extension will be available so a call to ",(0,s.jsx)(n.code,{children:"Core.init();"})," will now succeed."]}),"\n",(0,s.jsxs)(n.p,{children:["This process may still take some time so it is suggested to not just have a series of ",(0,s.jsx)(n.code,{children:"loadExtension"})," calls following one another but instead ensure time passes between each call as part of a load process."]}),"\n",(0,s.jsx)(n.h2,{id:"extension-information",children:"Extension Information"}),"\n",(0,s.jsxs)(n.p,{children:["There are a range of helper functionality available in the ",(0,s.jsx)(n.code,{children:"ExtensionContext"})," class to help with loading extensions."]}),"\n",(0,s.jsx)(n.h3,{id:"known-extensions",children:"Known Extensions"}),"\n",(0,s.jsxs)(n.p,{children:["You can list the extensions that are contained in the application descriptor via the ",(0,s.jsx)(n.code,{children:"ExtensionContext.knownExtensions"})," property. This property is an array of ",(0,s.jsx)(n.code,{children:"extensionID"})," string values each representing an extension identifier listed in the ",(0,s.jsx)(n.code,{children:"extensions"})," node of your application descriptor."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"for each (var extensionID:String in ExtensionContext.knownExtensions)\n{\n    trace( extensionID );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"extension-info",children:"Extension Info"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"ExtensionInfo"})," class contains information about the state of a particular extension."]}),"\n",(0,s.jsxs)(n.p,{children:["You obtain the current information for an extension by calling ",(0,s.jsx)(n.code,{children:"getExtensionInfo()"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"var info:ExtensionInfo = ExtensionContext.getExtensionInfo( extensionID );\n"})}),"\n",(0,s.jsx)(n.p,{children:"This class contains a range of information (most of it is extracted from the extension itself) including:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"extensionID"}),": The identifier for this extension;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),": The extension name, as provided in the extension's XML descriptor file;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"description"}),":  The extension description, as provided in the extension's XML descriptor file;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"versionNumber"}),":  The extension version number, as provided in the extension's XML descriptor file;"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Additionally it contains two properties useful for handling loading of extensions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"isDynamic"}),": A Boolean value indicating whether the extension is a 'dynamically loaded' extension or not, ie. whether the ",(0,s.jsx)(n.code,{children:"delayLoad"})," attribute has been set to ",(0,s.jsx)(n.code,{children:"true"}),";"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"isLoaded"}),": A Boolean value indicating whether the extension has been loaded or not;"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},70280:e=>{e.exports=JSON.parse('{"permalink":"/news/2023/12/15/delay-load-extensions","source":"@site/news/2023-12-15-delay-load-extensions.md","title":"Delay Loading Extensions","description":"Improve application startup time using delay load","date":"2023-12-15T00:00:00.000Z","tags":[{"inline":true,"label":"delayload","permalink":"/news/tags/delayload"},{"inline":true,"label":"airsdk","permalink":"/news/tags/airsdk"},{"inline":true,"label":"tips","permalink":"/news/tags/tips"}],"readingTime":4.02,"hasTruncateMarker":true,"authors":[{"name":"Michael","title":"Lead Developer","url":"https://github.com/marchbold","imageURL":"https://avatars3.githubusercontent.com/u/442356?s=460&v=4","key":"marchbold","page":null}],"frontMatter":{"title":"Delay Loading Extensions","description":"Improve application startup time using delay load","image":"images/loading.png","authors":["marchbold"],"tags":["delayload","airsdk","tips"]},"unlisted":false,"prevItem":{"title":"May 2024","permalink":"/news/2024-05"},"nextItem":{"title":"November 2023","permalink":"/news/2023-11"}}')}}]);