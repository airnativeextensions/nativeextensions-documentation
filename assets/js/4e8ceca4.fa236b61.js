"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[56846],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>l});var t=i(96540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}},37726:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>c,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"applesignin/login-with-apple-id","title":"Login with Apple Id","description":"Login","source":"@site/docs/applesignin/login-with-apple-id.md","sourceDirName":"applesignin","slug":"/applesignin/login-with-apple-id","permalink":"/docs/applesignin/login-with-apple-id","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Login with Apple Id","sidebar_label":"Login with Apple Id"},"sidebar":"applesignin","previous":{"title":"Setup Auth Server","permalink":"/docs/applesignin/setup-auth-server"},"next":{"title":"Get User Credentials","permalink":"/docs/applesignin/get-user-credentials"}}');var s=i(74848),o=i(28453);const r={title:"Login with Apple Id",sidebar_label:"Login with Apple Id"},l=void 0,d={},a=[{value:"Login",id:"login",level:2},{value:"Options",id:"options",level:2},{value:"iOS",id:"ios",level:3},{value:"Android",id:"android",level:3},{value:"Events",id:"events",level:2},{value:"User Revoke",id:"user-revoke",level:2},{value:"Example",id:"example",level:2},{value:"Android",id:"android-1",level:2}];function p(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"login",children:"Login"}),"\n",(0,s.jsxs)(n.p,{children:["To initiate login call the ",(0,s.jsx)(n.code,{children:"loginWithAppleId()"})," function:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"AppleSignIn.instance.loginWithAppleId();\n"})}),"\n",(0,s.jsx)(n.p,{children:'This will initiate the sign in process and present the "Sign In with Apple" UI.'}),"\n",(0,s.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,s.jsx)(n.p,{children:"You can pass a few options to the login function allowing you to control some aspects of the process. Mainly whether the email and full name of the user should be requested."}),"\n",(0,s.jsxs)(n.p,{children:["This is done by passing an instance of the ",(0,s.jsx)(n.code,{children:"AppleSignInOptions"})," to the ",(0,s.jsx)(n.code,{children:"loginWithAppleId()"})," function."]}),"\n",(0,s.jsx)(n.p,{children:"For example, to request both the email and full name scopes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"var options:AppleSignInOptions = new AppleSignInOptions()\n        .setRequestedScopes([\n                AppleSignInScopes.FULL_NAME,\n                AppleSignInScopes.EMAIL\n                            ]);\n\nAppleSignIn.instance.loginWithAppleId( options );\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ios",children:"iOS"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Important: To sign in with an Apple account, users must:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Have an Apple ID with two-factor authentication (2FA) enabled."}),"\n",(0,s.jsx)(n.li,{children:"Be signed in to iCloud on an Apple device."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"https://support.apple.com/en-us/HT210318",children:"How to use Sign in with Apple"}),". You will also need to meet these requirements to test your integration with Sign In with Apple."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"android",children:"Android"}),"\n",(0,s.jsx)(n.p,{children:"If you are deploying to Android as well then you will need to provide your Service ID (client id) and redirect url in the options."}),"\n",(0,s.jsx)(n.p,{children:"For example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:'var options:AppleSignInOptions = new AppleSignInOptions()\n        .setRequestedScopes([\n                AppleSignInScopes.FULL_NAME,\n                AppleSignInScopes.EMAIL\n                            ])\n        .setClientId( "com.distriqt.test.applesignin" )\n        .setRedirectUrl( "https://auth.distriqt.com/appleoauth" )\n;\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The client id is the identifier used to create your ",(0,s.jsx)(n.strong,{children:"Service ID"})," in the apple developer console."]}),"\n",(0,s.jsxs)(n.p,{children:["The redirect url is one of the urls you entered when creating your ",(0,s.jsx)(n.strong,{children:"Service ID"})," that you intend to use for this login request."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"These values are ignored on iOS."})}),"\n",(0,s.jsx)(n.h2,{id:"events",children:"Events"}),"\n",(0,s.jsx)(n.p,{children:"During the login process you will receive one of the following events:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AppleSignInEvent.SUCCESS"}),": Upon successfully authentication;"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"AppleSignInErrorEvent.ERROR"}),": If an error occurred during login;"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You should listen for both of these events and handle accordingly."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:'AppleSignIn.instance.addEventListener( AppleSignInErrorEvent.ERROR, errorHandler );\nAppleSignIn.instance.addEventListener( AppleSignInEvent.SUCCESS, successHandler );\n\nfunction successHandler( event:AppleSignInEvent ):void\n{\n    trace( "user: " + event.appleIdCredential.user );\n    trace( "identityToken: " + event.appleIdCredential.identityToken );\n    trace( "authorizationCode: " + event.appleIdCredential.authorizationCode );\n    trace( "raw Nonce: " + event.rawNonce );\n}\n\nfunction errorHandler( event:AppleSignInErrorEvent ):void\n{\n    trace( "errorHandler(): [" + event.errorID + "] :: " + event.text  );\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:['You can access the "nonce" used to initiate this authorisation request in the success handler via the ',(0,s.jsx)(n.code,{children:"event.rawNonce"})," property. This can be used to further authenticate with services such as Firebase."]}),"\n",(0,s.jsxs)(n.admonition,{title:"Encoding",type:"info",children:[(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["Please note that the ",(0,s.jsx)(n.code,{children:"identityToken"})," and ",(0,s.jsx)(n.code,{children:"authorizationCode"})," are Base64 encoded."]})}),(0,s.jsx)(n.p,{children:"This ensures we preserve the contents of the byte data correctly. Some endpoints will use the Base64 encoded string whereas others will require the decoded version."}),(0,s.jsxs)(n.p,{children:["To decode it you can use the ",(0,s.jsx)(n.a,{href:"https://github.com/distriqt/ANE-AppleSignIn/blob/master/example/starling/src/com/distriqt/utils/Base64.as",children:"utility class"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"var decoded:String = Base64.decode( event.appleIdCredential.identityToken )\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"user-revoke",children:"User Revoke"}),"\n",(0,s.jsx)(n.p,{children:"The user can revoke the authentication through their apple account. You can listen for a revoke event which will be dispatched if the authentication is ever revoked by the user:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:"AppleSignIn.instance.addEventListener( AppleSignInEvent.REVOKED, revokedHandler );\n\n\nfunction revokedHandler( event:AppleSignInEvent ):void\n{\n    // User revoked authentication\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-actionscript",children:'AppleSignIn.instance.addEventListener( AppleSignInErrorEvent.ERROR, errorHandler );\nAppleSignIn.instance.addEventListener( AppleSignInEvent.SUCCESS, successHandler );\n\nvar options:AppleSignInOptions = new AppleSignInOptions()\n        .setRequestedScopes([\n                AppleSignInScopes.FULL_NAME,\n                AppleSignInScopes.EMAIL\n                            ])\n        .setClientId( "com.distriqt.test.applesignin" )\n        .setRedirectUrl( "https://auth.distriqt.com/appleoauth" );\n\nAppleSignIn.instance.loginWithAppleId( options );\n\n\n\nfunction successHandler( event:AppleSignInEvent ):void\n{\n    trace( "user: " + event.appleIdCredential.user );\n    trace( "identityToken: " + event.appleIdCredential.identityToken );\n    trace( "authorizationCode: " + event.appleIdCredential.authorizationCode );\n}\n\nfunction errorHandler( event:AppleSignInErrorEvent ):void\n{\n    trace( "errorHandler(): [" + event.errorID + "] :: " + event.text  );\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"android-1",children:"Android"}),"\n",(0,s.jsx)(n.p,{children:"With Android the process uses a webview and the OAuth web login."}),"\n",(0,s.jsx)(n.p,{children:"In order to successfully complete this process you need to setup a server that will exchange the authorisation code for the identity token and user."}),"\n",(0,s.jsx)(n.p,{children:"There are a few differences with this process that you should be aware of as it will affect how you implement login on Android."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"User's name components are only returned the first time they log in."}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}}}]);