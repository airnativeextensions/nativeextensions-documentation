"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[21033],{21778:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>s});const o=JSON.parse('{"id":"cloudstorage/document-store","title":"Document Store","description":"Make sure you have added the entitlements to your application descriptor before attempting to","source":"@site/docs/cloudstorage/document-store.md","sourceDirName":"cloudstorage","slug":"/cloudstorage/document-store","permalink":"/docs/cloudstorage/document-store","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Document Store","sidebar_label":"Document Store"},"sidebar":"cloudstorage","previous":{"title":"Key-Value Storage","permalink":"/docs/cloudstorage/key-value-storage"},"next":{"title":"Android Testing","permalink":"/docs/cloudstorage/android-testing"}}');var r=n(74848),c=n(28453);const a={title:"Document Store",sidebar_label:"Document Store"},d=void 0,i={},s=[{value:"Checking Support",id:"checking-support",level:2},{value:"Setup the store",id:"setup-the-store",level:2},{value:"List Documents",id:"list-documents",level:2},{value:"Update",id:"update",level:2},{value:"Load a Document",id:"load-a-document",level:2},{value:"Save a Document",id:"save-a-document",level:2},{value:"Create a Document",id:"create-a-document",level:2},{value:"Delete a Document",id:"delete-a-document",level:2},{value:"Handling conflicts",id:"handling-conflicts",level:2}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["Make sure you have added the entitlements to your application descriptor before attempting to\nuse the document store. See the section: ",(0,r.jsx)(t.a,{href:"/docs/cloudstorage/add-the-extension",children:"Add the Extension"}),"."]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:["Note: ",(0,r.jsx)(t.strong,{children:"Document storage is not supported on Apple's tvOS or through the Unity plugin"})]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"checking-support",children:"Checking Support"}),"\n",(0,r.jsxs)(t.p,{children:["You should check if the document store functionality is supported on the current platform by using\nthe ",(0,r.jsx)(t.code,{children:"isSupported"})," flag. This will determine if the current platform (Android, iOS, tvOS etc) supports\nthe document storage functionality."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:"if (CloudStorage.service.documentStore.isSupported)\n{\n\t// The documentStore functionality is supported on the current platform\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"Certain platforms, such as tvOS will return false for this value."}),"\n",(0,r.jsx)(t.h2,{id:"setup-the-store",children:"Setup the store"}),"\n",(0,r.jsx)(t.p,{children:"To start you must call setup on the document store. This initialises the store to be ready for\ndocument handling and makes sure that the services are available."}),"\n",(0,r.jsx)(t.p,{children:"You can either pass a specific Ubiquity Container ID or an empty string to use the first container\nID in your entitlements."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:"CloudStorage.service.documentStore.addEventListener( DocumentStoreStateEvent.INITIALISED, ds_initialisedHandler );\nCloudStorage.service.documentStore.addEventListener( DocumentStoreStateEvent.CHANGE, ds_stateChangeHandler );\n\nCloudStorage.service.documentStore.addEventListener( DocumentStoreEvent.FILES_DID_CHANGE, ds_filesDidChangeHandler );\nCloudStorage.service.documentStore.addEventListener( DocumentStoreEvent.CONFLICT, ds_conflictHandler );\n\nCloudStorage.service.documentStore.setup();\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Once you have called ",(0,r.jsx)(t.code,{children:"setup"})," you can check if the document store is available for use by checking\nthe ",(0,r.jsx)(t.code,{children:"isAvailable"})," flag:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:"if (CloudStorage.service.documentStore.isAvailable)\n{\n\t// Can use storage\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"The events that are dispatched here represent different events occurring in the store:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'private function ds_initialisedHandler( event:DocumentStoreStateEvent ):void\n{\n\ttrace( "ds_initialisedHandler: " + event.available + ":"+event.containerUrl );\n\ttrace( event.token );\n}\n\nprivate function ds_stateChangeHandler( event:DocumentStoreStateEvent ):void\n{\n\ttrace( "ds_stateChangeHandler: " + event.available + ":"+event.containerUrl );\n\t\n\t// Should check for user change here storing the current value of the token\n\ttrace( event.token );\n}\n\nprivate function ds_filesDidChangeHandler( event:DocumentStoreEvent ):void\n{\n\ttrace( "ds_filesDidChangeHandler" );\n\tfor each (var document:Document in event.documents)\n\t{\n\t\ttrace( "changed: "+document.filename );\n\t}\n}\n\nprivate function ds_conflictHandler( event:DocumentStoreEvent ):void\n{\n\ttrace( "ds_conflictHandler" );\n\t// See handling conflicts later\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"list-documents",children:"List Documents"}),"\n",(0,r.jsxs)(t.p,{children:["Once you have setup the store you can query the available documents by calling ",(0,r.jsx)(t.code,{children:"listDocuments"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'if (CloudStorage.service.documentStore.isAvailable)\n{\n\tvar documents:Vector.<Document> = CloudStorage.service.documentStore.listDocuments();\n\t\n\tfor each (var document:Document in documents)\n\t{\n\t\ttrace( "document: "+document.filename +" ["+document.url+"]" );\n\t}\n\t\n\t// Store for other actions\n\t_documents = documents;\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"update",children:"Update"}),"\n",(0,r.jsxs)(t.p,{children:["If you wish, you can force an update of the current files by calling ",(0,r.jsx)(t.code,{children:"update"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:"var success:Boolean = CloudStorage.service.documentStore.update();\n"})}),"\n",(0,r.jsx)(t.h2,{id:"load-a-document",children:"Load a Document"}),"\n",(0,r.jsxs)(t.p,{children:["Once you have retrieved the list of files that are available you will most likely want to\nload the data of the document. This is done by calling ",(0,r.jsx)(t.code,{children:"loadDocument"})," passing the document's\nfilename that you wish to load:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:"CloudStorage.service.documentStore.addEventListener( DocumentEvent.LOAD_COMPLETE, document_loadCompleteHandler );\nCloudStorage.service.documentStore.addEventListener( DocumentEvent.LOAD_ERROR, document_loadErrorHandler );\n\nvar success:Boolean = CloudStorage.service.documentStore.loadDocument( document.filename );\n"})}),"\n",(0,r.jsx)(t.p,{children:"If this call succeeds you will receive one of the load events. In the following we are loading\na text file and attempt to trace the contents of the file."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'private function document_loadCompleteHandler( event:DocumentEvent ):void\n{\n\ttrace( "document_loadCompleteHandler" );\n\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.LOAD_COMPLETE, document_loadCompleteHandler );\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.LOAD_ERROR, document_loadErrorHandler );\n\t\n\tif (event.document && event.document.data)\n\t{\n\t\ttrace( "document.data["+event.document.data.length+"] : "+event.document.modifiedDate.toLocaleString() );\n\t\ttry {\n\t\t\ttrace( event.document.data.readUTFBytes( event.document.data.length ));\n\t\t} catch (e:Error) {}\n\t}\n}\n\nprivate function document_loadErrorHandler( event:DocumentEvent ):void\n{\n\ttrace( "document_loadErrorHandler: " + event.error );\n\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.LOAD_COMPLETE, document_loadCompleteHandler );\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.LOAD_ERROR, document_loadErrorHandler );\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"save-a-document",children:"Save a Document"}),"\n",(0,r.jsxs)(t.p,{children:["Now that you have a loaded document you can modify the data in the file by changing the data contained in the\ndocument's ",(0,r.jsx)(t.code,{children:"data"}),". Once you have modified the content, call ",(0,r.jsx)(t.code,{children:"saveDocument"})," to write the contents of the doucment\nto the document store."]}),"\n",(0,r.jsx)(t.p,{children:"For example, in the following we create a string with a random number and write that to the document:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'var content:String =  "TEST SOME STRING WRITING "+String(Math.floor(Math.random()*100000));e\n\n_documents[0].data = new ByteArray();\n_documents[0].data.writeUTFBytes( content );\n\nCloudStorage.service.documentStore.addEventListener( DocumentEvent.SAVE_COMPLETE, document_saveCompleteHandler );\nCloudStorage.service.documentStore.addEventListener( DocumentEvent.SAVE_ERROR, document_saveErrorHandler );\n\nCloudStorage.service.documentStore.saveDocument( _documents[0] );\n'})}),"\n",(0,r.jsx)(t.p,{children:"Again you will receive either a complete or error event, depending on the success of the save."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'private function document_saveCompleteHandler( event:DocumentEvent ):void\n{\n\ttrace( "document_saveCompleteHandler" );\n\t\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.SAVE_COMPLETE, document_saveCompleteHandler );\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.SAVE_ERROR, document_saveErrorHandler );\n}\n\nprivate function document_saveErrorHandler( event:DocumentEvent ):void\n{\n\ttrace( "document_saveErrorHandler" );\n\t\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.SAVE_COMPLETE, document_saveCompleteHandler );\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.SAVE_ERROR, document_saveErrorHandler );\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"create-a-document",children:"Create a Document"}),"\n",(0,r.jsxs)(t.p,{children:["To create a new document you can simply create an instance of the ",(0,r.jsx)(t.code,{children:"Document"})," class\npassing in your data and then call ",(0,r.jsx)(t.code,{children:"saveDocument"}),". This will create a new file\nwhere appropriate and return the normal save success / error events."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'var document:Document = new Document();\ndocument.filename = "test.txt";\ndocument.data = new ByteArray();\ndocument.data.writeUTFBytes( "TEST SOME STRING WRITING" );\n\nCloudStorage.service.documentStore.addEventListener( DocumentEvent.SAVE_COMPLETE, document_createCompleteHandler );\nCloudStorage.service.documentStore.addEventListener( DocumentEvent.SAVE_ERROR, document_createErrorHandler );\n\nCloudStorage.service.documentStore.saveDocument( document );\n'})}),"\n",(0,r.jsxs)(t.p,{children:["If you wish to create the document in a folder, you can add a folder name to the ",(0,r.jsx)(t.code,{children:"filename"})," of the document."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'document.filename = "folder/test.txt";\n'})}),"\n",(0,r.jsx)(t.h2,{id:"delete-a-document",children:"Delete a Document"}),"\n",(0,r.jsxs)(t.p,{children:["To delete a document call ",(0,r.jsx)(t.code,{children:"deleteDocument"})," with the filename of the document to delete."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:"CloudStorage.service.documentStore.addEventListener( DocumentEvent.DELETE_COMPLETE, document_deleteCompleteHandler );\nCloudStorage.service.documentStore.addEventListener( DocumentEvent.DELETE_ERROR, document_deleteErrorHandler );\n\nCloudStorage.service.documentStore.deleteDocument( _documents[0].filename );\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'private function document_deleteCompleteHandler( event:DocumentEvent ):void\n{\n\ttrace( "document_deleteCompleteHandler" );\n\t\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.DELETE_COMPLETE, document_deleteCompleteHandler );\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.DELETE_ERROR, document_deleteErrorHandler );\n}\n\nprivate function document_deleteErrorHandler( event:DocumentEvent ):void\n{\n\ttrace( "document_deleteErrorHandler" );\n\t\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.DELETE_COMPLETE, document_deleteCompleteHandler );\n\tCloudStorage.service.documentStore.removeEventListener( DocumentEvent.DELETE_ERROR, document_deleteErrorHandler );\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"handling-conflicts",children:"Handling conflicts"}),"\n",(0,r.jsx)(t.p,{children:"Conflicts can (and will) occur when devices save to the same file simulataneously and cannot be resolved by iCloud."}),"\n",(0,r.jsxs)(t.p,{children:["You must listen for the conflict event and process each conflict. The event contains a list of documents that are\nin a conflicted state and you must use ",(0,r.jsx)(t.code,{children:"getConflictingVersionsForDocument"})," to get the versions of the file and then\ndecide which is the valid version and resolve the conflict with that version of the file, calling ",(0,r.jsx)(t.code,{children:"resolveConflictWithVersion"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The following iterates over the conflicts and blindly resolves the conflict with the first version of the file."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-actionscript",children:'private function ds_conflictHandler( event:DocumentStoreEvent ):void\n{\n\ttrace( "ds_conflictHandler" );\t\n\tfor each (var document:Document in event.documents)\n\t{\n\t\ttrace( "conflict: "+document.filename );\n\t\tvar versions:Array = CloudStorage.service.documentStore.getConflictingVersionsForDocument( document );\n\t\tCloudStorage.service.documentStore.resolveConflictWithVersion( document, versions[0] );\n\t}\n}\n'})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"You should not use this in production! We just are using this to demonstrate the function calls."})}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>d});var o=n(96540);const r={},c=o.createContext(r);function a(e){const t=o.useContext(c);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(c.Provider,{value:t},e.children)}}}]);