<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="air native extensions Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="air native extensions Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-188619114-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="air native extensions" href="/opensearch.xml"><title data-react-helmet="true">Firestore - Transactions and batched writes | air native extensions</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" property="og:url" content="https://docs.airnativeextensions.com/docs/firebase/firestore/transactions-and-batched-writes"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Firestore - Transactions and batched writes | air native extensions"><meta data-react-helmet="true" name="description" content="Cloud Firestore supports atomic operations for reading and writing data. In a set of atomic operations, either all of the operations succeed, or none of them are applied. There are two types of atomic operations in Cloud Firestore:"><meta data-react-helmet="true" property="og:description" content="Cloud Firestore supports atomic operations for reading and writing data. In a set of atomic operations, either all of the operations succeed, or none of them are applied. There are two types of atomic operations in Cloud Firestore:"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.airnativeextensions.com/docs/firebase/firestore/transactions-and-batched-writes"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/firebase/firestore/transactions-and-batched-writes" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/firebase/firestore/transactions-and-batched-writes" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f49ec264.css">
<link rel="preload" href="/assets/js/runtime~main.b85ecf5b.js" as="script">
<link rel="preload" href="/assets/js/main.9f6f4e02.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1boX">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/ane-icon-black.png" alt="AIR Native Extensions" class="themedImage_3oOy themedImage--light_3ouy navbar__logo"><img src="/img/ane-icon-white.png" alt="AIR Native Extensions" class="themedImage_3oOy themedImage--dark_3zJb navbar__logo"><b class="navbar__title">AIR Native Extensions</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/news/">News</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_2ySP react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_2iFN"> </span></div><div class="react-toggle-track-x"><span class="toggle_2iFN"> </span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xXbB"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_3zOJ"><button class="clean-btn backToTopButton_DkI0" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_G8MK"><div class="sidebar_1tWv"><nav class="menu thin-scrollbar menu_1Iah menuWithAnnouncementBar_3acx"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/firebase/">Firebase</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setup Firebase for your application</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Core / Analytics</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Develop</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Authentication</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Realtime Database</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Cloud Firestore</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/firebase/firestore/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/firebase/firestore/add-the-extension">Add the extension</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Add and manage data</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a href="https://firebase.google.com/docs/firestore/data-model" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Data model (external)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://firebase.google.com/docs/firestore/manage-data/structure-data" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Structure data (external)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://firebase.google.com/docs/firestore/manage-data/data-types" target="_blank" rel="noopener noreferrer" class="menu__link" tabindex="0"><span>Data types (external)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/firebase/firestore/add-data">Add Data</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/firebase/firestore/transactions-and-batched-writes">Transactions and batched writes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/firebase/firestore/delete-data">Delete data</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Query data</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Security</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/firebase/firestore/enable-offline-data">Enable offline data</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Further reading</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Storage</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Quality</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Crashlytics</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Performance Monitoring</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Grow</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Cloud Messaging</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Remote Config</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Dynamic Links</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Migration Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Other</a></li></ul></nav></div></aside><main class="docMainContainer_3Zec"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2q91"><div class="docItemContainer_37q2"><article><div class="tocCollapsible_3moT tocMobile_2bxg"><button type="button" class="clean-btn tocCollapsibleButton_3OYu">On this page</button></div><div class="markdown"><header><h1>Firestore - Transactions and batched writes</h1></header><p>Cloud Firestore supports atomic operations for reading and writing data. In a set of atomic operations, either all of the operations succeed, or none of them are applied. There are two types of atomic operations in Cloud Firestore:</p><ul><li>Transactions: a transaction is a set of read and write operations on one or more documents.</li><li>Batched Writes: a batched write is a set of write operations on one or more documents.</li></ul><p>Each transaction or batch of writes can write to a maximum of 500 documents. For additional limits related to writes, see <a href="https://firebase.google.com/docs/firestore/quotas#writes_and_transactions" target="_blank" rel="noopener noreferrer">Quotas and Limits</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="updating-data-with-transactions"></a>Updating data with transactions<a class="hash-link" href="#updating-data-with-transactions" title="Direct link to heading">#</a></h2><p>Using the Cloud Firestore client libraries, you can group multiple operations into a single transaction. Transactions are useful when you want to update a field&#x27;s value based on its current value, or the value of some other field. You could increment a counter by creating a transaction that reads the current value of the counter, increments it, and writes the new value to Cloud Firestore.</p><p>A transaction consists of any number of <code>getDocument()</code> operations followed by any number of write operations such as <code>setDocument()</code>, <code>update()</code>, or <code>deleteDocument()</code>. In the case of a concurrent edit, Cloud Firestore runs the entire transaction again. For example, if a transaction reads documents and another client modifies any of those documents, Cloud Firestore retries the transaction. This feature ensures that the transaction runs on up-to-date and consistent data.</p><p>Transactions never partially apply writes. All writes execute at the end of a successful transaction.</p><p>When using transactions, note that:</p><ul><li>Read operations must come before write operations.</li><li>A function calling a transaction (transaction function) might run more than once if a concurrent edit affects a document that the transaction reads.</li><li>Transaction functions should not directly modify application state.</li><li>Transactions will fail when the client is offline.</li></ul><p>The following example shows how to create and run a transaction:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">var transaction:Transaction = FirebaseFirestore.service.runTransaction(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        function( transaction:Transaction ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            trace( &quot;apply( transaction )&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Perform transaction operations - may be called multiple times to re-run the transaction</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // You must call finish or abort to complete the transaction</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            transaction.finish();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction.addEventListener( TransactionEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction.addEventListener( TransactionEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function successHandler( event:TransactionEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;success&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function failedHandler( event:TransactionEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;failed: &quot; + event.message );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h3><p>This example loads a &quot;user&quot;, updates the user&#x27;s <code>first</code> name and increments a <code>count</code> property, returning the new count in the event</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">var user:DocumentReference = FirebaseFirestore.service.document( &quot;users/12345&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">var transaction:Transaction = FirebaseFirestore.service.runTransaction(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        function( transaction:Transaction ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Read the user document reference</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            transaction.getDocument( user, function( snapshot:DocumentSnapshot, message:String ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (snapshot == null) </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Error</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    transaction.abort();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                else </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Get the user&#x27;s current count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var currentCount:Number = snapshot.getData().count;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var newCount:Number = currentCount + 1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Change the first name with a setDocument merge</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var data:Object = { first: &quot;James&quot; };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    transaction.setDocument( user, data, SetOptions.merge(), function( snapshot:DocumentSnapshot, message:String ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // Update count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        transaction.update( user, { count: newCount }, function( snapshot:DocumentSnapshot, message:String ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            // Finish the transaction</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            transaction.finish();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><blockquote><p>Note: the <code>setDocument()</code> and <code>update()</code> calls probably could be combined in this example, but we just wanted to demonstrate the functionality.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="passing-information-out-of-transactions"></a>Passing information out of transactions<a class="hash-link" href="#passing-information-out-of-transactions" title="Direct link to heading">#</a></h3><p>Do not modify application state inside of your transaction functions. Doing so will introduce concurrency issues, because transaction functions can run multiple times and are not guaranteed to run on the UI thread. Instead, pass information you need out of your transaction functions. The following example builds on the previous example to show how to pass information out of a transaction:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">var user:DocumentReference = FirebaseFirestore.service.document( &quot;users/12345&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">var transaction:Transaction = FirebaseFirestore.service.runTransaction(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        function( transaction:Transaction ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Read the user document reference</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            transaction.getDocument( user, function( snapshot:DocumentSnapshot, message:String ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (snapshot == null) </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Error</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    transaction.abort();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                else </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Get the user&#x27;s current count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var currentCount:Number = snapshot.getData().count;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var newCount:Number = currentCount + 1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                                </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Change the first name with a setDocument merge</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    var data:Object = { first: &quot;James&quot; };</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    transaction.setDocument( user, data, SetOptions.merge(), function( snapshot:DocumentSnapshot, message:String ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // Update count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        transaction.update( user, { count: newCount }, function( snapshot:DocumentSnapshot, message:String ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            // Finish the transaction - returning the new count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                            transaction.finish( newCount );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                        });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction.addEventListener( TransactionEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction.addEventListener( TransactionEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function successHandler( event:TransactionEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;success&quot; ); </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // event.data will contain the Object passed to finish</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    var count:Number = Number(event.data);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function failedHandler( event:TransactionEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;failed: &quot; + event.message );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( TransactionEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_1iPN" id="transaction-failure"></a>Transaction failure<a class="hash-link" href="#transaction-failure" title="Direct link to heading">#</a></h3><p>A transaction can fail for the following reasons:</p><ul><li>The transaction contains read operations after write operations. Read operations must always come before any write operations.</li><li>The transaction read a document that was modified outside of the transaction. In this case, the transaction automatically runs again. The transaction is retried a finite number of times.</li></ul><p>A failed transaction returns an error and does not write anything to the database. You do not need to roll back the transaction; Cloud Firestore does this automatically.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_1iPN" id="batched-writes"></a>Batched writes<a class="hash-link" href="#batched-writes" title="Direct link to heading">#</a></h2><p>If you do not need to read any documents in your operation set, you can execute multiple write operations as a single batch that contains any combination of set(), update(), or delete() operations. A batch of writes completes atomically and can write to multiple documents.</p><p>Batched writes are also useful for migrating large data sets to Cloud Firestore. A batched write can contain up to 500 operations and batching operations together reduces connection overhead resulting in faster data migration.</p><p>Batched writes have fewer failure cases than transactions and use simpler code. They are not affected by contention issues, because they don&#x27;t depend on consistently reading any documents. Batched writes execute even when the user&#x27;s device is offline. The following example shows how to build and commit a batch of writes:</p><div class="codeBlockContainer_21wf"><div class="codeBlockContent_1izB actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_1uaJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_3_dS"><span class="token-line" style="color:#393A34"><span class="token plain">var batch:WriteBatch = FirebaseFirestore.service.batch();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">batch.addEventListener( WriteBatchEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">batch.addEventListener( WriteBatchEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">var ref:DocumentReference = FirebaseFirestore.service.document( &quot;document/path&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">batch.setDocument( ref, { name: &quot;Hector&quot; } );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">batch.update( ref, { count: 10000 } );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">batch.commit();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function successHandler( event:WriteBatchEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;success&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( WriteBatchEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( WriteBatchEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">function failedHandler( event:WriteBatchEvent ):void</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;failed: &quot; + event.message );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( WriteBatchEvent.SUCCESS, successHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    event.currentTarget.removeEventListener( WriteBatchEvent.FAILED, failedHandler );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3XUZ clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/firebase/firestore/add-data"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Add Data</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/firebase/firestore/delete-data"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Delete data »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_2pwG thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#updating-data-with-transactions" class="table-of-contents__link">Updating data with transactions</a><ul><li><a href="#example" class="table-of-contents__link">Example</a></li><li><a href="#passing-information-out-of-transactions" class="table-of-contents__link">Passing information out of transactions</a></li><li><a href="#transaction-failure" class="table-of-contents__link">Transaction failure</a></li></ul></li><li><a href="#batched-writes" class="table-of-contents__link">Batched writes</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Gamua/Adobe-Runtime-Support/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>AIR discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.starling-framework.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>starling<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>stack overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">news</a></li><li class="footer__item"><a href="https://airnativeextensions.com/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://airnativeextensions.com/license" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>license<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_37dV"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><br><a href="https://airnativeextensions.com">airnativeextensions.com</a> copyright © 2021 <br><br><a href="https://distriqt.com"><img src="/img/logo.png" alt="distriqt"></a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b85ecf5b.js"></script>
<script src="/assets/js/main.9f6f4e02.js"></script>
</body>
</html>