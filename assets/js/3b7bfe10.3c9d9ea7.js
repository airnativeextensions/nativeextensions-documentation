"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[58193],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),m=o,g=d["".concat(c,".").concat(m)]||d[m]||u[m]||r;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[d]="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},90530:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(87462),o=(n(67294),n(3905));const r={title:"Firebase Cloud Message",sidebar_label:"Firebase Cloud Message"},i=void 0,s={unversionedId:"pushnotifications/firebase/firebase-cloud-message",id:"pushnotifications/firebase/firebase-cloud-message",title:"Firebase Cloud Message",description:"HTTP v1 API",source:"@site/docs/pushnotifications/firebase/firebase-cloud-message.md",sourceDirName:"pushnotifications/firebase",slug:"/pushnotifications/firebase/firebase-cloud-message",permalink:"/docs/pushnotifications/firebase/firebase-cloud-message",draft:!1,tags:[],version:"current",frontMatter:{title:"Firebase Cloud Message",sidebar_label:"Firebase Cloud Message"},sidebar:"pushnotifications",previous:{title:"iOS APNS Message",permalink:"/docs/pushnotifications/apple/ios-apns-message"},next:{title:"Windows WNS Message",permalink:"/docs/pushnotifications/windows/windows-wns-message"}},c={},l=[{value:"HTTP v1 API",id:"http-v1-api",level:2},{value:"Migrate from legacy API",id:"migrate-from-legacy-api",level:3},{value:"FCM legacy APIs for HTTP",id:"fcm-legacy-apis-for-http",level:2},{value:"PHP Example",id:"php-example",level:3}],p={toc:l},d="wrapper";function u(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"http-v1-api"},"HTTP v1 API"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"As with the legacy APIs, HTTP v1 messages must be sent through a trusted environment such as your app server or Cloud Functions for Firebase using the HTTP protocol or the Admin SDK to build message requests. Sending directly from client app logic carries extreme security risk and is not supported.")),(0,o.kt)("p",null,"Here we will create a simple Node.js app to send a message to a registration id. "),(0,o.kt)("p",null,'Firstly you\'ll need to get your service account details to authorise requests to Firebase from your server. In the Firebase console under "Project settings" you will find the "Service accounts" section. Download the json file and place it in your project root (we have used the filename ',(0,o.kt)("inlineCode",{parentName:"p"},"service-account.json")," in the following example)."),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(98348).Z,width:"1443",height:"994"})),(0,o.kt)("p",null,"Next install the official node package for firebase:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"npm install firebase-admin\n")),(0,o.kt)("p",null,"Add the following code (",(0,o.kt)("inlineCode",{parentName:"p"},"send.js"),") to load your service account and send a push notification to the specified registration token:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="send.js"',title:'"send.js"'},'const admin = require("firebase-admin");\nconst serviceAccount = require("./service-account.json");\n\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount),\n});\n\n\nconst registrationToken = "YOUR_DEVICE_ID_TOKEN";\n\nconst message = {\n  notification: {\n    body: "a default notification",\n    title: "default title",\n  },\n  token: registrationToken,\n};\n\n// Send a message to the device corresponding to the provided\n// registration token.\nadmin.messaging()\n  .send(message)\n  .then((response) => {\n    // Response is a message ID string.\n    console.log("Successfully sent message:", response);\n  })\n  .catch((error) => {\n    console.log("Error sending message:", error);\n  });\n')),(0,o.kt)("p",null,"Update the ",(0,o.kt)("inlineCode",{parentName:"p"},"registrationToken")," from the application running on your test device and send the notification by calling:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"node send.js\n")),(0,o.kt)("p",null,"You should see a success message like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Successfully sent message: projects/distriqt-test-ios/messages/0:1721878990106292%32d7332f32d7332f\n")),(0,o.kt)("p",null,"and the notification should appear on your device."),(0,o.kt)("h3",{id:"migrate-from-legacy-api"},"Migrate from legacy API"),(0,o.kt)("p",null,"If you are looking to migrate from the legacy FCM APIs to HTTP v1, Google have created a guide here: ",(0,o.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/migrate-v1"},"https://firebase.google.com/docs/cloud-messaging/migrate-v1")),(0,o.kt)("h2",{id:"fcm-legacy-apis-for-http"},"FCM legacy APIs for HTTP"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This is now deprecated. See the notes on ",(0,o.kt)("a",{parentName:"p",href:"#migrate-from-legacy-api"},"migrating the to HTTP v1 API"),".")),(0,o.kt)("p",null,"Sending a message with Firebase is very similar (if not exactly the same) as GCM apart from the endpoint. "),(0,o.kt)("p",null,"Firebase Cloud Messaging has a server-side APIs that you can call to send messages.\nSee ",(0,o.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/server"},"https://firebase.google.com/docs/cloud-messaging/server"),"."),(0,o.kt)("p",null,"Sending a message can be as simple as using curl to call a HTTP end-point.\nSee ",(0,o.kt)("a",{parentName:"p",href:"https://firebase.google.com/docs/cloud-messaging/server#implementing-http-connection-server-protocol"},"https://firebase.google.com/docs/cloud-messaging/server#implementing-http-connection-server-protocol")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'curl -X POST --header "Authorization: key=<API_ACCESS_KEY>" --Header "Content-Type: application/json" https://fcm.googleapis.com/fcm/send -d "{\\"to\\":\\"<YOUR_DEVICE_ID_TOKEN>\\",\\"notification\\":{\\"body\\":\\"Yellow\\"},\\"priority":10}"\n')),(0,o.kt)("h3",{id:"php-example"},"PHP Example"),(0,o.kt)("p",null,"Simple PHP script demonstrating the same:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$registrationId = \"YOUR_DEVICE_ID_TOKEN\";\n$apiKey = \"API_ACCESS_KEY\";\n\n$dataPayload = array(\n    'notification' => array(\n        'icon' => 'ic_utrofi_notification',\n        'alert' => \"ticker text 2\", \n        'title' => \"content title 2\", \n        'body' => \"body copy 2\",\n        'sound' => 'default'\n));\n\n$response = sendNotification( \n    $apiKey, \n    array($registrationId), \n    $dataPayload,\n    null\n);\necho $response;\n\n\n////////////////////////////////////////////////////////////////////////////////\n//  \n//\n\n/**\n * The following function will send a FCM notification using curl.\n * \n * @param $apiKey               [string]    The Browser API key string for your GCM account\n * @param $registrationIdsArray [array]     An array of registration ids to send this notification to\n * @param $messageData          [array]     An named array of data to send as the notification payload\n */\nfunction sendNotification( $apiKey, $registrationIdsArray, $customData, $notification  )\n{\n    $headers = array(\"Content-Type:\" . \"application/json\", \"Authorization:\" . \"key=\" . $apiKey);\n    $data = array(\n        'registration_ids' => $registrationIdsArray,\n    );\n    if ($customData != null)    $data['data'] = $customData;\n    if ($notification != null)  $data['notification'] = $notification;\n\n    $post = json_encode($data);\n    \n    print( $post );\n\n    $ch = curl_init();\n\n    curl_setopt( $ch, CURLOPT_HTTPHEADER, $headers ); \n    curl_setopt( $ch, CURLOPT_URL, \"https://fcm.googleapis.com/fcm/send\" );\n    curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, 0 );\n    curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, 0 );\n    curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );\n    curl_setopt( $ch, CURLOPT_POSTFIELDS, $post );\n\n    $response = curl_exec($ch);\n    curl_close($ch);\n\n    return $response;\n}\n\n\n")))}u.isMDXComponent=!0},98348:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/fcm-service-account-2d77c5d91e7aaecd3959b2c20b5b2262.png"}}]);