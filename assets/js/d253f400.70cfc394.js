"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[6729],{3905:function(e,a,n){n.d(a,{Zo:function(){return c},kt:function(){return p}});var t=n(67294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=t.createContext({}),u=function(e){var a=t.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},c=function(e){var a=u(e.components);return t.createElement(s.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},m=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),m=u(n),p=r,f=m["".concat(s,".").concat(p)]||m[p]||d[p]||i;return n?t.createElement(f,l(l({ref:a},c),{},{components:n})):t.createElement(f,l({ref:a},c))}));function p(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in a)hasOwnProperty.call(a,s)&&(o[s]=a[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:function(e,a,n){n.d(a,{Z:function(){return l}});var t=n(67294),r=n(86010),i="tabItem_Ymn6";function l(e){var a=e.children,n=e.hidden,l=e.className;return t.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,l),hidden:n},a)}},74866:function(e,a,n){n.d(a,{Z:function(){return E}});var t=n(87462),r=n(67294),i=n(86010),l=n(12466),o=n(16550),s=n(91980),u=n(67392),c=n(50012);function d(e){return function(e){var a,n;return null!=(a=null==(n=r.Children.map(e,(function(e){if(!e||(0,r.isValidElement)(e)&&(a=e.props)&&"object"==typeof a&&"value"in a)return e;var a;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?a:[]}(e).map((function(e){var a=e.props;return{value:a.value,label:a.label,attributes:a.attributes,default:a.default}}))}function m(e){var a=e.values,n=e.children;return(0,r.useMemo)((function(){var e=null!=a?a:d(n);return function(e){var a=(0,u.l)(e,(function(e,a){return e.value===a.value}));if(a.length>0)throw new Error('Docusaurus error: Duplicate values "'+a.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[a,n])}function p(e){var a=e.value;return e.tabValues.some((function(e){return e.value===a}))}function f(e){var a=e.queryString,n=void 0!==a&&a,t=e.groupId,i=(0,o.k6)(),l=function(e){var a=e.queryString,n=void 0!==a&&a,t=e.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,s._X)(l),(0,r.useCallback)((function(e){if(l){var a=new URLSearchParams(i.location.search);a.set(l,e),i.replace(Object.assign({},i.location,{search:a.toString()}))}}),[l,i])]}function v(e){var a,n,t,i,l=e.defaultValue,o=e.queryString,s=void 0!==o&&o,u=e.groupId,d=m(e),v=(0,r.useState)((function(){return function(e){var a,n=e.defaultValue,t=e.tabValues;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+t.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var r=null!=(a=t.find((function(e){return e.default})))?a:t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:l,tabValues:d})})),h=v[0],g=v[1],y=f({queryString:s,groupId:u}),b=y[0],k=y[1],A=(a=function(e){return e?"docusaurus.tab."+e:null}({groupId:u}.groupId),n=(0,c.Nk)(a),t=n[0],i=n[1],[t,(0,r.useCallback)((function(e){a&&i.set(e)}),[a,i])]),E=A[0],N=A[1],T=function(){var e=null!=b?b:E;return p({value:e,tabValues:d})?e:null}();return(0,r.useLayoutEffect)((function(){T&&g(T)}),[T]),{selectedValue:h,selectValue:(0,r.useCallback)((function(e){if(!p({value:e,tabValues:d}))throw new Error("Can't select invalid tab value="+e);g(e),k(e),N(e)}),[k,N,d]),tabValues:d}}var h=n(72389),g="tabList__CuJ",y="tabItem_LNqP";function b(e){var a=e.className,n=e.block,o=e.selectedValue,s=e.selectValue,u=e.tabValues,c=[],d=(0,l.o5)().blockElementScrollPositionUntilNextRender,m=function(e){var a=e.currentTarget,n=c.indexOf(a),t=u[n].value;t!==o&&(d(a),s(t))},p=function(e){var a,n=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":var t,r=c.indexOf(e.currentTarget)+1;n=null!=(t=c[r])?t:c[0];break;case"ArrowLeft":var i,l=c.indexOf(e.currentTarget)-1;n=null!=(i=c[l])?i:c[c.length-1]}null==(a=n)||a.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},a)},u.map((function(e){var a=e.value,n=e.label,l=e.attributes;return r.createElement("li",(0,t.Z)({role:"tab",tabIndex:o===a?0:-1,"aria-selected":o===a,key:a,ref:function(e){return c.push(e)},onKeyDown:p,onClick:m},l,{className:(0,i.Z)("tabs__item",y,null==l?void 0:l.className,{"tabs__item--active":o===a})}),null!=n?n:a)})))}function k(e){var a=e.lazy,n=e.children,t=e.selectedValue,i=(Array.isArray(n)?n:[n]).filter(Boolean);if(a){var l=i.find((function(e){return e.props.value===t}));return l?(0,r.cloneElement)(l,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},i.map((function(e,a){return(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==t})})))}function A(e){var a=v(e);return r.createElement("div",{className:(0,i.Z)("tabs-container",g)},r.createElement(b,(0,t.Z)({},e,a)),r.createElement(k,(0,t.Z)({},e,a)))}function E(e){var a=(0,h.Z)();return r.createElement(A,(0,t.Z)({key:String(a)},e))}},47857:function(e,a,n){n.r(a),n.d(a,{assets:function(){return m},contentTitle:function(){return c},default:function(){return v},frontMatter:function(){return u},metadata:function(){return d},toc:function(){return p}});var t=n(87462),r=n(63366),i=(n(67294),n(3905)),l=n(74866),o=n(85162),s=["components"],u={title:"Alarm Manager",sidebar_label:"Alarm Manager"},c=void 0,d={unversionedId:"application/alarm-manager",id:"application/alarm-manager",title:"Alarm Manager",description:"The Alarm Manager functionality allows you to use the Android Alarm manager to set your application to receive events",source:"@site/docs/application/alarm-manager.mdx",sourceDirName:"application",slug:"/application/alarm-manager",permalink:"/docs/application/alarm-manager",draft:!1,tags:[],version:"current",frontMatter:{title:"Alarm Manager",sidebar_label:"Alarm Manager"},sidebar:"application",previous:{title:"Soft Keyboard",permalink:"/docs/application/display/soft-keyboard"},next:{title:"Auto Start",permalink:"/docs/application/auto-start"}},m={},p=[{value:"Android: Manifest Additions",id:"android-manifest-additions",level:2},{value:"Checking Availability",id:"checking-availability",level:2},{value:"Register for Events",id:"register-for-events",level:2},{value:"Creating an Alarm",id:"creating-an-alarm",level:2},{value:"Cancelling an Alarm",id:"cancelling-an-alarm",level:2},{value:"Cancel by ID",id:"cancel-by-id",level:3},{value:"Cancel by Alarm",id:"cancel-by-alarm",level:3},{value:"Cancel All Alarms",id:"cancel-all-alarms",level:2},{value:"Exact Alarms",id:"exact-alarms",level:2},{value:"Exact Alarm Permissions",id:"exact-alarm-permissions",level:3}],f={toc:p};function v(e){var a=e.components,n=(0,r.Z)(e,s);return(0,i.kt)("wrapper",(0,t.Z)({},f,n,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The Alarm Manager functionality allows you to use the Android Alarm manager to set your application to receive events\nat a particular time. It also allows you to launch your application into the foreground if you require. "),(0,i.kt)("h2",{id:"android-manifest-additions"},"Android: Manifest Additions"),(0,i.kt)("p",null,"There are some manifest additions required for this functionality, add the following to your manifest.\nThere are two receivers and an activity required.\nThe first receiver is required to restore alarms after a reboot and the second to actually receive the alarms."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<manifest android:installLocation="auto">\n    <uses-permission android:name="android.permission.INTERNET"/>\n    <uses-permission android:name="android.permission.WAKE_LOCK" />\n    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />\n    \n    <application>\n        <receiver android:enabled="true" android:name="com.distriqt.extension.application.receivers.ApplicationStartupReceiver" android:permission="android.permission.RECEIVE_BOOT_COMPLETED">\n            <intent-filter>\n                <action android:name="android.intent.action.BOOT_COMPLETED" />\n                <category android:name="android.intent.category.DEFAULT" />\n            </intent-filter>\n        </receiver>\n        \n        <receiver android:name="com.distriqt.extension.application.alarms.AlarmReceiver" android:enabled="true" />\n        <activity android:name="com.distriqt.extension.application.alarms.AlarmActivity" android:theme="@android:style/Theme.Translucent.NoTitleBar" />\n        \n    </application>\n        \n</manifest>\n')),(0,i.kt)("h2",{id:"checking-availability"},"Checking Availability"),(0,i.kt)("p",null,"You should check whether the alarm manager functionality is available on the current device\nbefore attempting to use any of the functions below. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"if (Application.service.alarmManager.isSupported) \n{\n    // AlarmManager functionality is available\n}\n")),(0,i.kt)("p",null,"The Alarm Manager will not be available on some platforms eg iOS does not currently support this functionality. "),(0,i.kt)("h2",{id:"register-for-events"},"Register for Events"),(0,i.kt)("p",null,"Next you will need to do is add an event listener for the alarm events and register for the events.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmEvent.ALARM")," is dispatched whenever an alarm occurs. "),(0,i.kt)("p",null,"Calling ",(0,i.kt)("inlineCode",{parentName:"p"},"register()")," will not only register for alarms but also check if the application was launched from an alarm,\nso an alarm event may be dispatched immediately after a call to this function. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},'Application.service.alarmManager.addEventListener( AlarmEvent.ALARM, alarmHandler );\nApplication.service.alarmManager.register();\n\n...\n\nprivate function alarmHandler( event:AlarmEvent ):void\n{\n    trace( "alarmHandler: ["+event.id+ "] "+event.data );\n}\n')),(0,i.kt)("h2",{id:"creating-an-alarm"},"Creating an Alarm"),(0,i.kt)("p",null,"To create an Alarm you use the ",(0,i.kt)("inlineCode",{parentName:"p"},"setAlarm")," function of the ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmManager")," and an ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmBuilder"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmBuilder")," is a helper class giving you the easy ability to setup an alarm correctly. "),(0,i.kt)("p",null,"You can pass a String as the data of the alarm that will be returned in the alarm event.\nThis can be used to distinguish which alarm occurred in your application.\nWe suggest using an stringified JSON Object as below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},'var data:Object = {};\ndata.id = Math.floor(100*Math.random());\ndata.message = "a distriqt alarm";\n\nvar timestamp:Number = new Date().time + 10000 ;\n\nApplication.service.alarmManager.setAlarm( \n    new AlarmBuilder()\n        .setId( data.id )\n        .setTime( timestamp )\n        .setData( JSON.stringify( data ))\n        .setWillLaunchApplication()\n        .build()\n);\n')),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"setAlarm")," may return ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," if some of the parameters in the alarm are not supported on the current device.\nThis is particularly relevant for exact alarms on Android 12+")),(0,i.kt)("h2",{id:"cancelling-an-alarm"},"Cancelling an Alarm"),(0,i.kt)("h3",{id:"cancel-by-id"},"Cancel by ID"),(0,i.kt)("p",null,"The simplest way to cancel an alarm is to cancel the alarm by the ID of the alarm:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"Application.service.alarmManager.cancelAlarmById( id );\n")),(0,i.kt)("p",null,"This id should be the same as the id passed to your ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmBuilder.setId( )")," call."),(0,i.kt)("h3",{id:"cancel-by-alarm"},"Cancel by Alarm"),(0,i.kt)("p",null,"You can also cancel an alarm using the ",(0,i.kt)("inlineCode",{parentName:"p"},"Alarm")," object that you previously built\nand passing that to the ",(0,i.kt)("inlineCode",{parentName:"p"},"cancelAlarm")," function."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"Application.service.alarmManager.cancelAlarm( alarm );\n")),(0,i.kt)("p",null,"This ",(0,i.kt)("inlineCode",{parentName:"p"},"alarm")," object can either be stored from the setAlarm call or reconstructed using\nan ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmBuilder")," with ",(0,i.kt)("strong",{parentName:"p"},"exactly the same parameters")," as used previously. For example\nmatching the call above:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"Application.service.alarmManager.cancelAlarm(\n    new AlarmBuilder()\n        .setId( data.id )\n        .setTime( timestamp )\n        .setData( JSON.stringify( data ))\n        .setWillLaunchApplication()\n        .build()\n);\n")),(0,i.kt)("h2",{id:"cancel-all-alarms"},"Cancel All Alarms"),(0,i.kt)("p",null,"To cancel all previously set alarms, simply call the ",(0,i.kt)("inlineCode",{parentName:"p"},"cancelAllAlarms")," function."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"Application.service.alarmManager.cancelAllAlarms();\n")),(0,i.kt)("h2",{id:"exact-alarms"},"Exact Alarms"),(0,i.kt)("p",null,"The system invokes an exact alarm at a precise moment in the future.\nUsing exact alarms will affect the performance and battery life of the device so you are suggested to use them only if necessary. "),(0,i.kt)("p",null,"To set an exact alarm, call ",(0,i.kt)("inlineCode",{parentName:"p"},"setExact( true )")," on your ",(0,i.kt)("inlineCode",{parentName:"p"},"AlarmBuilder"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"Application.service.alarmManager.cancelAlarm(\n    new AlarmBuilder()\n        .setTime( timestamp )\n        .setExact( true )\n        .build()\n);\n")),(0,i.kt)("h3",{id:"exact-alarm-permissions"},"Exact Alarm Permissions"),(0,i.kt)("p",null,'If your app targets Android 12 (API level 31) or higher, you must declare one of the "Alarms & reminders" permissions; otherwise, a SecurityException occurs and your alarm will not be registered.'),(0,i.kt)("p",null,"To do so, declare the ",(0,i.kt)("inlineCode",{parentName:"p"},"SCHEDULE_EXACT_ALARM")," permission in your manifest additions, as shown in the following code snippet:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM"/>\n')),(0,i.kt)(l.Z,{groupId:"packagemanager",defaultValue:"apm",values:[{label:"APM",value:"apm"},{label:"Manual",value:"manual"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"apm",mdxType:"TabItem"},(0,i.kt)("p",null,"To add these permissions you need to add some additional configuration to apm.\nFirstly add a custom Android configuration file by running:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"apm generate config android\n")),(0,i.kt)("p",null,"Edit the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/android/AndroidManifest.xml")," file that was generated to resemble the following, adding the required permissions, eg:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="utf-8"?>\n<manifest xmlns:android="http://schemas.android.com/apk/res/android" xmlns:tools="http://schemas.android.com/tools">\n\n    <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" />\n\n</manifest>\n')),(0,i.kt)("p",null,"You can add any other additions you require in your application here and these will be merged by ",(0,i.kt)("inlineCode",{parentName:"p"},"apm")," when you generate your application descriptor."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Make sure you regenerate your application descriptor after modifying this file. See the section in ",(0,i.kt)("a",{parentName:"p",href:"/docs/application/add-the-extension#application-descriptor"},"add the extension")," for details."))),(0,i.kt)(o.Z,{value:"manual",mdxType:"TabItem"},(0,i.kt)("p",null,"To manually add permissions to your application, you will need to edit the manifest additions node in your application descriptor.\nFor example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<android>\n  <manifestAdditions><![CDATA[\n    <manifest android:installLocation="auto">\n\n      \x3c!-- PERMISSIONS --\x3e\n      <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM"/>\n\n\n      \x3c!-- OTHER MANIFEST ADDITIONS --\x3e\n\n\n    </manifest>\n  ]]></manifestAdditions>\n</android>\n')))))}v.isMDXComponent=!0}}]);