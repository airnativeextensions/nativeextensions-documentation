(window.webpackJsonp=window.webpackJsonp||[]).push([[293],{1025:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/googleplay_deferredpaymentmethod-ff10ecec41ccc276c3eef4891bfc5b5c.png"},1026:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/googleplay_deferredpaymentmethod_purchase-0cdab7988ee15433061650e89cac1662.png"},348:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return s}));var a=n(2),r=(n(0),n(807));const i={title:"Testing",sidebar_label:"Testing"},o={unversionedId:"inappbilling/testing",id:"inappbilling/testing",isDocsHomePage:!1,title:"Testing",description:"Test each part of your code to verify that you\u2019ve implemented it correctly.",source:"@site/docs/inappbilling/testing.md",slug:"/inappbilling/testing",permalink:"/docs/inappbilling/testing",version:"current",sidebar_label:"Testing",sidebar:"inappbilling",previous:{title:"Migration",permalink:"/docs/inappbilling/migration"},next:{title:"apple.Testing iOS Subscriptions",permalink:"/docs/inappbilling/apple.testing-ios-subscriptions"}},c=[{value:"Test a Payment Request",id:"test-a-payment-request",children:[]},{value:"Test a Successful Purchase",id:"test-a-successful-purchase",children:[]},{value:"Cancelation",id:"cancelation",children:[]},{value:"Testing Deferred Purchases",id:"testing-deferred-purchases",children:[]},{value:"Test an Interrupted Purchase",id:"test-an-interrupted-purchase",children:[]},{value:"Verify That Purchases Are Finished",id:"verify-that-purchases-are-finished",children:[]},{value:"Common problems",id:"common-problems",children:[]}],l={rightToc:c};function s({components:e,...t}){return Object(r.b)("wrapper",Object(a.a)({},l,t,{components:e,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Test each part of your code to verify that you\u2019ve implemented it correctly."),Object(r.b)("p",null,"You should try and test as many scenarios as possible to make sure a purchase\nwon't be left in an invalid state. "),Object(r.b)("p",null,"The following is a list of some common ones that you should test."),Object(r.b)("h3",{id:"test-a-payment-request"},"Test a Payment Request"),Object(r.b)("p",null,"Make a call to ",Object(r.b)("inlineCode",{parentName:"p"},"makePurchase")," using a valid product identifier that you have already tested.\nSet a breakpoint and confirm that the purchase success event handler is called."),Object(r.b)("p",null,"During testing, it\u2019s OK to finish the transaction immediately without providing the content.\nHowever, even during testing, failing to finish the purchase can cause problems, unfinished\npurchases can remain in the queue indefinitely, which could interfere with later testing."),Object(r.b)("h3",{id:"test-a-successful-purchase"},"Test a Successful Purchase"),Object(r.b)("p",null,"Use a test user account, and make a purchase in your app. "),Object(r.b)("p",null,"Set a breakpoint at the point in your code that adds the purchase to your users inventory,\nand confirm that this code is called in response to a successful purchase."),Object(r.b)("h3",{id:"cancelation"},"Cancelation"),Object(r.b)("p",null,"Check that when a user cancels the purchase that your application correctly handles the response\nand returns your application to the normal state."),Object(r.b)("p",null,"You will need to handle several scenarios here, including a cancelled purchase and a cancelled error."),Object(r.b)("p",null,"See ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"make-a-purchase#handling-user-cancellations"}),"Handling User Cancellations")," for implementation details."),Object(r.b)("h3",{id:"testing-deferred-purchases"},"Testing Deferred Purchases"),Object(r.b)("h4",{id:"google-play-billing"},"Google Play Billing"),Object(r.b)("p",null,"You will need to target api 28 or higher for deferred purchases. "),Object(r.b)("p",null,"When you go to make a purchase ensure you have deployed at least one version to the a test channel (alpha/beta) and are signed in on your device using a test user."),Object(r.b)("p",null,"Then when the purchase UI is displayed select the payment methods and you should see 4 available options:"),Object(r.b)("p",null,Object(r.b)("img",{src:n(1025).default})),Object(r.b)("p",null,'Select the "Slow test card" and proceed with your test purchase:'),Object(r.b)("p",null,Object(r.b)("img",{src:n(1026).default})),Object(r.b)("p",null,"The purchase will return as deferred and in a few minutes another event will trigger when the purchase succeeds. On the second event you should deliver the product and call finish purchase to acknowledge the purchase."),Object(r.b)("h3",{id:"test-an-interrupted-purchase"},"Test an Interrupted Purchase"),Object(r.b)("p",null,"On some services, purchases can be interrupted, it is important, particularly on iOS that\nyou can handle interrupted transactions."),Object(r.b)("p",null,"Set a breakpoint in your code that adds the purchase to your users inventory so you\ncan control whether it delivers the product. "),Object(r.b)("p",null,"Then make a purchase as usual in the test environment, and use the breakpoint to\ntemporarily ignore the transaction\u2014for example, by returning from the method immediately.\nDo not call ",Object(r.b)("inlineCode",{parentName:"p"},"finishPurchase"),"."),Object(r.b)("p",null,"Terminate and relaunch your app. "),Object(r.b)("p",null,"The extension should dispatch the ",Object(r.b)("inlineCode",{parentName:"p"},"PURCHASES_UPDATED")," event when you call ",Object(r.b)("inlineCode",{parentName:"p"},"setup")," the service\nagain shortly after launch; this time, let your app respond normally. "),Object(r.b)("p",null,"Verify that your app correctly delivers the product and completes the transaction."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"This is only applicable for services that require calling ",Object(r.b)("inlineCode",{parentName:"p"},"finishPurchase"),", mainly the Apple's In-App Purchases.")),Object(r.b)("h3",{id:"verify-that-purchases-are-finished"},"Verify That Purchases Are Finished"),Object(r.b)("p",null,"Locate where your app calls the ",Object(r.b)("inlineCode",{parentName:"p"},"finishPurchase")," method. You should call this whether or not\nthe service you are using requires it."),Object(r.b)("p",null,"Verify that all work related to the transaction has been completed before the method\nis called and that the method is called for every transaction, whether it succeeded or failed."),Object(r.b)("hr",null),Object(r.b)("h2",{id:"common-problems"},"Common problems"),Object(r.b)("p",null,"The following are some common problems encountered with an incorrectly configured application:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"You did not complete all the financial requirements (see ",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://developer.apple.com/library/content/documentation/LanguagesUtilities/Conceptual/iTunesConnect_Guide/Chapters/ManagingContractsandBanking.html#//apple_ref/doc/uid/TP40011225-CH21-SW1"}),'"Managing Agreements, Tax, and Banking"'),")."),Object(r.b)("li",{parentName:"ul"},"You did not use the Provisioning Profile associated with your explicit App ID."),Object(r.b)("li",{parentName:"ul"},"You did not use the correct product identifier in your code. See Technical Q&A, QA1329, 'In App Purchase Product Identifiers' for more information about product identifiers."),Object(r.b)("li",{parentName:"ul"},"You did not clear your In App Purchase products for sale in iTunes Connect."),Object(r.b)("li",{parentName:"ul"},"You might have modified your products, but these changes are not yet available to all the App Store servers."),Object(r.b)("li",{parentName:"ul"},'If you or App Review rejected your most recent binary in iTunes Connect.\nChange the status to "Waiting for Upload" by clicking "Ready to Upload Binary" in iTunes Connect\nand the problem should be resolved after about 10 minutes.')),Object(r.b)("p",null,"The correct order for purchasing a product is as follows:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Select item to purchase"),Object(r.b)("li",{parentName:"ul"},"Purchase confirmation"),Object(r.b)("li",{parentName:"ul"},'User taps "buy"'),Object(r.b)("li",{parentName:"ul"},"iTunes Account Login Alert is displayed")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Note: You should be aware that any process that causes the iTunes login without\nuser interaction will most likely result in your application failing to pass the review guidelines.")))}s.isMDXComponent=!0},807:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return b}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),u=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},h=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),p=u(n),h=a,b=p["".concat(o,".").concat(h)]||p[h]||d[h]||i;return n?r.a.createElement(b,c(c({ref:t},s),{},{components:n})):r.a.createElement(b,c({ref:t},s))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=h;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<i;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);