"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[66701],{3905:function(e,n,t){t.d(n,{Zo:function(){return s},kt:function(){return d}});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=i.createContext({}),p=function(e){var n=i.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},s=function(e){var n=p(e.components);return i.createElement(c.Provider,{value:n},e.children)},I={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(t),d=r,N=u["".concat(c,".").concat(d)]||u[d]||I[d]||a;return t?i.createElement(N,o(o({ref:n},s),{},{components:t})):i.createElement(N,o({ref:n},s))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<a;p++)o[p]=t[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},53617:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return s},default:function(){return u}});var i=t(87462),r=t(63366),a=(t(67294),t(3905)),o=["components"],l={title:"Packaging",sidebar_label:"Packaging"},c=void 0,p={unversionedId:"dynamicicon/packaging",id:"dynamicicon/packaging",title:"Packaging",description:"In order to change the contents of your IPA after packaging, we need to extract the IPA, change the contents (in particular the Info.plist file) and then importantly package and sign the IPA again.",source:"@site/docs/dynamicicon/packaging.md",sourceDirName:"dynamicicon",slug:"/dynamicicon/packaging",permalink:"/docs/dynamicicon/packaging",tags:[],version:"current",frontMatter:{title:"Packaging",sidebar_label:"Packaging"},sidebar:"dynamicicon",previous:{title:"Change Icon",permalink:"/docs/dynamicicon/change-icon"},next:{title:"changelog",permalink:"/docs/dynamicicon/changelog"}},s=[{value:"<code>resign</code>",id:"resign",children:[],level:2}],I={toc:s};function u(e){var n=e.components,t=(0,r.Z)(e,o);return(0,a.kt)("wrapper",(0,i.Z)({},I,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In order to change the contents of your IPA after packaging, we need to extract the IPA, change the contents (in particular the ",(0,a.kt)("inlineCode",{parentName:"p"},"Info.plist")," file) and then importantly package and ",(0,a.kt)("strong",{parentName:"p"},"sign")," the IPA again. "),(0,a.kt)("p",null,"If we don't correctly resign the application then it will be rejected by the AppStore (or when installing a debug IPA)."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"resign")," script provided is designed to handle this process, (including extracting your IPA, updating the ",(0,a.kt)("inlineCode",{parentName:"p"},"Info.plist")," and resigning the application)."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"IMPORTANT: This script must be run on a macOS machine with Xcode installed and your signing certificate(s) installed into Keychain")),(0,a.kt)("p",null,"Firstly, open the ",(0,a.kt)("inlineCode",{parentName:"p"},"resign")," script. You will need to update the configuration parameters at the top of the script."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"IPA"),": The full path to your application"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PROVISIONING_PROFILE"),": The full path to your mobile provisioning profile "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"SIGNING_IDENTITY"),": The name of the signing identity")),(0,a.kt)("p",null,"Optional:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"INFO_PLIST"),": The full path to your ",(0,a.kt)("inlineCode",{parentName:"li"},"Info.plist")," if you don't place it alongside the script")),(0,a.kt)("p",null,"The paths should be fairly self explanitory. However you get the signing identity string by running the following in a terminal and selecting the name of the appropriate certificate:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"security find-identity -v -p codesigning\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"IMPORTANT: You must ensure you are using the correct mobile provisioning profile and certificate. If you are testing a debug build make sure you are using a developer profile and certificate, and if you are publishing a release make sure you are using the distribution profile and certificate.")),(0,a.kt)("p",null,"Once you have made these changes, run the script in a terminal:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"./resign\n")),(0,a.kt)("p",null,"This will produce an IPA alongside the script named: ",(0,a.kt)("inlineCode",{parentName:"p"},"APPNAME_resigned.ipa")),(0,a.kt)("p",null,"You can then use the IPA produced by the script to either upload to the app store or install on a device for debugging."),(0,a.kt)("h2",{id:"resign"},(0,a.kt)("inlineCode",{parentName:"h2"},"resign")),(0,a.kt)("p",null,"The below is the current ",(0,a.kt)("inlineCode",{parentName:"p"},"resign")," script. You will find this script in the repository as well."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'#!/bin/bash\n\n#####################################\n## CONFIG\n\n# You need to set the values below for your application\n# We suggest they are full paths to the files. \n\n# The path to the ipa generated from your AIR application packaging\nIPA="/path/to/yourApp.ipa"\n\n# The provisioning profile for your application\nPROVISIONING_PROFILE="/path/to/profile.mobileprovision"\n\n# The name of the signing identity. You get this by running the following in a terminal \n# and selecting the name of your certificate:\n# \n# security find-identity -v -p codesigning\nSIGNING_IDENTITY="iPhone Distribution: XXXXXXXXX (XXXXX)"\n\n# \nINFO_PLIST="./Info.plist"\n\n## END CONFIG\n#####################################\n\n\nOUTPUT=.\nWORKING_DIR=.tmp\nWORKING_PROFILE="profile.mobileprovision"\nIPA_NAME=$(basename ${IPA%.*})\n\ncp -f "$PROVISIONING_PROFILE" "$WORKING_PROFILE"\n\nrm -rf "$WORKING_DIR"\nunzip -qq -o $IPA -d $WORKING_DIR\nfind . -iname \'$WORKING_DIR/*.DS_Store\' -delete \n\nrm -rf "$WORKING_DIR/Payload/$APP_NAME/_CodeSignature/"\nrm -f "$WORKING_DIR/Payload/$APP_NAME/embedded.mobileprovision"\n\nAPP_NAME=$(ls -1 $WORKING_DIR/Payload)\n\ncp $INFO_PLIST "$WORKING_DIR/Payload/$APP_NAME/Info.plist"\n\n#####################################\necho "Create Signing Entitlements"\nENTITLEMENTS="$OUTPUT/Entitlements.plist"\nrm -f "$ENTITLEMENTS"\nWORKING_PROFILE_PLIST="$OUTPUT/$WORKING_PROFILE.plist"\nsecurity cms -D -i "$WORKING_PROFILE" > "$WORKING_PROFILE_PLIST"\n\n\nTEAM_IDENTIFIER=$(/usr/libexec/Plistbuddy -c "Print :TeamIdentifier:0" "$WORKING_PROFILE_PLIST")\nAPPLICATION_IDENTIFIER_PREFIX=$(/usr/libexec/Plistbuddy -c "Print :ApplicationIdentifierPrefix:0" "$WORKING_PROFILE_PLIST")\nBUNDLE_IDENTIFIER=$(/usr/libexec/Plistbuddy -c "Print :CFBundleIdentifier" "$WORKING_DIR/Payload/$APP_NAME/Info.plist")\nAPS_ENVIRONMENT=$(/usr/libexec/Plistbuddy -c "Print Entitlements:aps-environment" "$WORKING_PROFILE_PLIST")\nBETA_REPORTS=$(/usr/libexec/Plistbuddy -c "Print Entitlements:beta-reports-active" "$WORKING_PROFILE_PLIST")\nPROVISIONING_GET_TASK_ALLOW=$(/usr/libexec/Plistbuddy -c "Print :Entitlements:get-task-allow" "$WORKING_PROFILE_PLIST")\n\necho "  APP_NAME = $APP_NAME"\necho "  TEAM_IDENTIFIER = $TEAM_IDENTIFIER"\necho "  APPLICATION_IDENTIFIER_PREFIX = $APPLICATION_IDENTIFIER_PREFIX"\necho "  BUNDLE_IDENTIFIER = $BUNDLE_IDENTIFIER"\necho "  APS_ENVIRONMENT = $APS_ENVIRONMENT"\necho "  BETA_REPORTS = $BETA_REPORTS"\necho "  PROVISIONING_GET_TASK_ALLOW = $PROVISIONING_GET_TASK_ALLOW"\n\n\n/usr/libexec/PlistBuddy -c "Add :application-identifier string $APPLICATION_IDENTIFIER_PREFIX.$BUNDLE_IDENTIFIER" "$ENTITLEMENTS"\n/usr/libexec/PlistBuddy -c "Add :get-task-allow bool $PROVISIONING_GET_TASK_ALLOW" "$ENTITLEMENTS"\n/usr/libexec/PlistBuddy -c "Add :keychain-access-groups array" "$ENTITLEMENTS"\n/usr/libexec/PlistBuddy -c "Add :keychain-access-groups:0 string $APPLICATION_IDENTIFIER_PREFIX.$BUNDLE_IDENTIFIER" "$ENTITLEMENTS"\nif [ $APS_ENVIRONMENT ]; then\n    echo "Setting aps-environment=$APS_ENVIRONMENT"\n    /usr/libexec/PlistBuddy -c "Add :aps-environment string $APS_ENVIRONMENT" "$ENTITLEMENTS"\nfi\nif [ $BETA_REPORTS ]; then\n    echo "Setting beta-reports-active=$BETA_REPORTS"\n    /usr/libexec/PlistBuddy -c "Add :beta-reports-active bool $BETA_REPORTS" "$ENTITLEMENTS"\nfi\n\n# Uncomment these lines if you are using AppleSignIn\n#/usr/libexec/PlistBuddy -c "Add :com.apple.developer.applesignin array" "$ENTITLEMENTS"\n#/usr/libexec/PlistBuddy -c "Add :com.apple.developer.applesignin:0 string Default" "$ENTITLEMENTS"\n\n\n#####################################\necho "Sign Frameworks"\n\nfind $WORKING_DIR/Payload/$APP_NAME/Frameworks/ -name "*.framework" -exec codesign --force --sign "$SIGNING_IDENTITY" --generate-entitlement-der {} \\;\n\n\n#####################################\necho "Sign Application"\ncodesign --force --entitlements "$ENTITLEMENTS" --sign "$SIGNING_IDENTITY" "$WORKING_DIR/Payload/$APP_NAME" --verbose\n\n#codesign --verify --verbose --deep --no-strict "$WORKING_DIR/Payload/$APP_NAME"\n\n\nOUTPUT_IPA="$OUTPUT/"$IPA_NAME"_resigned.ipa"\ncd $WORKING_DIR\nzip -q --symlinks --recurse-paths "../.tmp_output.ipa" .\ncd ..\nmv ".tmp_output.ipa" "$OUTPUT_IPA"\n\n\n# Cleanup\nrm -Rf "$WORKING_DIR"\nrm -f "$ENTITLEMENTS" \nrm -f "$WORKING_PROFILE_PLIST"\nrm -f "$WORKING_PROFILE"\n\n#  ideviceinstaller -i "$OUTPUT_IPA"\n')))}u.isMDXComponent=!0}}]);