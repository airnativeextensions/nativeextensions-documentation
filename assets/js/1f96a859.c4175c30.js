"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[17126],{8693:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"pushnotifications/windows/windows-wns-message","title":"Windows WNS Message","description":"In order to send a message to WNS you will need the information you noted from the service setup:","source":"@site/docs/pushnotifications/windows/windows-wns-message.md","sourceDirName":"pushnotifications/windows","slug":"/pushnotifications/windows/windows-wns-message","permalink":"/docs/pushnotifications/windows/windows-wns-message","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Windows WNS Message","sidebar_label":"Windows WNS Message"},"sidebar":"pushnotifications","previous":{"title":"Firebase Cloud Message","permalink":"/docs/pushnotifications/firebase/firebase-cloud-message"},"next":{"title":"Pushy Message","permalink":"/docs/pushnotifications/pushy/pushy-message"}}');var i=s(74848),o=s(28453);const a={title:"Windows WNS Message",sidebar_label:"Windows WNS Message"},c=void 0,r={},l=[{value:"PHP Example",id:"php-example",level:3},{value:"C# Documentation",id:"c-documentation",level:3}];function d(e){const n={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["In order to send a message to WNS you will need the information you noted from the ",(0,i.jsx)(n.a,{href:"windows-notification-service",children:"service setup"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Application Secret"}),', or "client secret";']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Package SID"}),', "or client id".']}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'Using this information you request an "access token" from WNS and then send a notification using this access token to the user\'s "channel uri".'}),"\n",(0,i.jsx)(n.p,{children:'The "channel uri" identifies the user and is used as the destination of a notification. This is returned via the "device token" accessors in this extension.'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-actionscript",children:"var wnsChannelUri:String = PushNotifications.service.getDeviceToken();\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You then place the access token in the authorisation header of a post request to the channel uri, where the content of the request is the ",(0,i.jsx)(n.a,{href:"windows-wns-payload",children:"WNS payload"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"php-example",children:"PHP Example"}),"\n",(0,i.jsx)(n.p,{children:"The following is a simple example of using PHP to send a notification:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n    // SERVICE CONFIG\n    $clientId = 'ms-app://s-1-15-2-XXXXXXXXXX-XXXXXXXXXX-XXXXXXXXX-XXXXXXXXXX-XXXXXXXXXX-XXXXXXXXXX-XXXXXXXXXX';\n    $clientSecret = '/XXYYXXYYXXYYXXYYXXYYXXYYXXYY';\n    \n    // USER - You will need to get this from the device\n    $channelUri = 'https://sg2p.notify.windows.com/?token=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX';\n    \n    //TOAST MESSAGE\n    $toastMessage = \n\"<toast launch='payload=%7B%22test%22%3A%22value%22%7D'>\\\n  <visual lang='en-US'>\\\n    <binding template='ToastGeneric'>\\\n    <image src='https://airnativeextensions.com/images/extensions/icons/ane-pushnotifications-icon.png' placement='appLogoOverride' />\\\n    <text>Test Notification</text>\\\n    <text>A notification sent via WNS</text>\\\n    </binding>\\\n  </visual>\\\n</toast>\"; \n\n\n    ////////////////////////////////////////////////////////////\n    //  GET ACCESS TOKEN\n    //\n\n    $fields = array(  \n        'grant_type' => 'client_credentials',\n        'client_id' => \"$clientId\",\n        'client_secret' => \"$clientSecret\",\n        'scope' => 'notify.windows.com'\n    );\n    $fields_string = \"\";\n    foreach($fields as $key=>$value) { $fields_string .= $key.'='.$value.'&'; }\n    rtrim($fields_string, '&');\n\n    $tokenRequest = curl_init();\n    curl_setopt($tokenRequest, CURLOPT_URL, 'https://login.live.com/accesstoken.srf');\n    curl_setopt($tokenRequest, CURLOPT_HTTPHEADER, array('Content-Type: application/x-www-form-urlencoded'));\n    curl_setopt($tokenRequest, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($tokenRequest, CURLOPT_POST, count($fields));\n    curl_setopt($tokenRequest, CURLOPT_POSTFIELDS, $fields_string);\n\n    $output = json_decode(curl_exec($tokenRequest));\n    curl_close($tokenRequest);\n    $accessToken = $output->{'access_token'};\n\n\n\n    ////////////////////////////////////////////////////////////\n    //  SEND PUSH\n    //\n\n    $sendPush = curl_init();\n\n    $headers = array(\n        'Content-Type: text/xml', \n        \"Content-Length: \" . strlen($toastMessage),\n        \"X-WNS-Type: wns/toast\", \n        \"Authorization: Bearer $accessToken\" \n    );\n\n    curl_setopt($sendPush, CURLOPT_URL, $channelUri );\n    curl_setopt($sendPush, CURLOPT_HEADER, true);\n    curl_setopt($sendPush, CURLOPT_HTTPHEADER, $headers);\n    curl_setopt($sendPush, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($sendPush, CURLOPT_POST, 1);        \n    curl_setopt($sendPush, CURLOPT_POSTFIELDS, $toastMessage);         \n\n    $output = curl_exec($sendPush);\n    curl_close($sendPush);\n    \n?>  \n"})}),"\n",(0,i.jsx)(n.h3,{id:"c-documentation",children:"C# Documentation"}),"\n",(0,i.jsx)(n.p,{children:"Microsoft has documentation on using C# to send a notification here:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/previous-versions/windows/apps/hh868252%28v%3dwin.10%29",children:"https://docs.microsoft.com/en-us/previous-versions/windows/apps/hh868252%28v%3dwin.10%29"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var t=s(96540);const i={},o=t.createContext(i);function a(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);