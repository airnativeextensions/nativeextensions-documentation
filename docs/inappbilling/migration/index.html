<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="air native extensions Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="air native extensions Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="air native extensions" href="/opensearch.xml"><title data-react-helmet="true">Migration | air native extensions</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" property="og:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" property="twitter:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for air native extensions"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Migration | air native extensions"><meta data-react-helmet="true" name="description" content="Version 12.0"><meta data-react-helmet="true" property="og:description" content="Version 12.0"><meta data-react-helmet="true" property="og:url" content="https://docs.airnativeextensions.com/docs/inappbilling/migration"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://docs.airnativeextensions.com/docs/inappbilling/migration"><link rel="stylesheet" href="/styles.dd07ecd4.css">
<link rel="preload" href="/styles.0be24f6f.js" as="script">
<link rel="preload" href="/runtime~main.329f528e.js" as="script">
<link rel="preload" href="/main.8c2b58bd.js" as="script">
<link rel="preload" href="/1.c97d1d98.js" as="script">
<link rel="preload" href="/2.6c2bb4c9.js" as="script">
<link rel="preload" href="/747.692aa4e9.js" as="script">
<link rel="preload" href="/750.3711650b.js" as="script">
<link rel="preload" href="/935f2afb.edf8affd.js" as="script">
<link rel="preload" href="/17896441.c3cf8660.js" as="script">
<link rel="preload" href="/333c39f9.88561aca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="announcementBar_1l0Z" style="background-color:#880000;color:#FFF" role="banner"><div class="announcementBarContent_1xni">This is the new airnativeextensions documentation site and is currently under development. <a href="https://github.com/airnativeextensions/nativeextensions-documentation/issues">Please let us know if you find any issues.</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ane-icon-black.png" alt="AIR Native Extensions"><strong class="navbar__title">AIR Native Extensions</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/news/">News</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx"> </span></div><div class="react-toggle-track-x"><span class="toggle_BsTx"> </span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/ane-icon-black.png" alt="AIR Native Extensions"><strong class="navbar__title">AIR Native Extensions</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/news/">News</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/inappbilling/">InAppBilling</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup your Billing Service</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/apple.apple-in-app-purchases">apple.Apple In-App Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/google.google-play-inapp-billing">google.Google Play InApp Billing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/amazon.amazon-in-app-purchasing">amazon.Amazon In-App Purchasing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/huawei.huawei-appgallery">huawei.Huawei AppGallery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Setup the Extension</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/add-the-extension">Add the Extension</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/billing-service">Billing Service</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Usage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/products">Products</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/make-a-purchase">Make a Purchase</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/pending-purchases">Pending Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/restore-purchases">Restore Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/get-purchases">Get Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/consuming-purchases">Consuming Purchases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/change-a-purchase">Change a Purchase</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/promotions">Promotions</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Subscription Discounts and Offers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/discounts">Discounts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/introductory-prices">Introductory Prices</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">In-App Updates</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/in-app-updates">In App Updates</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Help</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/inappbilling/migration">Migration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/apple.testing-ios-subscriptions">apple.Testing iOS Subscriptions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/amazon.testing-amazon-in-app-purchasing">amazon.Testing Amazon In-App Purchasing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/huawei.testing-huawei-appgallery-purchases">huawei.Testing Huawei AppGallery Purchases</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/server-side-verification">Server Side Verification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/user-data">User Data</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/inappbilling/changelog">changelog</a></li><li class="menu__list-item"><a href="https://docs.airnativeextensions.com/asdocs/inappbilling/" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">asdocs</a></li><li class="menu__list-item"><a href="http://github.com/distriqt/ANE-InAppBilling/issues/new" target="_blank" rel="noreferrer noopener" class="menu__link" tabindex="-1">Contact Support</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Migration</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="version-120"></a>Version 12.0<a aria-hidden="true" tabindex="-1" class="hash-link" href="#version-120" title="Direct link to heading">#</a></h2><p>Version 12 implemented Google Play Billing client library v3.0</p><p>This brings some breaking changes to the developer payload, which is <strong>no longer supported</strong>! Any metadata that you wish to store about a purchase must now be done on a secure backend server that you maintain. You should associate this data with the purchase token (<code>transactionIdentifier</code>).</p><blockquote><p>To ensure metadata is associated in the case of purchase flow interruptions, Google recommends storing the metadata on your backend server prior to launching the purchase dialog and associating it with your user’s account ID, the SKU being purchased, and the current timestamp.</p></blockquote><p>You will still be able to retrieve developer payloads attached to purchases made with previous versions of the library.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="manifest-additions"></a>Manifest Additions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#manifest-additions" title="Direct link to heading">#</a></h3><p>Make sure you add the following to your <code>application</code> node in your android manifest additions:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-xml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta-data</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">com.google.android.play.billingclient.version</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name namespace" style="color:#00a4db;opacity:0.7">android:</span><span class="token tag attr-name" style="color:#00a4db">value</span><span class="token tag attr-value punctuation" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">3.0.0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span></div></div></div></div></div><p>Check <a href="/docs/inappbilling/add-the-extension">Add the Extension</a> for more information.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="in-app-updates"></a>In-App Updates<a aria-hidden="true" tabindex="-1" class="hash-link" href="#in-app-updates" title="Direct link to heading">#</a></h3><p>If you are looking to add In-App Updates make sure you add the additional extensions and manifest additions as outlined in the <a href="/docs/inappbilling/in-app-updates#additional-requirements">documentation</a></p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="version-80"></a>Version 8.0<a aria-hidden="true" tabindex="-1" class="hash-link" href="#version-80" title="Direct link to heading">#</a></h2><p>Version 8 implements the pending purchases and acknowledgement functionality for Google Play Billing that has been recently added, along with the re-implementation of the developer payload.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="google-play-acknowledging-purchases"></a>Google Play Acknowledging Purchases<a aria-hidden="true" tabindex="-1" class="hash-link" href="#google-play-acknowledging-purchases" title="Direct link to heading">#</a></h3><blockquote><p>Google Play supports purchasing products from inside of your app (in-app) or outside of your app (out-of-app). In order for Google Play to ensure a consistent purchase experience regardless of where the user purchases your product, you must acknowledge all purchases received through the Google Play Billing Library as soon as possible after granting entitlement to the user. If you do not acknowledge a purchase within three days, the user automatically receives a refund, and Google Play revokes the purchase. </p></blockquote><p>Purchases that have been completed but not yet acknowledged will be placed into a pending state and be available through the <code>getPendingPurchases()</code> method.</p><p>In order to acknowledge that the purchase has been delivered to the user you call <code>finishPurchase()</code> on any purchases that are pending. We have implemented the acknowledge call in the <code>finishPurchase()</code> method as this should closely resemble the process of how you finish a purchase on iOS. </p><p>These purchases will now be returned by the <code>getPendingPurchases()</code> method <strong>as well as the <code>getPurchases()</code> method</strong>.</p><p>If you have an iOS version of your application already finishing purchases then that logic should remain the same.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="google-play-pending-purchases"></a>Google Play Pending Purchases<a aria-hidden="true" tabindex="-1" class="hash-link" href="#google-play-pending-purchases" title="Direct link to heading">#</a></h3><p>Android&#x27;s &quot;Pending Purchases&quot; are slightly different from the concept on iOS. On Android pending purchases are purchases that <strong>have not yet been made</strong> and have only been initiated, whereas on iOS pending purchases are completed awaiting the developer confirmation (i.e. <code>finishPurchase()</code> call).</p><p>Google Play Billing uses this concept as a deferred payment state.</p><blockquote><p>For example, a user might choose to purchase your in-app product at a physical store using cash. This means that the transaction is completed outside of your app. In this scenario, you should grant entitlement only after the user has completed the transaction.</p><p>For pending transactions (new in version 2.0), the three-day window (for acknowleding the purchase) starts when the purchase has moved to the SUCCESS state and does not apply while the purchase is in a PENDING state.</p></blockquote><p>To better match the concepts across Apple&#x27;s In App Purchases and Google Play Billing, we represent Android Pending Purchases as Deferred Purchases, ie. a purchase will have the state <code>STATE_DEFERRED</code>. </p><p>A deferred purchase means that it has been initiated and is awaiting a further process before it can continue, eg parental approval. We believe this closely matches the Android concept and the logic implemented in your application should already handle this case. The deferred state is really just informing you that the purchase UI process has completed with the user selecting a method that will complete at a later time.</p><blockquote><p>Note: Android Pending Purchases are not returned through the <code>getPendingPurchases()</code> call. Instead you should call <code>getPurchases()</code> and check for any purchases in the <code>Purchase.STATE_DEFERRED</code> state.</p></blockquote><p>You may need to update any logic that delivers products through the <code>getPurchases()</code> call. Previously you could have assumed that every purchase returned through <code>getPurchases()</code> was a product available to the user. You should now ensure you check the state of the purchase is <code>STATE_PURCHASED</code> before delivering a product:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-actionscript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isGetPurchasesSupported</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> PurchaseEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">GET_PURCHASES_COMPLETE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getPurchasesCompleteHandler </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> PurchaseEvent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">GET_PURCHASES_FAILED</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> getPurchasesFailedHandler </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Boolean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getPurchases</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getPurchasesCompleteHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:#393A34">:</span><span class="token parameter">PurchaseEvent</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">each</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter keyword" style="color:#00009f">var</span><span class="token parameter"> purchase</span><span class="token parameter punctuation" style="color:#393A34">:</span><span class="token parameter">Purchase </span><span class="token parameter keyword" style="color:#00009f">in</span><span class="token parameter"> event</span><span class="token parameter punctuation" style="color:#393A34">.</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Check the purchase state</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transactionState </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> Purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">STATE_PURCHASED</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//  Deliver product to user</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="google-play-developer-payload"></a>Google Play Developer Payload<a aria-hidden="true" tabindex="-1" class="hash-link" href="#google-play-developer-payload" title="Direct link to heading">#</a></h3><p>The developer payload has been re-introduced in this version however it is different from using it in the past. It is now only attached when you acknowledge a purchase, rather than when it is initiated. </p><blockquote><p>You can attach a developer payload parameter to a purchase, but only when the purchase is acknowledged or consumed. This is unlike developer payload in the past, where the payload could be specified when launching the purchase flow. Because purchases can now be initiated from outside of your app, this change ensures that you always have an opportunity to add a payload to purchases.</p></blockquote><p>So to attach a developer payload you need to set the payload on a purchase when calling <code>finishPurchase()</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-actionscript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">developerPayload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_payload&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">finishPurchase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> purchase </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>This payload will now be returned in <code>getPurchases()</code> and other purchase related events.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="api-changes"></a>API changes<a aria-hidden="true" tabindex="-1" class="hash-link" href="#api-changes" title="Direct link to heading">#</a></h3><p>We have changed the signature of the consume purchase API to better match other parts of the API. It now takes a <code>Purchase</code> parameter rather than the <code>PurchaseRequest</code>.</p><p>This should be a simple change. Existing code using a request:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-actionscript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PurchaseRequest </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PurchaseRequest </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PurchaseRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setProductId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">productId </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Boolean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">consumePurchase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> request </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>becomes:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-actionscript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Boolean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">consumePurchase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> purchase </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>or if you don&#x27;t have a reference to the <code>Purchase</code> you can just use the product id: </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-actionscript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> success</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">Boolean </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> InAppBilling</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">consumePurchaseByProductId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> productId </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/inappbilling/in-app-updates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« In App Updates</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/inappbilling/testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#version-120" class="table-of-contents__link">Version 12.0</a><ul><li><a href="#manifest-additions" class="table-of-contents__link">Manifest Additions</a></li><li><a href="#in-app-updates" class="table-of-contents__link">In-App Updates</a></li></ul></li><li><a href="#version-80" class="table-of-contents__link">Version 8.0</a><ul><li><a href="#google-play-acknowledging-purchases" class="table-of-contents__link">Google Play Acknowledging Purchases</a></li><li><a href="#google-play-pending-purchases" class="table-of-contents__link">Google Play Pending Purchases</a></li><li><a href="#google-play-developer-payload" class="table-of-contents__link">Google Play Developer Payload</a></li><li><a href="#api-changes" class="table-of-contents__link">API changes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item">twitter</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item">stack overflow</a></li><li class="footer__item"><a href="https://forum.starling-framework.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">starling</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">news</a></li><li class="footer__item"><a href="https://airnativeextensions.com/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">privacy</a></li><li class="footer__item"><a href="https://airnativeextensions.com/license" target="_blank" rel="noopener noreferrer" class="footer__link-item">license</a></li></ul></div></div><div class="text--center"><div><br><a href="https://airnativeextensions.com">airnativeextensions.com</a> copyright © 2020 <br><br><a href="https://distriqt.com"><img src="/img/logo.png" alt="distriqt"></a></div></div></div></footer></div>
<script src="/styles.0be24f6f.js"></script>
<script src="/runtime~main.329f528e.js"></script>
<script src="/main.8c2b58bd.js"></script>
<script src="/1.c97d1d98.js"></script>
<script src="/2.6c2bb4c9.js"></script>
<script src="/747.692aa4e9.js"></script>
<script src="/750.3711650b.js"></script>
<script src="/935f2afb.edf8affd.js"></script>
<script src="/17896441.c3cf8660.js"></script>
<script src="/333c39f9.88561aca.js"></script>
</body>
</html>