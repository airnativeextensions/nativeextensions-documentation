"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[30102],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?r.createElement(h,i(i({ref:t},u),{},{components:n})):r.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(67294),a=n(86010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(o.tabItem,i),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>I});var r=n(87462),a=n(67294),o=n(86010),i=n(12466),l=n(16550),s=n(91980),p=n(67392),u=n(50012);function d(e){return function(e){var t,n;return null!=(t=null==(n=a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?t:[]}(e).map((e=>{let{props:{value:t,label:n,attributes:r,default:a}}=e;return{value:t,label:n,attributes:r,default:a}}))}function c(e){const{values:t,children:n}=e;return(0,a.useMemo)((()=>{const e=null!=t?t:d(n);return function(e){const t=(0,p.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const r=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:t,groupId:n});return[(0,s._X)(o),(0,a.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(r.location.search);t.set(o,e),r.replace({...r.location,search:t.toString()})}),[o,r])]}function v(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,o=c(e),[i,l]=(0,a.useState)((()=>function(e){var t;let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}const a=null!=(t=r.find((e=>e.default)))?t:r[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[s,p]=h({queryString:n,groupId:r}),[d,v]=function(e){let{groupId:t}=e;const n=function(e){return e?"docusaurus.tab."+e:null}(t),[r,o]=(0,u.Nk)(n);return[r,(0,a.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:r}),y=(()=>{const e=null!=s?s:d;return m({value:e,tabValues:o})?e:null})();(0,a.useLayoutEffect)((()=>{y&&l(y)}),[y]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!m({value:e,tabValues:o}))throw new Error("Can't select invalid tab value="+e);l(e),p(e),v(e)}),[p,v,o]),tabValues:o}}var y=n(72389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:n,selectedValue:l,selectValue:s,tabValues:p}=e;const u=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.o5)(),c=e=>{const t=e.currentTarget,n=u.indexOf(t),r=p[n].value;r!==l&&(d(t),s(r))},m=e=>{var t;let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{var r;const t=u.indexOf(e.currentTarget)+1;n=null!=(r=u[t])?r:u[0];break}case"ArrowLeft":{var a;const t=u.indexOf(e.currentTarget)-1;n=null!=(a=u[t])?a:u[u.length-1];break}}null==(t=n)||t.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},p.map((e=>{let{value:t,label:n,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:c},i,{className:(0,o.Z)("tabs__item",g.tabItem,null==i?void 0:i.className,{"tabs__item--active":l===t})}),null!=n?n:t)})))}function f(e){let{lazy:t,children:n,selectedValue:r}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function k(e){const t=v(e);return a.createElement("div",{className:(0,o.Z)("tabs-container",g.tabList)},a.createElement(b,(0,r.Z)({},e,t)),a.createElement(f,(0,r.Z)({},e,t)))}function I(e){const t=(0,y.Z)();return a.createElement(k,(0,r.Z)({key:String(t)},e))}},76158:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>d});var r=n(87462),a=(n(67294),n(3905)),o=n(74866),i=n(85162);const l={title:"Promotions",sidebar_label:"Promotions"},s=void 0,p={unversionedId:"inappbilling/promotions",id:"inappbilling/promotions",title:"Promotions",description:"With iOS 11, users can browse in-app purchases directly on the App Store and start a purchase even before downloading your app.",source:"@site/docs/inappbilling/promotions.mdx",sourceDirName:"inappbilling",slug:"/inappbilling/promotions",permalink:"/docs/inappbilling/promotions",draft:!1,tags:[],version:"current",frontMatter:{title:"Promotions",sidebar_label:"Promotions"},sidebar:"inappbilling",previous:{title:"Change a Purchase",permalink:"/docs/inappbilling/change-a-purchase"},next:{title:"Application Receipt",permalink:"/docs/inappbilling/application-receipt"}},u={},d=[{value:"Checking for Support",id:"checking-for-support",level:2},{value:"Handling Promotion Purchases",id:"handling-promotion-purchases",level:2},{value:"Application State",id:"application-state",level:3},{value:"Testing",id:"testing",level:2},{value:"iOS",id:"ios",level:3},{value:"Customising Promotions",id:"customising-promotions",level:2},{value:"Visibility",id:"visibility",level:3},{value:"Update Visibility",id:"update-visibility",level:3},{value:"Display Order Override",id:"display-order-override",level:3},{value:"Offer Codes",id:"offer-codes",level:2},{value:"Imports",id:"imports",level:2}],c={toc:d},m="wrapper";function h(e){let{components:t,...l}=e;return(0,a.kt)(m,(0,r.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"With iOS 11, users can browse in-app purchases directly on the App Store and start a purchase even before downloading your app.\nPromoted in-app purchases appear on your product page, can display in search results, and may be featured on the Today, Games, and Apps tabs."),(0,a.kt)("p",null,"Promoting in-app purchases can also encourage downloads of your app. When a user doesn\u2019t have your app installed but wants to buy a promoted in-app purchase, they'll receive a prompt to download the app first. Once the app is downloaded, the transaction will continue in the app."),(0,a.kt)("h2",{id:"checking-for-support"},"Checking for Support"),(0,a.kt)("p",null,"You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"isSupported")," flags to check whether the current device (and platform) supports the promotions functionality:"),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"if (InAppBilling.isSupported)\n{\n    if (InAppBilling.service.promotions.isSupported)\n    {\n        // Promotions functionality supported\n    }\n}\n"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"if (InAppBilling.Instance.isSupported)\n{\n    if (InAppBilling.Instance.Promotions.isSupported)\n    {\n        // Promotions functionality supported\n    }\n}\n")))),(0,a.kt)("h2",{id:"handling-promotion-purchases"},"Handling Promotion Purchases"),(0,a.kt)("p",null,"When a user starts an in-app purchase on the App Store, they are taken into your app to continue the transaction."),(0,a.kt)("p",null,"Consider presenting the payment sheet as soon as they are in the app to make the process of completing their purchase as easy as possible. Avoid unnecessary interstitials and messaging, as each extra step you require may decrease the likelihood that the user will complete the purchase."),(0,a.kt)("p",null,"Purchases that are initiated in the Store trigger an event in your application which allows you to decide whether to proceed with the purchase."),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"InAppBilling.service.addEventListener( \n    PurchaseRequestEvent.SHOULD_ADD_PURCHASE, \n    shouldAddPurchaseHandler );\n")),(0,a.kt)("p",null,"You then respond to the request by calling the ",(0,a.kt)("inlineCode",{parentName:"p"},"shouldAddPurchase()")," function, with the ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," property from the event and a ",(0,a.kt)("inlineCode",{parentName:"p"},"Boolean")," flag indicating whether the purchase should be started or cancelled.\nFor example, you may need to cancel a transaction if the user has already unlocked the product they are trying to buy.")),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"InAppBilling.Instance.Events.OnShouldAddPurchase += OnShouldAddPurchase;\n")),(0,a.kt)("p",null,"You then respond to the request by calling the ",(0,a.kt)("inlineCode",{parentName:"p"},"ShouldAddPurchase()")," function, with the ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," property from the event and a flag indicating whether the purchase should be started or cancelled.\nFor example, you may need to cancel a transaction if the user has already unlocked the product they are trying to buy."))),(0,a.kt)("p",null,"If you respond with ",(0,a.kt)("inlineCode",{parentName:"p"},"true")," the purchase flow UI will start, similar to if you make a purchase with a similar purchase request.\nIf you respond ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," the purchase will be cancelled and no UI will be presented."),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"function shouldAddPurchaseHandler( event:PurchaseRequestEvent ):void \n{\n    //\n    //  Do any checks to see whether this should be added to the queue\n    \n    var request:PurchaseRequest = event.request;\n    var shouldAddPurchaseToQueue:Boolean = true;\n            \n    InAppBilling.service.shouldAddPurchase( request, shouldAddPurchaseToQueue );\n}\n"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"private void OnShouldAddPurchase(PurchaseRequestEvent e)\n{\n    //\n    //  Do any checks to see whether this should be added to the queue\n\n    PurchaseRequest request = e.request;\n    bool shouldAddPurchaseToQueue = true;\n    \n    InAppBilling.Instance.ShouldAddPurchase(request, shouldAddPurchaseToQueue);\n}\n")))),(0,a.kt)("p",null,"You can hold onto the ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," property and call the ",(0,a.kt)("inlineCode",{parentName:"p"},"shouldAddPurchase()")," function at a later point if you wish to delay the initiation of the purchase until your application is ready to process the purchase."),(0,a.kt)("p",null,"For example, you may need to defer a transaction if the user is in the middle of onboarding, and continue it after onboarding is completed."),(0,a.kt)("admonition",{title:"Warning",type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"This delay will not work across application restarts or disposal of the extension.")),(0,a.kt)("h3",{id:"application-state"},"Application State"),(0,a.kt)("p",null,"If your app is not installed when the user taps or clicks Buy, the App Store automatically downloads the app or prompts the user to buy it. If the installed version of your app is an older version that doesn\u2019t support in-app purchase promotions, the App Store prompts the user to upgrade the app. If your application is not running, the app will be started."),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("p",null,"When your application was not running you won't immediately receive the ",(0,a.kt)("inlineCode",{parentName:"p"},"PurchaseRequestEvent.SHOULD_ADD_PURCHASE")," event.\nYou should start your application normally and add a listener for the event before you call ",(0,a.kt)("inlineCode",{parentName:"p"},"setup()"),"\n(this is similar to how you should be handling pending purchases with the ",(0,a.kt)("inlineCode",{parentName:"p"},"PurchaseEvent.PURCHASES_UPDATED")," event)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"InAppBilling.service.addEventListener( \n    PurchaseRequestEvent.SHOULD_ADD_PURCHASE, \n    shouldAddPurchaseHandler );\n\n// OTHER EVENT LISTENERS \n\nInAppBilling.service.setup(\n        new BillingService()\n                .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY )\n);\n"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("p",null,"When your application was not running you won't immediately receive the ",(0,a.kt)("inlineCode",{parentName:"p"},"OnShouldAddPurchase")," event.\nYou should start your application normally and add a listener for the event before you call ",(0,a.kt)("inlineCode",{parentName:"p"},"Setup()"),"\n(this is similar to how you should be handling pending purchases with the ",(0,a.kt)("inlineCode",{parentName:"p"},"OnPurchasesUpdated")," event)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"InAppBilling.Instance.Events.OnShouldAddPurchase += OnShouldAddPurchase;\n\n// OTHER EVENT LISTENERS\n\nInAppBilling.Instance.Setup(\n        new BillingService(),\n        (e) =>\n        {\n            // Setup complete\n        }\n);\n")))),(0,a.kt)("p",null,"If your application was started from a promotion purchase you will receive the event after the\nsetup call so you should be prepared to handle it at this stage, or at least prepared to store\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"request")," until your application is ready."),(0,a.kt)("h2",{id:"testing"},"Testing"),(0,a.kt)("h3",{id:"ios"},"iOS"),(0,a.kt)("p",null,"You can open the following link on a device to replicate the promotional purchase (changing the product and bundle ID's appropriately):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"itms-services://?action=purchaseIntent&bundleId=com.example.app&productIdentifier=com.example.product_id\n")),(0,a.kt)("p",null,"Send this URL to yourself in an email or iMessage and open it from your device. You will know the test is running when your app opens automatically. You can then test your promoted in-app purchase."),(0,a.kt)("h2",{id:"customising-promotions"},"Customising Promotions"),(0,a.kt)("p",null,"From your application you can control some aspects of the promotions displayed to your user.\nThis can be useful to emphasise different promotions as your user progresses through your\napplication or game, and to hide promotions that are no longer or not yet applicable to your user."),(0,a.kt)("p",null,"For example, your user may have to reach a certain level in your game before a certain promotion is available to them."),(0,a.kt)("p",null,"The default order and visibility of in-app purchases are set in iTunes Connect. Your overrides are per device, and are not synced to an iCloud account. Note that this feature relies on local device storage, and the API can only run after the app has launched on a device at least once."),(0,a.kt)("p",null,"Implementing these advanced features is optional. They are not required for your in-app purchases to appear on the App Store."),(0,a.kt)("h3",{id:"visibility"},"Visibility"),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("p",null,"To get whether a promotion is visible to a user you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"getStoreVisibility()")," function with the product id of the promotion. This call will dispatch one of two events:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionsEvent.GET_STORE_VISIBILITY_COMPLETE")," on success"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionsEvent.GET_STORE_VISIBILITY_ERROR")," on failure"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("p",null,"To get whether a promotion is visible to a user you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"GetStoreVisibility()")," function with the product id of the promotion. This call will dispatch one of two events:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"OnGetStoreVisibilityComplete")," on success"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"OnGetStoreVisibilityFailed")," on failure")),(0,a.kt)("p",null,"or you can use the callback:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'InAppBilling.Instance.Promotions.GetStoreVisibility(\n    "com.example.product_id",\n    (e) =>\n    {\n        if (e.type == PromotionsEvent.GET_STORE_VISIBILITY_COMPLETE)\n        {\n            // e.visibility contains the visibility property\n        }\n        else\n        {\n            // There was an error \n            trace( e.error );\n        }\n    }\n);\n')))),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"visibility")," property is one of either:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionVisibility.DEFAULT")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionVisibility.SHOW")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionVisibility.HIDE"))),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'InAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.GET_STORE_VISIBILITY_COMPLETE, \n    getStoreVisbility_completeHandler);\nInAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.GET_STORE_VISIBILITY_ERROR, \n    getStoreVisbility_errorHandler);\n\nInAppBilling.service.promotions.getStoreVisibility( "com.example.product_id" );\n\nfunction getStoreVisbility_completeHandler( event:PromotionsEvent ):void \n{\n    // event.visibility contains the visibility property\n}\n\nfunction getStoreVisbility_errorHandler( event:PromotionsEvent ):void \n{\n    // There was an error \n    trace( event.error );\n}\n'))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'InAppBilling.Instance.Promotions.GetStoreVisibility(\n    "com.example.product_id",\n    (e) =>\n    {\n        if (e.type == PromotionsEvent.GET_STORE_VISIBILITY_COMPLETE)\n        {\n            // e.visibility contains the visibility property\n        }\n        else\n        {\n            // There was an error \n            trace( e.error );\n        }\n    }\n);\n')))),(0,a.kt)("h3",{id:"update-visibility"},"Update Visibility"),(0,a.kt)("p",null,"You can change the visibility passing the product id of the promotion and the new visibility value to use to the ",(0,a.kt)("strong",{parentName:"p"},"update store visibility")," method."),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("p",null,"In AIR you use the ",(0,a.kt)("inlineCode",{parentName:"p"},"updateStoreVisibility()")," method to set the visibility of a promotion.\nThis call will dispatch one of two events:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionsEvent.UPDATE_STORE_VISIBILITY_COMPLETE")," on success"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PromotionsEvent.UPDATE_STORE_VISIBILITY_ERROR")," on failure")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'InAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.UPDATE_STORE_VISIBILITY_COMPLETE,\n    updateStoreVisbility_completeHandler );\nInAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.UPDATE_STORE_VISIBILITY_ERROR, \n    updateStoreVisbility_errorHandler );\n\nInAppBilling.service.promotions.updateStoreVisibility( \n    "com.distriqt.example_id", \n    PromotionVisibility.SHOW );\n\nfunction updateStoreVisbility_completeHandler( event:PromotionsEvent ):void \n{\n    // event.visibility contains the visibility property\n}\n\nfunction updateStoreVisbility_errorHandler( event:PromotionsEvent ):void \n{\n    // There was an error \n    trace( event.error );\n} \n'))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("p",null,"In Unity you use the ",(0,a.kt)("inlineCode",{parentName:"p"},"UpdateStoreVisibility()")," method to set the visibility of a promotion.\nThis call will dispatch one of two events:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"OnUpdateStoreVisibilityComplete")," on success"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"OnUpdateStoreVisibilityFailed")," on failure")),(0,a.kt)("p",null,"or you can use the callback:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'InAppBilling.Instance.Promotions.UpdateStoreVisibility(\n    "com.example.product_id",\n    PromotionVisibility.SHOW,\n    (e) =>\n    {\n        if (e.type == PromotionsEvent.UPDATE_STORE_VISIBILITY_COMPLETE)\n        {\n            // e.visibility contains the visibility property\n        }\n        else\n        {\n            // There was an error \n            trace( e.error );\n        }\n    }\n);\n')))),(0,a.kt)("h3",{id:"display-order-override"},"Display Order Override"),(0,a.kt)("p",null,"You can override the order of promoted in-app purchases on the App Store product page, per device.\nFor example, you can promote an in-app purchase product that unlocks a specific level in your game\nwhen a user reaches the level immediately before the specified level."),(0,a.kt)("p",null,"To override the default product order for in-app purchases, put the product identifier for the\nsubset of products you want to reorder into an array, in the order you want them to appear in. "),(0,a.kt)("p",null,"Pass the array to the ",(0,a.kt)("strong",{parentName:"p"},"update store order")," method."),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'var productOrder:Array = [ "com.example.product_1", "com.example.product_2" ];\n                    \nInAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.UPDATE_STORE_ORDER_COMPLETE, \n    updateStoreOrder_completeHandler );\nInAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.UPDATE_STORE_ORDER_ERROR, \n    updateStoreOrder_errorHandler);\n\nInAppBilling.service.promotions.updateStoreOrder( productOrder );\n\nfunction updateStoreOrder_completeHandler( event:PromotionsEvent ):void \n{\n    for each (var productId:String in event.productIdOrder)\n    {\n        trace( "storeOrder: " + productId );\n    }\n}\n\nfunction updateStoreOrder_errorHandler( event:PromotionsEvent ):void \n{\n    // There was an error \n    trace( event.error );\n}\n')),(0,a.kt)("p",null,"To read a product order override as it will appear on a given device, call the ",(0,a.kt)("inlineCode",{parentName:"p"},"getStoreOrder()")," method.\nYou should receive an array of products whose order is overridden.\n",(0,a.kt)("strong",{parentName:"p"},"If you get an empty array, you have not set any overrides and the products are in the default order.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'InAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.GET_STORE_ORDER_COMPLETE, \n    getStoreOrder_completeHandler );\nInAppBilling.service.promotions.addEventListener( \n    PromotionsEvent.GET_STORE_ORDER_ERROR, \n    getStoreOrder_errorHandler);\n    \nInAppBilling.service.promotions.getStoreOrder();\n\nfunction getStoreOrder_completeHandler( event:PromotionsEvent ):void\n{\n    for each (var productId:String in event.productIdOrder)\n    {\n        trace( "storeOrder: " + productId );\n    }\n}\n\nfunction getStoreOrder_errorHandler( event:PromotionsEvent ):void\n{\n    // There was an error \n    trace( event.error );\n}\n'))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var productOrder = new List<string> { "com.example.product_1", "com.example.product_2" };\nInAppBilling.Instance.Promotions.UpdateStoreOrder(\n    productOrder,\n    (e) =>\n    {\n        if (e.type == PromotionsEvent.UPDATE_STORE_ORDER_COMPLETE)\n        {\n            foreach (var productId in e.productIdOrder)\n            {\n                Debug.Log( "storeOrder: " + productId );\n            }\n        }\n        else\n        {\n            // There was an error \n            Debug.Log( e.error );\n        }\n    }\n);\n')),(0,a.kt)("p",null,"To read a product order override as it will appear on a given device, call the ",(0,a.kt)("inlineCode",{parentName:"p"},"GetStoreOrder()")," method.\nYou should receive an array of products whose order is overridden.\n",(0,a.kt)("strong",{parentName:"p"},"If you get an empty array, you have not set any overrides and the products are in the default order.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'InAppBilling.Instance.Promotions.GetStoreOrder(\n    (e) =>\n    {\n        if (e.type == PromotionsEvent.GET_STORE_ORDER_COMPLETE)\n        {\n            foreach (var productId in e.productIdOrder)\n            {\n                Debug.Log( "storeOrder: " + productId );\n            }\n        }\n        else\n        {\n            // There was an error \n            Debug.Log( e.error );\n        }\n    }\n);\n')))),(0,a.kt)("h2",{id:"offer-codes"},"Offer Codes"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(86529).Z,width:"246",height:"533"})),(0,a.kt)("p",null,"Offer codes can help you acquire, retain, and win back subscribers by providing a subscription at a\ndiscount or for free for a limited time. "),(0,a.kt)("p",null,"You'll distribute offer codes using your channels, such as email or offline marketing campaigns.\nConsider which channels might be most effective at reaching your intended customers and be sure to\nmention eligibility or availability limits."),(0,a.kt)("p",null,"You can provide a place in your application to redeem offer codes by presenting the offer code\nredemption dialog via the following:"),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"var success:Boolean = \n  InAppBilling.service.promotions.showCodeRedemptionDialog();\n"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"bool success = \n  InAppBilling.Instance.Promotions.ShowCodeRedemptionDialog();\n")))),(0,a.kt)("p",null,"The value of ",(0,a.kt)("inlineCode",{parentName:"p"},"success")," will be ",(0,a.kt)("inlineCode",{parentName:"p"},"true")," if the redemption dialog is presented or ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," if the current platform / version doesn't support offer codes, eg iOS < 14."),(0,a.kt)("h2",{id:"imports"},"Imports"),(0,a.kt)(o.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"import com.distriqt.extension.inappbilling.promotions.Promotions;\nimport com.distriqt.extension.inappbilling.promotions.PromotionVisibility;\nimport com.distriqt.extension.inappbilling.PurchaseRequest;\nimport com.distriqt.extension.inappbilling.events.PromotionsEvent;\nimport com.distriqt.extension.inappbilling.events.PurchaseRequestEvent;\n"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"using com.distriqt.extension.inappbilling;\nusing com.distriqt.extension.inappbilling.events;\nusing com.distriqt.extension.inappbilling.promotions;\n")))))}h.isMDXComponent=!0},86529:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/ios_showCodeRedemptionDialog-c1b8d78c174fd793e402a5b87eeb1785.jpg"}}]);