"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[30672],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),h=i,y=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return n?r.createElement(y,a(a({ref:t},c),{},{components:n})):r.createElement(y,a({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},20590:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return d}});var r=n(87462),i=n(63366),o=(n(67294),n(3905)),a=["components"],s={title:"Authenticate with a backend server",sidebar_label:"Authenticate with a backend server"},l=void 0,u={unversionedId:"googleidentity/authenticate-with-a-backend-server",id:"googleidentity/authenticate-with-a-backend-server",title:"Authenticate with a backend server",description:"If you use Google Sign-In with an app or site that communicates with a backend server, you might need to identify the currently signed-in user on the server. To do so securely, after a user successfully signs in, send the user's ID token to your server using HTTPS. Then, on the server, verify the integrity of the ID token and use the user information contained in the token to establish a session or create a new account.",source:"@site/docs/googleidentity/authenticate-with-a-backend-server.md",sourceDirName:"googleidentity",slug:"/googleidentity/authenticate-with-a-backend-server",permalink:"/docs/googleidentity/authenticate-with-a-backend-server",draft:!1,tags:[],version:"current",frontMatter:{title:"Authenticate with a backend server",sidebar_label:"Authenticate with a backend server"},sidebar:"googleidentity",previous:{title:"User Information",permalink:"/docs/googleidentity/user-information"},next:{title:"Enabling Server-Side Access",permalink:"/docs/googleidentity/enabling-server-side-access"}},c={},d=[{value:"Setup",id:"setup",level:2},{value:"Sign In",id:"sign-in",level:2},{value:"Verify",id:"verify",level:2}],p={toc:d};function h(e){var t=e.components,n=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"If you use Google Sign-In with an app or site that communicates with a backend server, you might need to identify the currently signed-in user on the server. To do so securely, after a user successfully signs in, send the user's ID token to your server using HTTPS. Then, on the server, verify the integrity of the ID token and use the user information contained in the token to establish a session or create a new account."),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"Do not accept plain user IDs, such as those you can get with the ",(0,o.kt)("inlineCode",{parentName:"p"},"GoogleSignInAccount.getId()")," method, on your backend server. A modified client application can send arbitrary user IDs to your server to impersonate users, so you must instead use verifiable ID tokens to securely get the user IDs of signed-in users on the server side.")),(0,o.kt)("h2",{id:"setup"},"Setup"),(0,o.kt)("p",null,"If you plan on identifying your user with your server you will need to request the id token and provide the server client ids when you setup the extension."),(0,o.kt)("p",null,"The server client ids are created through the ",(0,o.kt)("a",{parentName:"p",href:"https://console.developers.google.com/apis/credentials"},"Google API Console")," by creating an OAuth 2.0 web application client ID for your backend server. If you have different servers for iOS and Android applications use the ",(0,o.kt)("inlineCode",{parentName:"p"},"setiOSServerClientID")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"setAndroidServerClientID")," otherwise if you just have the one you can use ",(0,o.kt)("inlineCode",{parentName:"p"},"setServerClientID"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},"var options:GoogleIdentityOptions = new GoogleIdentityOptionsBuilder()\n    .requestEmail()\n    .requestIdToken()\n    .setIOSClientID( IOS_CLIENT_ID )\n    .setiOSServerClientID( IOS_SERVER_CLIENT_ID )\n    .setAndroidServerClientID( ANDROID_SERVER_CLIENT_ID )\n    .build();\n\nGoogleIdentity.service.setup( options );\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you didn't configure ",(0,o.kt)("inlineCode",{parentName:"p"},"GoogleIdentityOptionsBuilder")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"requestIdToken()"),", your user's id token will return null or an empty string.")),(0,o.kt)("h2",{id:"sign-in"},"Sign In"),(0,o.kt)("p",null,"Follow the normal process to ",(0,o.kt)("a",{parentName:"p",href:"/docs/googleidentity/signing-in"},"sign in")," and in your sign in success handler ensure you grab the user and the id token:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},"function signInHandler( event:GoogleIdentityEvent ):void\n{\n    trace( event.user.userID );\n    trace( event.user.authentication.idToken );\n}\n")),(0,o.kt)("p",null,"You can then use a normal ",(0,o.kt)("inlineCode",{parentName:"p"},"URLRequest")," to send this token to your server to identify your user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},"var vars:URLVariables = new URLVariables();\nvars.idToken = user.authentication.idToken;\n\nvar request:URLRequest = new URLRequest( YOUR_SERVER_URL );\nrequest.data = vars;\nrequest.method = URLRequestMethod.POST;\n\nvar loader:URLLoader = new URLLoader();\nloader.addEventListener( Event.COMPLETE, loaderCompleteHandler );\nloader.load( request );\n")),(0,o.kt)("p",null,"(This is just intended as a quick example and is missing error handling)"),(0,o.kt)("h2",{id:"verify"},"Verify"),(0,o.kt)("p",null,"After you receive the ID token by HTTPS POST, you must verify the integrity of the token. To verify that the token is valid, ensure that the following criteria are satisfied:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ID token is properly signed by Google. Use Google's public keys (available in ",(0,o.kt)("a",{parentName:"li",href:"https://www.googleapis.com/oauth2/v3/certs"},"JWK")," or ",(0,o.kt)("a",{parentName:"li",href:"https://www.googleapis.com/oauth2/v1/certs"},"PEM")," format) to verify the token's signature. These keys are regularly rotated; examine the ",(0,o.kt)("inlineCode",{parentName:"li"},"Cache-Control")," header in the response to determine when you should retrieve them again."),(0,o.kt)("li",{parentName:"ul"},"The value of ",(0,o.kt)("inlineCode",{parentName:"li"},"aud")," in the ID token is equal to one of your app's client IDs. This check is necessary to prevent ID tokens issued to a malicious app being used to access data about the same user on your app's backend server."),(0,o.kt)("li",{parentName:"ul"},"The value of ",(0,o.kt)("inlineCode",{parentName:"li"},"iss")," in the ID token is equal to ",(0,o.kt)("inlineCode",{parentName:"li"},"accounts.google.com")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"https://accounts.google.com"),"."),(0,o.kt)("li",{parentName:"ul"},"The expiry time (",(0,o.kt)("inlineCode",{parentName:"li"},"exp"),") of the ID token has not passed."),(0,o.kt)("li",{parentName:"ul"},"If you want to restrict access to only members of your G Suite domain, verify that the ID token has an ",(0,o.kt)("inlineCode",{parentName:"li"},"hd")," claim that matches your G Suite domain name.")),(0,o.kt)("p",null,"Rather than writing your own code to perform these verification steps, we strongly recommend using a Google API client library for your platform, or calling our ",(0,o.kt)("inlineCode",{parentName:"p"},"tokeninfo")," validation endpoint."),(0,o.kt)("p",null,"Further information:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://developers.google.com/identity/sign-in/android/backend-auth#using-a-google-api-client-library"},"Using a Google API Client Library")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://developers.google.com/api-client-library/"},"Google API Client Libraries"))))}h.isMDXComponent=!0}}]);