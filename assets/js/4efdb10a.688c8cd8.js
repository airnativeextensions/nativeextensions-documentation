"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[59190],{28453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>c});var r=a(96540);const n={},i=r.createContext(n);function s(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(i.Provider,{value:t},e.children)}},61059:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"camera/preview-frames","title":"Preview Frames","description":"Preview Frames","source":"@site/docs/camera/preview-frames.md","sourceDirName":"camera","slug":"/camera/preview-frames","permalink":"/docs/camera/preview-frames","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Preview Frames","sidebar_label":"Preview Frames"},"sidebar":"camera","previous":{"title":"Connecting","permalink":"/docs/camera/connecting"},"next":{"title":"Capturing Images","permalink":"/docs/camera/capturing-images"}}');var n=a(74848),i=a(28453);const s={title:"Preview Frames",sidebar_label:"Preview Frames"},c=void 0,o={},d=[{value:"Preview Frames",id:"preview-frames",level:2}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h2,{id:"preview-frames",children:"Preview Frames"}),"\n",(0,n.jsx)(t.p,{children:"Once you have connected to a camera device you are most likely going to want to show a\npreview to your users."}),"\n",(0,n.jsxs)(t.p,{children:["Preview frames are provided through the ",(0,n.jsx)(t.code,{children:"CameraEvent.VIDEO_FRAME"})," event. This is dispacted\nfrom a camera device whenever a preview frame is available. The event indicates that bitmap\ndata representing the current view through the camera device is available."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-actionscript",children:"device.addEventListener( CameraEvent.VIDEO_FRAME, camera_videoFrameHandler );\n"})}),"\n",(0,n.jsxs)(t.p,{children:["When you receive the event you can then query the extension for the frame buffer using the\n",(0,n.jsx)(t.code,{children:"getFrameBuffer"})," function. This function takes a ",(0,n.jsx)(t.code,{children:"ByteArray"})," which will be filled with the\nbitmap data of the preview frame."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:["A ",(0,n.jsx)(t.code,{children:"ByteArray"})," is used to ensure we can transfer the data from the native side to your AS3\nquickly, attempting to keep the frame rate of your preview frame as high as possible."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["To render the data you should create an appropriately sized ",(0,n.jsx)(t.code,{children:"BitmapData"})," object and use the\n",(0,n.jsx)(t.code,{children:"setPixels"})," to update the bitmap data from the ",(0,n.jsx)(t.code,{children:"ByteArray"}),"."]}),"\n",(0,n.jsx)(t.p,{children:"Firstly lets create the bitmap data:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-actionscript",children:'var _previewBitmapData:BitmapData = new BitmapData( 1, 1, false );\nvar _previewBitmapRect:Rectangle = new Rectangle( 0, 0, 1, 1 );\n\n//\n//\tCheck we have an appropriately sized bitmapdata and texture\n//\t\tRecreate if not\nif (_previewBitmapData.width != device.width || _previewBitmapData.height != device.height)\n{\n\ttrace( "resizing to: (" + device.width +", "+ device.height +")" );\n\t_previewBitmapData.dispose();\n\t\n\t_previewBitmapData = new BitmapData( device.width, device.height, false );\n\t\n\t_previewBitmapRect = new Rectangle( 0, 0, _previewBitmapData.width, _previewBitmapData.height );\n}\n'})}),"\n",(0,n.jsx)(t.p,{children:"Then in our event handler we update from the frame buffer."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-actionscript",children:"private function camera_videoFrameHandler( event:CameraEvent ):void \n{\n\tif (-1 != device.getFrameBuffer( _previewData ))\n\t{\n\t\ttry\n\t\t{\n\t\t\t//\n\t\t\t//\tUpdate the bitmapdata and texture\n\t\t\t_previewBitmapData.setPixels( _previewBitmapRect, _previewData );\n\t\t\t\n\t\t\t// For Starling 1.x\n\t\t\t// flash.display3D.textures.Texture(_previewTexture.base).uploadFromBitmapData( _previewBitmapData );\n\n\t\t\t// For Starling 2.x\n\t\t\tflash.display3D.textures.RectangleTexture(_previewTexture.base).uploadFromBitmapData( _previewBitmapData );\n\t\t}\n\t\tcatch (e:Error)\n\t\t{\n\t\t\ttrace( e );\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\t_previewData.clear();\n\t\t\t_lastFrameProcessed = frame;\n\t\t}\n\t}\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["We also suggest you rotate the container of your bitmap data to match the orientation of the\ncamera device. You should use the ",(0,n.jsx)(t.code,{children:"device.info.orientation"})," value to rotate appropriately."]}),"\n",(0,n.jsx)(t.p,{children:"See the example applications for demonstrations of this, and the following gists:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://gist.github.com/marchbold/ce93ed72a5fb60db045e6168362d5508",children:"Starling Camera Preview Example"})}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);