"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[45018],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>v});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),u=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=u(e.components);return r.createElement(l.Provider,{value:n},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(t),d=a,v=p["".concat(l,".").concat(d)]||p[d]||h[d]||s;return t?r.createElement(v,i(i({ref:n},c),{},{components:t})):r.createElement(v,i({ref:n},c))}));function v(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,i=new Array(s);i[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[p]="string"==typeof e?e:a,i[1]=o;for(var u=2;u<s;u++)i[u]=t[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},85162:(e,n,t)=>{t.d(n,{Z:()=>i});var r=t(67294),a=t(86010);const s={tabItem:"tabItem_Ymn6"};function i(e){let{children:n,hidden:t,className:i}=e;return r.createElement("div",{role:"tabpanel",className:(0,a.Z)(s.tabItem,i),hidden:t},n)}},74866:(e,n,t)=>{t.d(n,{Z:()=>P});var r=t(87462),a=t(67294),s=t(86010),i=t(12466),o=t(16550),l=t(91980),u=t(67392),c=t(50012);function p(e){return function(e){var n,t;return null!=(n=null==(t=a.Children.map(e,(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?n:[]}(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:a}}=e;return{value:n,label:t,attributes:r,default:a}}))}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)((()=>{const e=null!=n?n:p(t);return function(e){const n=(0,u.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[n,t])}function d(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function v(e){let{queryString:n=!1,groupId:t}=e;const r=(0,o.k6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=t?t:null}({queryString:n,groupId:t});return[(0,l._X)(s),(0,a.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(r.location.search);n.set(s,e),r.replace({...r.location,search:n.toString()})}),[s,r])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,s=h(e),[i,o]=(0,a.useState)((()=>function(e){var n;let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!d({value:t,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}const a=null!=(n=r.find((e=>e.default)))?n:r[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:s}))),[l,u]=v({queryString:t,groupId:r}),[p,m]=function(e){let{groupId:n}=e;const t=function(e){return e?"docusaurus.tab."+e:null}(n),[r,s]=(0,c.Nk)(t);return[r,(0,a.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:r}),f=(()=>{const e=null!=l?l:p;return d({value:e,tabValues:s})?e:null})();(0,a.useLayoutEffect)((()=>{f&&o(f)}),[f]);return{selectedValue:i,selectValue:(0,a.useCallback)((e=>{if(!d({value:e,tabValues:s}))throw new Error("Can't select invalid tab value="+e);o(e),u(e),m(e)}),[u,m,s]),tabValues:s}}var f=t(72389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:n,block:t,selectedValue:o,selectValue:l,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),h=e=>{const n=e.currentTarget,t=c.indexOf(n),r=u[t].value;r!==o&&(p(n),l(r))},d=e=>{var n;let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{var r;const n=c.indexOf(e.currentTarget)+1;t=null!=(r=c[n])?r:c[0];break}case"ArrowLeft":{var a;const n=c.indexOf(e.currentTarget)-1;t=null!=(a=c[n])?a:c[c.length-1];break}}null==(n=t)||n.focus()};return a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":t},n)},u.map((e=>{let{value:n,label:t,attributes:i}=e;return a.createElement("li",(0,r.Z)({role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,key:n,ref:e=>c.push(e),onKeyDown:d,onClick:h},i,{className:(0,s.Z)("tabs__item",g.tabItem,null==i?void 0:i.className,{"tabs__item--active":o===n})}),null!=t?t:n)})))}function y(e){let{lazy:n,children:t,selectedValue:r}=e;const s=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,a.cloneElement)(e,{className:"margin-top--md"}):null}return a.createElement("div",{className:"margin-top--md"},s.map(((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==r}))))}function E(e){const n=m(e);return a.createElement("div",{className:(0,s.Z)("tabs-container",g.tabList)},a.createElement(b,(0,r.Z)({},e,n)),a.createElement(y,(0,r.Z)({},e,n)))}function P(e){const n=(0,f.Z)();return a.createElement(E,(0,r.Z)({key:String(n)},e))}},53611:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>v,frontMatter:()=>o,metadata:()=>u,toc:()=>p});var r=t(87462),a=(t(67294),t(3905)),s=t(74866),i=t(85162);const o={title:"Restore Purchases",sidebar_label:"Restore Purchases"},l=void 0,u={unversionedId:"inappbilling/restore-purchases",id:"inappbilling/restore-purchases",title:"Restore Purchases",description:"Restoring purchases is a process that you should allow for user's who have either changed devices",source:"@site/docs/inappbilling/restore-purchases.mdx",sourceDirName:"inappbilling",slug:"/inappbilling/restore-purchases",permalink:"/docs/inappbilling/restore-purchases",draft:!1,tags:[],version:"current",frontMatter:{title:"Restore Purchases",sidebar_label:"Restore Purchases"},sidebar:"inappbilling",previous:{title:"Pending Purchases",permalink:"/docs/inappbilling/pending-purchases"},next:{title:"Get Purchases",permalink:"/docs/inappbilling/get-purchases"}},c={},p=[],h={toc:p},d="wrapper";function v(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,r.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Restoring purchases is a process that you should allow for user's who have either changed devices\nor reinstalled your application and hence need to gain access to their purchases again. It should not be an automatic process but one done through user interaction. "),(0,a.kt)("admonition",{title:"App Store Review",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("strong",{parentName:"p"},"This process must be available to your users and must initiated by user interaction in order to pass App Store review.")),(0,a.kt)("p",{parentName:"admonition"},"To satisfy this requirement, you must provide a button somewhere in your application to initiate this restore process. Generally somewhere like your application settings is an appropriate place to have a restore purchases functionality."),(0,a.kt)("p",{parentName:"admonition"},"For more information on the concepts you can read the Apple documentation ",(0,a.kt)("a",{parentName:"p",href:"https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/StoreKitGuide/Chapters/Restoring.html"},"here"),".")),(0,a.kt)("p",null,"For retrieving purchases without user interaction see the ",(0,a.kt)("a",{parentName:"p",href:"get-purchases"},"Get Purchases")," functionality."),(0,a.kt)(s.Z,{groupId:"framework",defaultValue:"air",values:[{label:"AIR",value:"air"},{label:"Unity",value:"unity"}],mdxType:"Tabs"},(0,a.kt)(i.Z,{value:"air",mdxType:"TabItem"},(0,a.kt)("p",null,"The restoring purchases process starts by calling the ",(0,a.kt)("inlineCode",{parentName:"p"},"restorePurchases()")," function and concludes with either a success (",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBillingEvent.RESTORE_PURCHASES_SUCCESS"),") or failure (",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBillingEvent.RESTORE_PURCHASES_FAILED"),") event. "),(0,a.kt)("p",null,"After calling ",(0,a.kt)("inlineCode",{parentName:"p"},"restorePurchase()")," you will a receive ",(0,a.kt)("inlineCode",{parentName:"p"},"PurchaseEvent.PURCHASES_UPDATED")," dispatched\nwhich will contain ",(0,a.kt)("inlineCode",{parentName:"p"},"Purchase")," objects in the restored state having the original purchase variable\nrepresenting the original purchase transaction."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"// The service must be setup and a list of products retrieved.\n\n// Make sure you have added your purchases handler\nInAppBilling.service.addEventListener( PurchaseEvent.PURCHASES_UPDATED, purchases_updatedHandler );\n\nInAppBilling.service.addEventListener( InAppBillingEvent.RESTORE_PURCHASES_SUCCESS, restorePurchases_successHandler );\nInAppBilling.service.addEventListener( InAppBillingEvent.RESTORE_PURCHASES_FAILED, restorePurchases_failedHandler );\n\n// Start the restore process\nInAppBilling.service.restorePurchases();\n\n\n//\n//\n//\n\nfunction purchases_updatedHandler( event:PurchaseEvent ):void\n{\n    for each (var purchase:Purchase in event.data)\n    {\n        switch (purchase.transactionState)\n        {\n\n            //  Other states...\n\n\n            case Purchase.STATE_RESTORED:\n                // The originalPurchase property will contain all the \n                // information on the original transaction allowing \n                // you to restore the user's product\n                \n                addPurchaseToInventory( purchase.originalPurchase );\n                InAppBilling.service.finishPurchase( purchase );\n                \n                // Again you could hold on to this purchase and check it against \n                // your application server before calling finishPurchase\n                break;\n\n\n        }\n    }   \n}\n\n\n//\n//  RESTORE PURCHASE EVENTS\n//\n\nfunction restorePurchases_successHandler( event:InAppBillingEvent ):void\n{\n    // Called when all purchases have been restored\n    // This event contains no data\n}\n\nfunction restorePurchases_failedHandler( event:InAppBillingEvent ):void\n{\n    // Called if there was an error restoring purchases\n}\n"))),(0,a.kt)(i.Z,{value:"unity",mdxType:"TabItem"},(0,a.kt)("p",null,"The restoring purchases process starts by calling the ",(0,a.kt)("inlineCode",{parentName:"p"},"RestorePurchases()")," function and concludes with either a success (",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBilling.Instance.Events.OnRestorePurchasesSuccess"),") or failure (",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBilling.Instance.Events.OnRestorePurchasesFailed"),") event. "),(0,a.kt)("p",null,"After calling ",(0,a.kt)("inlineCode",{parentName:"p"},"RestorePurchases()")," you will a receive the ",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBilling.Instance.Events.OnPurchaseUpdated"),"\nevent dispatched which will contain ",(0,a.kt)("inlineCode",{parentName:"p"},"Purchase")," objects in the restored state having the original purchase\nvariable representing the original purchase transaction."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'// The service must be setup and a list of products retrieved.\n\n// Make sure you have added your purchases handler\nInAppBilling.Instance.Events.OnPurchaseUpdated += OnPurchaseUpdated;\nInAppBilling.Instance.Events.OnRestorePurchasesSuccess += OnRestorePurchasesSuccess;\nInAppBilling.Instance.Events.OnRestorePurchasesFailed += OnRestorePurchasesFailed;\n\n// Start the restore process\nInAppBilling.Instance.RestorePurchases();\n\n\nprivate void OnPurchaseUpdated(PurchaseEvent e)\n{\n    foreach (Purchase purchase in e.purchases)\n    {\n        switch (purchase.transactionState)\n        {\n\n            //  Other states...\n            case Purchase.STATE_RESTORED:\n                // The originalPurchase property will contain all the \n                // information on the original transaction allowing \n                // you to restore the user\'s product\n                \n                AddPurchaseToInventory( purchase.originalPurchase );\n                InAppBilling.Instance.FinishPurchase( purchase );\n                \n                // Again you could hold on to this purchase and check it against \n                // your application server before calling finishPurchase\n                break;\n        }\n    }\n}\n\n\nprivate void OnRestorePurchasesSuccess(PurchaseEvent e)\n{\n    // Called when all purchases have been restored\n    // This event contains no data\n}\n\n\nprivate void OnRestorePurchasesFailed(PurchaseEvent e)\n{\n    // Called if there was an error restoring purchases\n    Debug.Log("Restore purchases failed: " + e.errorCode + " " + e.message);\n}\n')))))}v.isMDXComponent=!0}}]);