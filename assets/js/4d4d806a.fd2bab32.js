(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[74091],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return l},kt:function(){return h}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var d=a.createContext({}),c=function(e){var t=a.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},l=function(e){var t=c(e.components);return a.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,d=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=i,g=u["".concat(d,".").concat(h)]||u[h]||p[h]||o;return n?a.createElement(g,r(r({ref:t},l),{},{components:n})):a.createElement(g,r({ref:t},l))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var c=2;c<o;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},948:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return r},metadata:function(){return s},toc:function(){return d},default:function(){return l}});var a=n(22122),i=n(19756),o=(n(67294),n(3905)),r={title:"Scanning",sidebar_label:"Scanning"},s={unversionedId:"nfc/scanning",id:"nfc/scanning",isDocsHomePage:!1,title:"Scanning",description:"Tags",source:"@site/docs/nfc/scanning.md",sourceDirName:"nfc",slug:"/nfc/scanning",permalink:"/docs/nfc/scanning",version:"current",sidebar_label:"Scanning",frontMatter:{title:"Scanning",sidebar_label:"Scanning"},sidebar:"nfc",previous:{title:"Add the Extension",permalink:"/docs/nfc/add-the-extension"},next:{title:"changelog",permalink:"/docs/nfc/changelog"}},d=[{value:"Tags",id:"tags",children:[]},{value:"Events",id:"events",children:[]},{value:"Android",id:"android",children:[{value:"Introduction",id:"introduction",children:[]},{value:"Application Dispatch",id:"application-dispatch",children:[]},{value:"Foreground Dispatch",id:"foreground-dispatch",children:[]}]},{value:"iOS",id:"ios",children:[{value:"Introduction",id:"introduction-1",children:[]},{value:"Background Dispatch",id:"background-dispatch",children:[]},{value:"Foreground Dispatch",id:"foreground-dispatch-1",children:[]}]}],c={toc:d};function l(e){var t=e.components,r=(0,i.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"tags"},"Tags"),(0,o.kt)("p",null,"NFC tags come in a wide array of technologies and can also have data written to them in many different ways. Android and iOS has the most support for the NDEF standard, which is defined by the ",(0,o.kt)("a",{parentName:"p",href:"https://nfc-forum.org/home"},"NFC Forum"),"."),(0,o.kt)("p",null,"NDEF data is encapsulated inside a message (",(0,o.kt)("inlineCode",{parentName:"p"},"NdefMessage"),") that contains one or more records (",(0,o.kt)("inlineCode",{parentName:"p"},"NdefRecord"),"). Each NDEF record must be well-formed according to the specification of the type of record that you want to create."),(0,o.kt)("h2",{id:"events"},"Events"),(0,o.kt)("p",null,"Your application will get notified about NFC tag detection events via the ",(0,o.kt)("inlineCode",{parentName:"p"},"NFCEvent"),". The most relevant event is the ",(0,o.kt)("inlineCode",{parentName:"p"},"NFCEvent.ACTION_NDEF_DISCOVERED")," which is dispatched whenever an applicable NDEF NFC tag is detected."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"NFCEvent")," will contain a ",(0,o.kt)("inlineCode",{parentName:"p"},"Tag")," object in the ",(0,o.kt)("inlineCode",{parentName:"p"},"tag")," variable. This contains all the information available about the detected tag, including ",(0,o.kt)("inlineCode",{parentName:"p"},"NdefMessage"),"s and ",(0,o.kt)("inlineCode",{parentName:"p"},"NdefRecord"),"s contained in the tag. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},'NFC.service.addEventListener( NFCEvent.ACTION_NDEF_DISCOVERED, discoveredHandler );\n\nfunction discoveredHandler( event:NFCEvent ):void\n{\n    trace( "discovered: ["+event.type+"] " + event.tag.toString() );\n    for each (var message:NdefMessage in event.tag.messages)\n    {\n        for each (var record:NdefRecord in message.records)\n        {\n            trace( "\\t"+record.toString() + "::"+record.payload.toString() +" url:"+record.url );\n        }\n    }\n}\n')),(0,o.kt)("h2",{id:"android"},"Android"),(0,o.kt)("h3",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Reading NDEF data from an NFC tag is handled with the tag dispatch system, which analyzes discovered NFC tags, appropriately categorizes the data, and starts an application that is interested in the categorized data. An application that wants to handle the scanned NFC tag can declare an intent filter and request to handle the data."),(0,o.kt)("p",null,"Android-powered devices are usually looking for NFC tags when the screen is unlocked, unless NFC is disabled in the device's Settings menu. When an Android-powered device discovers an NFC tag, the desired behavior is to have the most appropriate activity handle the intent without asking the user what application to use. Because devices scan NFC tags at a very short range, it is likely that making users manually select an activity would force them to move the device away from the tag and break the connection. You should develop your activity to only handle the NFC tags that your activity cares about to prevent the Activity Chooser from appearing."),(0,o.kt)("p",null,"To help you with this goal, Android provides a special tag dispatch system that analyzes scanned NFC tags, parses them, and tries to locate applications that are interested in the scanned data. It does this by:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Parsing the NFC tag and figuring out the MIME type or a URI that identifies the data payload in the tag."),(0,o.kt)("li",{parentName:"ul"},"Encapsulating the MIME type or URI and the payload into an intent. These first two steps are described in ",(0,o.kt)("a",{parentName:"li",href:"https://developer.android.com/guide/topics/connectivity/nfc/nfc.html#ndef"},"How NFC tags are mapped to MIME types and URIs"),"."),(0,o.kt)("li",{parentName:"ul"},"Starts an activity based on the intent. This is described in ",(0,o.kt)("a",{parentName:"li",href:"https://developer.android.com/guide/topics/connectivity/nfc/nfc.html#dispatching"},"How NFC Tags are Dispatched to Applications"),".")),(0,o.kt)("h3",{id:"application-dispatch"},"Application Dispatch"),(0,o.kt)("p",null,"The extension provides an activity that you can use to inform your AIR application about the NFC tag. You should still construct your intent filters in your manifest additions in order to correctly start this activity and launch your application when a tag of interest is detected by Android."),(0,o.kt)("p",null,"In order to get your application to automatically launch and handle NFC tags without having to be running you need to add the ",(0,o.kt)("inlineCode",{parentName:"p"},"NFCActionActivity")," to your applications Android manifest additions and apply the appropriate filters for your application."),(0,o.kt)("p",null,"Some examples of intent filters are below. "),(0,o.kt)("p",null,"An NDEF record with a url pointing to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://airnativeextensions.com"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<activity android:name="com.distriqt.extension.nfc.activities.NFCActionActivity" android:theme="@android:style/Theme.Translucent.NoTitleBar" >\n    <intent-filter>\n        <action android:name="android.nfc.action.NDEF_DISCOVERED"/>\n        <category android:name="android.intent.category.DEFAULT"/>\n        <data android:scheme="https"\n                android:host="airnativeextensions.com"\n        />\n    </intent-filter>\n</application>\n')),(0,o.kt)("p",null,"An NDEF record with a plain text:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},'<activity android:name="com.distriqt.extension.nfc.activities.NFCActionActivity" android:theme="@android:style/Theme.Translucent.NoTitleBar" >\n    <intent-filter>\n        <action android:name="android.nfc.action.NDEF_DISCOVERED"/>\n        <category android:name="android.intent.category.DEFAULT"/>\n        <data android:mimeType="text/plain" />\n    </intent-filter>\n</application>\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: You can add multiple ",(0,o.kt)("inlineCode",{parentName:"p"},"intent-filter")," nodes to the ",(0,o.kt)("inlineCode",{parentName:"p"},"activity")," to register for several different tag types.")),(0,o.kt)("h3",{id:"foreground-dispatch"},"Foreground Dispatch"),(0,o.kt)("p",null,"If you don't require your application to be launched from a tag, but instead just need active foreground scanning, (reading tags while your application is active in the foreground) you can use the foreground dispatch method."),(0,o.kt)("p",null,"This involves calling the ",(0,o.kt)("inlineCode",{parentName:"p"},"registerForegroundDispatch()")," method to register your application for NFC tag detection at runtime."),(0,o.kt)("p",null,"Similar to the intent filters above, you need to specify the urls or mimetypes that are relevant to your application. This is done through setting the options in an instance of the ",(0,o.kt)("inlineCode",{parentName:"p"},"ScanOptions")," class."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},'var options:ScanOptions = new ScanOptions();\noptions.urls.push( "https://airnativeextensions.com" );  \n\nNFC.service.registerForegroundDispatch( options );\n')),(0,o.kt)("h2",{id:"ios"},"iOS"),(0,o.kt)("h3",{id:"introduction-1"},"Introduction"),(0,o.kt)("p",null,"iOS NFC reading is available as an active foreground activity from iOS 11 and as a background / system level activity from iOS 12."),(0,o.kt)("h3",{id:"background-dispatch"},"Background Dispatch"),(0,o.kt)("p",null,"On iPhones that support background tag reading, the system scans for and reads NFC data without requiring users to scan tags using an app. The system displays a pop-up notification each time it reads a new tag. After the user taps the notification, the system delivers the tag data to the appropriate app. If the iPhone is locked, the system prompts the user to unlock the phone before providing the tag data to the app."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Note"),"\niPhone XS and later support background tag reading.")),(0,o.kt)("p",null,"After the device scans an NFC tag while in background tag reading mode, the system inspects the tag\u2019s NDEF message for a URI record by looking for an payload object with the following property values:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"typeNameFormat equal to ",(0,o.kt)("inlineCode",{parentName:"li"},"NFCTypeNameFormatNFCWellKnown")),(0,o.kt)("li",{parentName:"ul"},"type equal to ",(0,o.kt)("inlineCode",{parentName:"li"},"\u201cU\u201d"))),(0,o.kt)("p",null,"If the NDEF message contains more than one URI record, the system uses the first one. The URI record must contain either a universal link or a supported URL scheme."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You cannot use a custom URL to launch your application, this only works with a predefined set of url schemes mainly for web urls, email, sms etc.")),(0,o.kt)("p",null,"For tags that contain universal links, the system presents a notification and then launches (or brings to the foreground) the app associated with the universal link after the user taps the notification. (This will happen if the application is in the foreground as well, ie. notification will appear and you will receive an event if the user taps the notification)"),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(82436).Z})),(0,o.kt)("p",null,"The system sends the NDEF message to the app and the extension receives it. When you call ",(0,o.kt)("inlineCode",{parentName:"p"},"checkStartupData()")," the ",(0,o.kt)("inlineCode",{parentName:"p"},"NFCEvent")," will be dispatched, following the same process as Android.\nIf there are no installed apps associated with the universal link, the system opens the link in Safari."),(0,o.kt)("p",null,"In order for this to work you must setup a universal link for your application and included the domain in the ",(0,o.kt)("inlineCode",{parentName:"p"},"com.apple.developer.associated-domains")," entitlements section of your iphone additions. (See ",(0,o.kt)("a",{parentName:"p",href:"add-the-extension"},"Add the Extension")," for more details)."),(0,o.kt)("h3",{id:"foreground-dispatch-1"},"Foreground Dispatch"),(0,o.kt)("p",null,"To initiate reading tags on iOS you call the ",(0,o.kt)("inlineCode",{parentName:"p"},"registerForegroundDispatch()")," method. There are no filtering methods on iOS so any NDEF formatted tags will be detected and events dispatched to your application, and any options provided (as in the Android case) will be ignored."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},"NFC.service.registerForegroundDispatch();\n")),(0,o.kt)("p",null,"While scanning on iOS the following dialog will be presented to your user: "),(0,o.kt)("p",null,(0,o.kt)("img",{src:n(59919).Z})),(0,o.kt)("p",null,"You can customise the message displayed in this dialog by setting the ",(0,o.kt)("inlineCode",{parentName:"p"},"message")," in the options passed to ",(0,o.kt)("inlineCode",{parentName:"p"},"registerForegroundDispatch()"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-actionscript"},'var options:ScanOptions = new ScanOptions();\noptions.message = "Hold your device near the item to learn more about it.";\n\nNFC.service.registerForegroundDispatch( options );\n')))}l.isMDXComponent=!0},82436:function(e,t,n){"use strict";t.Z=n.p+"assets/images/ios-nfc-scan-notification-035a85b39d6e31e39403f7133f4302f1.png"},59919:function(e,t,n){"use strict";t.Z=n.p+"assets/images/ios_scanning_dialog-86b9b0493dd49758d63f07bb43c909cd.png"}}]);