"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[14518],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var i=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=i.createContext({}),l=function(e){var t=i.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return i.createElement(u.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),p=l(n),d=o,m=p["".concat(u,".").concat(d)]||p[d]||h[d]||a;return n?i.createElement(m,s(s({ref:t},c),{},{components:n})):i.createElement(m,s({ref:t},c))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=p;var r={};for(var u in t)hasOwnProperty.call(t,u)&&(r[u]=t[u]);r.originalType=e,r.mdxType="string"==typeof e?e:o,s[1]=r;for(var l=2;l<a;l++)s[l]=n[l];return i.createElement.apply(null,s)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},41186:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return u},metadata:function(){return l},toc:function(){return c},default:function(){return p}});var i=n(87462),o=n(63366),a=(n(67294),n(3905)),s=["components"],r={title:"Request Authorisation",sidebar_label:"Request Authorisation"},u=void 0,l={unversionedId:"location/request-authorisation",id:"location/request-authorisation",title:"Request Authorisation",description:"When you are going to be accessing the user's location you must check that your",source:"@site/docs/location/request-authorisation.md",sourceDirName:"location",slug:"/location/request-authorisation",permalink:"/docs/location/request-authorisation",tags:[],version:"current",frontMatter:{title:"Request Authorisation",sidebar_label:"Request Authorisation"},sidebar:"location",previous:{title:"Initialise the Extension",permalink:"/docs/location/initialise-the-extension"},next:{title:"Device Location Settings",permalink:"/docs/location/device-location-settings"}},c=[{value:"Usage Description",id:"usage-description",children:[],level:2},{value:"Background Authorisation",id:"background-authorisation",children:[],level:2}],h={toc:c};function p(e){var t=e.components,r=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,i.Z)({},h,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"When you are going to be accessing the user's location you must check that your\napplication has been allowed access. To this end the extension provides several\nhelpers to check and request access to the location services."),(0,a.kt)("p",null,"On Android these permissions are listed through the manifest additions.\nOn older versions of Android these permissions are accepted when the user installs\nthe application. More modern versions (Marshmallow 6 ","[v23]","+) require that you\nrequest the permissions similar to iOS. You will still need to list them in your\nmanifest and then follow the same code below as for iOS, except that on Android\nyou will be able to ask multiple times. You should respect the ",(0,a.kt)("inlineCode",{parentName:"p"},"SHOULD_EXPLAIN"),"\nstatus by displaying additional information to your user about why you require\nthis functionality. You can either request coarse or fine location based on your\napplication need"),(0,a.kt)("p",null,"On iOS the user must be asked at runtime, which you only get one chance to ask,\nafter which you must direct the user to manually change the permissions in the settings."),(0,a.kt)("p",null,"The following code will work across both platforms:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'Location.service.addEventListener( AuthorisationEvent.CHANGED, authorisationChangedHandler );\nswitch (Location.service.authorisationStatus())\n{\n    case AuthorisationStatus.ALWAYS:\n    case AuthorisationStatus.IN_USE:\n        trace( "User allowed access: " + Location.service.authorisationStatus() );\n        break;\n    \n    case AuthorisationStatus.NOT_DETERMINED:\n    case AuthorisationStatus.SHOULD_EXPLAIN:\n        Location.service.requestAuthorisation( AuthorisationStatus.ALWAYS );\n        break;\n    \n    case AuthorisationStatus.RESTRICTED:\n    case AuthorisationStatus.DENIED:\n    case AuthorisationStatus.UNKNOWN:\n        trace( "User denied access" );\n        break;\n}\n\nfunction authorisationChangedHandler( event:AuthorisationEvent ):void\n{\n    //\n}\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"When requesting authorisation you can either request ",(0,a.kt)("inlineCode",{parentName:"p"},"AuthorisationStatus.ALWAYS"),"\nor ",(0,a.kt)("inlineCode",{parentName:"p"},"AuthorisationStatus.IN_USE")," access. If you want to be able to receive notifications\nin the background you must use ",(0,a.kt)("inlineCode",{parentName:"p"},"ALWAYS")," otherwise you will only receive updates when\nthe application is in use.")),(0,a.kt)("h2",{id:"usage-description"},"Usage Description"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This applies to the iOS implementation ")),(0,a.kt)("p",null,"You can customise the usage description messages as you see fit to suit your application. These messages are displayed in the main body area of the iOS authorisation dialog with the title and buttons being standard (and not customisable)."),(0,a.kt)("p",null,"The image below is an example of the authorisation dialog. The content ",(0,a.kt)("em",{parentName:"p"},'"Access to photo library is required to save images."')," is the usage description message you can set."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(60181).Z,width:"573",height:"357"})),(0,a.kt)("p",null,"You set these values through adding the usage description keys to your application descriptor's info additions or simply by setting up your configuration options in your ",(0,a.kt)("inlineCode",{parentName:"p"},"apm")," project. "),(0,a.kt)("h2",{id:"background-authorisation"},"Background Authorisation"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"This applies to the Android implementation ")),(0,a.kt)("p",null,'Requesting "always" or "background" location access on Android has changed with recent releases of Android. '),(0,a.kt)("p",null,'When requesting permission your user will firstly be presented with the "in use" permission request, which will allow the user to select the accuracy of your location requests and allow or deny the request:'),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(35093).Z,width:"389",height:"800"})),(0,a.kt)("p",null,'If you have included the background permission in your manifest and request the "always" permission then an additional step is required where the user will need to manually change the location permission to be "Allow all the time":'),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(14808).Z,width:"389",height:"800"})),(0,a.kt)("p",null,'You should step through this process for your user, firstly requesting the "in use" permission and then explaining the need for the background permission before requesting the "always" permission.'),(0,a.kt)("p",null,'If you simply request the "always" permission to start with, then the extension will firstly show the "in use" dialog and then, if granted, will display the settings for the user to change to the "always" permission.'),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"It is worth noting that if a user removes a location permission your Android application will likely be restarted by the system to ensure these decreased permission levels are applied."))))}p.isMDXComponent=!0},14808:function(e,t,n){t.Z=n.p+"assets/images/android_permission_always-1fa3ad09d4ecba6e7801c92b72a3f9b4.png"},35093:function(e,t,n){t.Z=n.p+"assets/images/android_permission_inuse-be589883205e689c5954b50d7bef9499.png"},60181:function(e,t,n){t.Z=n.p+"assets/images/ios-permission-dialog-fb435e911b1ce9d2619a0dff5db7e237.png"}}]);