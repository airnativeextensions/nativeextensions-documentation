(window.webpackJsonp=window.webpackJsonp||[]).push([[206],{262:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return s})),t.d(n,"rightToc",(function(){return d})),t.d(n,"default",(function(){return l}));var i=t(2),r=t(6),o=(t(0),t(886)),a={title:"upgrade-new-version",sidebar_label:"upgrade-new-version"},s={unversionedId:"nativemaps/upgrade-new-version",id:"nativemaps/upgrade-new-version",isDocsHomePage:!1,title:"upgrade-new-version",description:"Version X upgrade steps",source:"@site/docs/nativemaps/upgrade-new-version.md",slug:"/nativemaps/upgrade-new-version",permalink:"/docs/nativemaps/upgrade-new-version",version:"current",sidebar_label:"upgrade-new-version"},d=[{value:"Known Issues",id:"known-issues",children:[]},{value:"Resolved issues in this version",id:"resolved-issues-in-this-version",children:[{value:"1. Map not displaying",id:"1-map-not-displaying",children:[]},{value:"2. UI controls invisible",id:"2-ui-controls-invisible",children:[]},{value:"3. Problems with &#39;gms version&#39; mismatch",id:"3-problems-with-gms-version-mismatch",children:[]}]},{value:"Required changes",id:"required-changes",children:[{value:"1. Add supporting ANEs",id:"1-add-supporting-anes",children:[]},{value:"2. Use AIR 22",id:"2-use-air-22",children:[]},{value:"3. Update your application descriptor",id:"3-update-your-application-descriptor",children:[]},{value:"Summary of changes",id:"summary-of-changes",children:[]}]},{value:"General notes",id:"general-notes",children:[{value:"1. Creating maps - not so fast!",id:"1-creating-maps---not-so-fast",children:[]}]},{value:"Documentation",id:"documentation",children:[]}],c={rightToc:d};function l(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(i.a)({},c,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"version-x-upgrade-steps"},"Version X upgrade steps"),Object(o.b)("p",null,"The latest version (vX.X.X) of our NativeMaps extension has been updated\nto simplify and resolve known issues with the Android version."),Object(o.b)("p",null,"The updated version requires some changes to the way you set up your\napplication descriptor, etc."),Object(o.b)("p",null,"This page outlines the steps to update your app to support the new\nversion of the ANE."),Object(o.b)("h1",{id:""}),Object(o.b)("h2",{id:"known-issues"},"Known Issues"),Object(o.b)("p",null,"The Android version of the ANE has had many known issues which were problematic for all different\nversions of Android and therefore difficult to diagnose and fix for all users."),Object(o.b)("p",null,"This version has been fairly well tested and we're reasonably confident that with the right\nconfiguration the maps should function reliably across different devices and OS versions."),Object(o.b)("h1",{id:"-1"}),Object(o.b)("h2",{id:"resolved-issues-in-this-version"},"Resolved issues in this version"),Object(o.b)("h3",{id:"1-map-not-displaying"},"1. Map not displaying"),Object(o.b)("p",null,"The main issue we have been trying to resolve for a long time has been the issue of the map\nnot being visible, or disappearing. It's always been a problem because of the way AIR apps\nwork internally, and because of how Android handles z-indexing of SurfaceView layers. We have\nrewritten all of the view code which creates and runs the native map layer and are reasonably\nconfident that we've solved this problem! \ud83d\udc83"),Object(o.b)("h3",{id:"2-ui-controls-invisible"},"2. UI controls invisible"),Object(o.b)("p",null,"A lot of reported issues correctly noted that after creating a map, the z-order problems caused\nthe UI controls to disappear on many versions of Android (the zoom buttons and user location\nbutton). The fixes to the z-ordering in this new version should resolve this problem."),Object(o.b)("h3",{id:"3-problems-with-gms-version-mismatch"},"3. Problems with 'gms version' mismatch"),Object(o.b)("p",null,"A lot of crashes have been reported which were caused by an incorrect value of the\n",Object(o.b)("inlineCode",{parentName:"p"},"com.google.android.gms.version")," meta tag value. The new version has changes to\nuse the correct value of ",Object(o.b)("inlineCode",{parentName:"p"},"@integer/google_play_services_version")," rather than a\nspecific integer, which should fix this problem. "),Object(o.b)("h1",{id:"-2"}),Object(o.b)("h2",{id:"required-changes"},"Required changes"),Object(o.b)("h3",{id:"1-add-supporting-anes"},"1. Add supporting ANEs"),Object(o.b)("p",null,"Firstly, make sure you download and add the latest versions of each of the required\nsupport extensions to your app. This includes:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Core - ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/distriqt/ANE-Core"}),"https://github.com/distriqt/ANE-Core")),Object(o.b)("li",{parentName:"ul"},"GooglePlayServices - ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/distriqt/ANE-GooglePlayServices"}),"https://github.com/distriqt/ANE-GooglePlayServices")),Object(o.b)("li",{parentName:"ul"},"AndroidSupport - ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/distriqt/ANE-AndroidSupport"}),"https://github.com/distriqt/ANE-AndroidSupport"))),Object(o.b)("h3",{id:"2-use-air-22"},"2. Use AIR 22"),Object(o.b)("p",null,"AIR 22 is still in beta at the time of writing, but we believe it is the most stable and best\nrelease of AIR so far, and so we recommend using it if possible."),Object(o.b)("h3",{id:"3-update-your-application-descriptor"},"3. Update your application descriptor"),Object(o.b)("p",null,"There are a few changes you need to make to the Android manifest section of your app XML. Below is an example of a complete manifest:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),'<android>\n    <manifestAdditions><![CDATA[\n        <manifest android:installLocation="auto">\n            <uses-sdk android:minSdkVersion="12" android:targetSdkVersion="19" />\n            <uses-permission android:name="android.permission.INTERNET"/>\n            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>\n            <uses-permission android:name="android.permission.READ_PHONE_STATE"/>\n            <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>\n            <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>\n            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>\n            <uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/>\n            <uses-permission android:name="com.google.android.providers.gsf.permission.READ_GSERVICES"/>\n            <uses-feature android:glEsVersion="0x00020000" android:required="true"/>\n            \x3c!-- Replace \'air.com.distriqt.test\' here with \'air.your.app.id\' etc --\x3e\n            <uses-permission android:name="air.com.distriqt.test.permission.MAPS_RECEIVE" android:protectionLevel="signature"/>\n            <application>   \n                \x3c!-- Replace "YOUR_API_KEY" with your Android Google Maps v2 api key --\x3e\n                <meta-data android:name="com.google.android.maps.v2.API_KEY" android:value="YOUR API KEY" />\n                <meta-data android:name="com.google.android.gms.version" android:value="@integer/google_play_services_version" />\n            </application>\n        </manifest>]]>\n    </manifestAdditions>\n</android>\n')),Object(o.b)("h3",{id:"summary-of-changes"},"Summary of changes"),Object(o.b)("p",null,"TODO"),Object(o.b)("h1",{id:"-3"}),Object(o.b)("h2",{id:"general-notes"},"General notes"),Object(o.b)("h3",{id:"1-creating-maps---not-so-fast"},"1. Creating maps - not so fast!"),Object(o.b)("p",null,"Some crashes or problems can be caused by trying to initialise and create a map too quickly when\nyour app starts up. For example, a lot of developers add all their code to init, create and set\nup a map in the ",Object(o.b)("inlineCode",{parentName:"p"},"addedToStage")," handler of the main class."),Object(o.b)("p",null,"This can be problematic, especially in this new version because the extension needs to perform\nsome view reordering and modification to fix the z-indexing problem. We strongly suggest:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Wait a short time after your app starts to work with the map objects"),Object(o.b)("li",{parentName:"ul"},"Call ",Object(o.b)("inlineCode",{parentName:"li"},"NativeMaps.service.createMap()")," separately, before other map functions"),Object(o.b)("li",{parentName:"ul"},"Listen for the ",Object(o.b)("inlineCode",{parentName:"li"},"NativeMapEvent.MAP_CREATED")," event and then perform other actions on your map ")),Object(o.b)("h1",{id:"-4"}),Object(o.b)("h2",{id:"documentation"},"Documentation"),Object(o.b)("p",null,"Latest documentation:"),Object(o.b)("p",null,Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"http://airnativeextensions.com/extension/com.distriqt.NativeMaps"}),"http://airnativeextensions.com/extension/com.distriqt.NativeMaps")))}l.isMDXComponent=!0},886:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return m}));var i=t(0),r=t.n(i);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=r.a.createContext({}),l=function(e){var n=r.a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},p=function(e){var n=l(e.components);return r.a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},b=r.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,a=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),p=l(t),b=i,m=p["".concat(a,".").concat(b)]||p[b]||u[b]||o;return t?r.a.createElement(m,s(s({ref:n},c),{},{components:t})):r.a.createElement(m,s({ref:n},c))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,a=new Array(o);a[0]=b;var s={};for(var d in n)hasOwnProperty.call(n,d)&&(s[d]=n[d]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var c=2;c<o;c++)a[c]=t[c];return r.a.createElement.apply(null,a)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);