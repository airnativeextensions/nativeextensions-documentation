"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[68557],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),s=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=s(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),p=s(n),m=i,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return n?o.createElement(g,r(r({ref:t},u),{},{components:n})):o.createElement(g,r({ref:t},u))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,r=new Array(a);r[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c[p]="string"==typeof e?e:i,r[1]=c;for(var s=2;s<a;s++)r[s]=n[s];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},18355:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>s});var o=n(87462),i=(n(67294),n(3905));const a={title:"Location Monitoring",sidebar_label:"Location Monitoring"},r=void 0,c={unversionedId:"location/location-monitoring",id:"location/location-monitoring",title:"Location Monitoring",description:"Start Location Monitoring",source:"@site/docs/location/location-monitoring.md",sourceDirName:"location",slug:"/location/location-monitoring",permalink:"/docs/location/location-monitoring",draft:!1,tags:[],version:"current",frontMatter:{title:"Location Monitoring",sidebar_label:"Location Monitoring"},sidebar:"location",previous:{title:"Device Location Settings",permalink:"/docs/location/device-location-settings"},next:{title:"Geofences",permalink:"/docs/location/geofences"}},l={},s=[{value:"Start Location Monitoring",id:"start-location-monitoring",level:2},{value:"Android Background Updates",id:"android-background-updates",level:3},{value:"Stop Location Monitoring",id:"stop-location-monitoring",level:2},{value:"Update URL",id:"update-url",level:2},{value:"Mock Locations",id:"mock-locations",level:2}],u={toc:s},p="wrapper";function d(e){let{components:t,...n}=e;return(0,i.kt)(p,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"start-location-monitoring"},"Start Location Monitoring"),(0,i.kt)("p",null,"To start location monitoring you construct a ",(0,i.kt)("inlineCode",{parentName:"p"},"LocationRequest")," instance and then call ",(0,i.kt)("inlineCode",{parentName:"p"},"startLocationMonitoring"),".\nThe request specifies the details of the monitoring such as accuracy, priority and intervals.\nYou should only request the minimum level of information required to achieve your applications goals,\nso to conserve the user's power wherever possible. The two most important settings are the accuracy and\npriority, these separately specify the levels for iOS and Android respectively."),(0,i.kt)("p",null,"The extension will dispatch ",(0,i.kt)("inlineCode",{parentName:"p"},"LocationEvent.UPDATE")," events whenever a location update is received."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},'Location.service.addEventListener( LocationEvent.UPDATE, location_updateHandler );\n\nvar request:LocationRequest = new LocationRequest()\n    .setAccuracy( LocationRequest.ACCURACY_NEAREST_TEN_METERS )\n    .setPriority( LocationRequest.PRIORITY_BALANCED_POWER_ACCURACY );\n\n\nvar success:Boolean = Location.service.startLocationMonitoring( request );\n\n\nfunction location_updateHandler( event:LocationEvent ):void\n{\n    trace( "location updated: ["+event.position.latitude+","+event.position.longitude +"]");\n}\n')),(0,i.kt)("h3",{id:"android-background-updates"},"Android Background Updates"),(0,i.kt)("p",null,"In an effort to reduce power consumption, Android 8.0 (API level 26) limits how frequently background apps can retrieve the user's current location. Apps can receive location updates only a few times each hour."),(0,i.kt)("p",null,"This location retrieval behavior is particularly important to keep in mind if your app relies on real-time alerts or motion detection while running in the background."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Reference: ",(0,i.kt)("a",{parentName:"p",href:"https://developer.android.com/about/versions/oreo/background-location-limits"},"https://developer.android.com/about/versions/oreo/background-location-limits"))),(0,i.kt)("p",null,"In order to get frequent updates when in the background we can launch a foreground service which will continue to receive location updates. Foreground services require a notification so additionally we create a notification and display it to the user. This notification when clicked will launch your application."),(0,i.kt)("p",null,"To enable this background operation you must set the ",(0,i.kt)("inlineCode",{parentName:"p"},"persistInBackground")," option on your ",(0,i.kt)("inlineCode",{parentName:"p"},"LocationRequest")," by calling ",(0,i.kt)("inlineCode",{parentName:"p"},"setPersistInBackground()"),".\nThis function takes two parameters. The first is the value for ",(0,i.kt)("inlineCode",{parentName:"p"},"persistInBackground")," which should be ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," if you wish to enable the foreground service for background location updates. And the second is the text to display in the ongoing notification."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},'var request:LocationRequest = new LocationRequest()\n    .setAccuracy( LocationRequest.ACCURACY_NEAREST_TEN_METERS )\n    .setPriority( LocationRequest.PRIORITY_BALANCED_POWER_ACCURACY )\n\n    .setPersistInBackground( true, "Tracking location for mapping" );\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Note: You should only do this if location updates in the background are critical to your applications core functionality.")),(0,i.kt)("h2",{id:"stop-location-monitoring"},"Stop Location Monitoring"),(0,i.kt)("p",null,"Stopping location updates is simply a matter of calling ",(0,i.kt)("inlineCode",{parentName:"p"},"stopLocationMonitoring")," and removing\nany ",(0,i.kt)("inlineCode",{parentName:"p"},"LocationEvent.UPDATE")," listeners you may have been using."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"Location.service.removeEventListener( LocationEvent.UPDATE, location_updateHandler );\n\nvar success:Boolean = Location.service.stopLocationMonitoring();\n")),(0,i.kt)("h2",{id:"update-url"},"Update URL"),(0,i.kt)("p",null,"As part of the location request you can specify a url that the extension will pass the\nlocation information whenever a location update is received."),(0,i.kt)("p",null,"This can be useful in situations where the application is running in the background\n(or even terminated on Android) the update url will still be contacted where AS3 code\nmay not run. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},'var request:LocationRequest = new LocationRequest()\n    .setAccuracy( LocationRequest.ACCURACY_NEAREST_TEN_METERS )\n    .setPriority( LocationRequest.PRIORITY_BALANCED_POWER_ACCURACY );\n\nrequest.setServerUpdate( \n    "http://example.com/locationupdate",\n    "YOUR_CUSTOM_DATA_STRING"\n);\n\nLocation.service.startLocationMonitoring( request );\n')),(0,i.kt)("p",null,"The extension will send a json payload to the url containing the following structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "location": { \n        "altitude": 0.00,\n        "latitude": 0.00,\n        "longitude": 0.00,\n        "timestamp": 000000000\n    },\n    "data": "YOUR_CUSTOM_DATA_STRING"\n}\n')),(0,i.kt)("h2",{id:"mock-locations"},"Mock Locations"),(0,i.kt)("p",null,"In some circumstances it is possible for a user to download an app and send mock locations to your application. "),(0,i.kt)("p",null,"We can detect if the location reported is from a mock location provider by checking the ",(0,i.kt)("inlineCode",{parentName:"p"},"isMockLocation")," property of the reported ",(0,i.kt)("inlineCode",{parentName:"p"},"Position"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-actionscript"},"function location_updateHandler( event:LocationEvent ):void\n{\n    if (event.position.isMockLocation)\n    {\n        // This is a mock location - handle as appropriate for your application \n    }\n}\n")),(0,i.kt)("p",null,"If you are using the location for some specific user tracking you may find it important to ignore any mock location values."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Currently supported on Android only. iOS will always return ",(0,i.kt)("inlineCode",{parentName:"p"},"false")," for this value")))}d.isMDXComponent=!0}}]);