"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[85102],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return h}});var i=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=i.createContext({}),s=function(e){var n=i.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return i.createElement(p.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},c=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=s(t),h=r,m=c["".concat(p,".").concat(h)]||c[h]||d[h]||a;return t?i.createElement(m,o(o({ref:n},u),{},{components:t})):i.createElement(m,o({ref:n},u))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,o=new Array(a);o[0]=c;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<a;s++)o[s]=t[s];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}c.displayName="MDXCreateElement"},4244:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return s},default:function(){return d}});var i=t(87462),r=t(63366),a=(t(67294),t(3905)),o={title:"Auth - Provider - Apple",sidebar_label:"Apple"},l="Sign in with Apple",p={unversionedId:"firebase/auth/provider/apple",id:"firebase/auth/provider/apple",isDocsHomePage:!1,title:"Auth - Provider - Apple",description:"You can let your users authenticate with Firebase using their Apple ID by using the Firebase SDK and the Apple Sign In extension to carry out the end-to-end OAuth 2.0 sign-in flow.",source:"@site/docs/firebase/auth/provider/apple.md",sourceDirName:"firebase/auth/provider",slug:"/firebase/auth/provider/apple",permalink:"/docs/firebase/auth/provider/apple",tags:[],version:"current",frontMatter:{title:"Auth - Provider - Apple",sidebar_label:"Apple"},sidebar:"firebase",previous:{title:"Microsoft",permalink:"/docs/firebase/auth/provider/microsoft"},next:{title:"Facebook",permalink:"/docs/firebase/auth/provider/facebook"}},s=[{value:"Setup",id:"setup",children:[]},{value:"iOS",id:"ios",children:[{value:"Sign in with Apple",id:"sign-in-with-apple-1",children:[]},{value:"Authenticate with Firebase",id:"authenticate-with-firebase",children:[]}]},{value:"Android",id:"android",children:[]},{value:"Next Steps",id:"next-steps",children:[]},{value:"Example",id:"example",children:[]}],u={toc:s};function d(e){var n=e.components,o=(0,r.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,i.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"sign-in-with-apple"},"Sign in with Apple"),(0,a.kt)("p",null,"You can let your users authenticate with Firebase using their Apple ID by using the Firebase SDK and the Apple Sign In extension to carry out the end-to-end OAuth 2.0 sign-in flow."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Important: To sign in with an Apple account, users must:"),(0,a.kt)("ul",{parentName:"blockquote"},(0,a.kt)("li",{parentName:"ul"},"Have an Apple ID with two-factor authentication (2FA) enabled."),(0,a.kt)("li",{parentName:"ul"},"Be signed in to iCloud on an Apple device.")),(0,a.kt)("p",{parentName:"blockquote"},"See ",(0,a.kt)("a",{parentName:"p",href:"https://support.apple.com/en-us/HT210318"},"How to use Sign in with Apple"),". You will also need to meet these requirements to test your integration with Sign In with Apple.")),(0,a.kt)("h2",{id:"setup"},"Setup"),(0,a.kt)("p",null,"To sign in users using Apple, first configure Sign In with Apple on Apple's developer site, then enable Apple as a sign-in provider for your Firebase project."),(0,a.kt)("p",null,"Follow the guide in the:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/distriqt/ANE-AppleSignIn/wiki/i.Setup-Application"},"Apple Sign In extension")),(0,a.kt)("li",{parentName:"ul"},"or ",(0,a.kt)("a",{parentName:"li",href:"https://firebase.google.com/docs/auth/android/apple#configure-sign-in-with-apple"},"Firebase documentation"))),(0,a.kt)("h2",{id:"ios"},"iOS"),(0,a.kt)("p",null,'For iOS devices you will need access to the AppleSignIn extension to perform the "Sign in with Apple".'),(0,a.kt)("p",null,"The iOS authentication with Firebase is a two step process similar to many of the other providers. You will firstly perform the normal Sign in with Apple process and then authenticate with Firebase."),(0,a.kt)("h3",{id:"sign-in-with-apple-1"},"Sign in with Apple"),(0,a.kt)("p",null,"To perform this step you will need to add the AppleSignIn extension.  "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/distriqt/ANE-AppleSignIn/wiki/i.Add-the-Extension#ios"},"https://github.com/distriqt/ANE-AppleSignIn/wiki/i.Add-the-Extension#ios"))),(0,a.kt)("p",null,"Then to perform the actual sign in setup the standard  ",(0,a.kt)("inlineCode",{parentName:"p"},"AppleSignInOptions")," and call ",(0,a.kt)("inlineCode",{parentName:"p"},"loginWithAppleId()"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'AppleSignIn.instance.addEventListener( AppleSignInErrorEvent.ERROR, errorHandler );\nAppleSignIn.instance.addEventListener( AppleSignInEvent.SUCCESS, successHandler );\n\nvar options:AppleSignInOptions = new AppleSignInOptions()\n        .setRequestedScopes([\n                AppleSignInScopes.FULL_NAME,\n                AppleSignInScopes.EMAIL\n                            ]);\n\nAppleSignIn.instance.loginWithAppleId( options );\n\nfunction successHandler( event:AppleSignInEvent ):void\n{\n    // Continue to Authenticate with Firebase\n}\n\nfunction errorHandler( event:AppleSignInErrorEvent ):void\n{\n    // Handle the error as required by your application\n    trace( "errorHandler(): [" + event.errorID + "] :: " + event.text  );\n}\n')),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(8211).Z})),(0,a.kt)("h3",{id:"authenticate-with-firebase"},"Authenticate with Firebase"),(0,a.kt)("p",null,"Once you have successfully performed the Sign in with Apple you will need to use the Apple Id credentials to construct a Firebase ",(0,a.kt)("inlineCode",{parentName:"p"},"OAuthCredential"),". You will need the ID Token and the raw nonce from the success event."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"It is important to note that the credentials returned from the Apple Sign In ANE are base64 encoded so you will need to decode them before passing to Firebase")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"var identityToken:String = Base64.decode( event.appleIdCredential.identityToken );\nvar rawNonce:String = event.rawNonce;\n")),(0,a.kt)("p",null,"Then use these values to create the ",(0,a.kt)("inlineCode",{parentName:"p"},"OAuthCredential")," using ",(0,a.kt)("inlineCode",{parentName:"p"},"apple.com")," as the provider id:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'var credential:OAuthCredential =\n        OAuthProvider.getCredential( "apple.com" )\n            .setIdTokenWithRawNonce(\n                    identityToken,\n                    rawNonce\n            );\n')),(0,a.kt)("p",null,"Once you have created the ",(0,a.kt)("inlineCode",{parentName:"p"},"OAuthCredential")," object you call ",(0,a.kt)("inlineCode",{parentName:"p"},"signInWithCredential()")," passing in this ",(0,a.kt)("inlineCode",{parentName:"p"},"credential")," object:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"var success:Boolean = FirebaseAuth.service.signInWithCredential( credential );\n")),(0,a.kt)("p",null,"This may return ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," if your ",(0,a.kt)("inlineCode",{parentName:"p"},"credential")," was invalid. "),(0,a.kt)("p",null,"If successful you will receive the ",(0,a.kt)("inlineCode",{parentName:"p"},"FirebaseAuthEvent.SIGNIN_WITH_CREDENTIAL_COMPLETE")," which will indicate the success of the sign in:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'FirebaseAuth.service.addEventListener( FirebaseAuthEvent.SIGNIN_WITH_CREDENTIAL_COMPLETE, signInWithCredential_completeHandler );\n\nFirebaseAuth.service.signInWithCredential( credential );\n\n\nfunction signInWithCredential_completeHandler( event:FirebaseAuthEvent ):void\n{\n    trace("signInWithCredential_completeHandler(): " + event.success );\n}\n')),(0,a.kt)("h2",{id:"android"},"Android"),(0,a.kt)("p",null,"The AppleSignIn extension is not required for Android, the parts that we implemented in that ANE are replicated by Firebase.  The easiest way to authenticate your users with Firebase using their Apple accounts is to handle the entire sign-in flow with the Firebase Android SDK."),(0,a.kt)("p",null,"To handle the sign-in flow with the Firebase Android SDK, follow these steps:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Construct an instance of the ",(0,a.kt)("inlineCode",{parentName:"li"},"OAuthProvider"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'var provider:OAuthProvider = new OAuthProvider( "apple.com" );\n')),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Optional"),": Specify additional OAuth 2.0 scopes beyond the default that you want to request from the authentication provider using ",(0,a.kt)("inlineCode",{parentName:"li"},"setScopes()"),":")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'var provider:OAuthProvider = new OAuthProvider( "apple.com" )\n        .setScopes([ "email", "name" ]);\n')),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Optional"),": If you want to display Apple's sign-in screen in a language other than English, set the locale parameter.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'var provider:OAuthProvider = new OAuthProvider( "apple.com" )\n        .setScopes([ "email", "name" ])\n        .addCustomParameter("locale", "fr")\n;\n')),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"Authenticate with Firebase using the OAuth provider object by calling ",(0,a.kt)("inlineCode",{parentName:"li"},"startSignInWithProvider")," and awaiting the ",(0,a.kt)("inlineCode",{parentName:"li"},"FirebaseAuthEvent.SIGNIN_WITH_PROVIDER_COMPLETE"),". Note that unlike other FirebaseAuth operations, this will take control of your UI by opening a Custom Chrome Tab. ")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"FirebaseAuth.service.startSignInWithProvider( provider );\n")),(0,a.kt)("p",null,"This completes with the ",(0,a.kt)("inlineCode",{parentName:"p"},"FirebaseAuthEvent.SIGNIN_WITH_PROVIDER_COMPLETE")," event:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'FirebaseAuth.service.addEventListener(\n        FirebaseAuthEvent.SIGNIN_WITH_PROVIDER_COMPLETE,\n        startSignInWithProvider_completeHandler\n);\n\nFirebaseAuth.service.startSignInWithProvider( provider );\n\nfunction startSignInWithProvider_completeHandler( event:FirebaseAuthEvent ):void\n{\n    trace( "startSignInWithProvider_completeHandler():complete:" + event.success );\n}\n')),(0,a.kt)("p",null,(0,a.kt)("img",{src:t(74473).Z})),(0,a.kt)("h2",{id:"next-steps"},"Next Steps"),(0,a.kt)("p",null,"Once you have completed the authentication with Firebase ou should expect the normal ",(0,a.kt)("inlineCode",{parentName:"p"},"FirebaseAuthEvent.AUTHSTATE_CHANGED")," event indicating that a user was authenticated and then you will be able to retrieve the user's details using the standard ",(0,a.kt)("inlineCode",{parentName:"p"},"getCurrentUser()")," where one of the providers will be the Apple details."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'var user:FirebaseUser = FirebaseAuth.service.getCurrentUser();\nif (user != null)\n{\n    log( "identifier:  " + user.identifier );\n    log( "displayName: " + user.displayName );\n    log( "email:       " + user.email );\n    \n    for each (var info:UserInfo in user.providers)\n    {\n        log( "------------------" );\n        log( "\\tprovider:    " + info.providerId );\n        log( "\\tidentifier:  " + info.identifier );\n        log( "\\tdisplayName: " + info.displayName );\n        log( "\\temail:       " + info.email );\n        log( "\\tphone:       " + info.phoneNumber );\n    }\n}\n')),(0,a.kt)("p",null,"Unlike other providers supported by Firebase Auth, Apple does not provide a photo URL."),(0,a.kt)("p",null,"Also, when the user chooses not to share their email with the app, Apple provisions a unique email address for that user (of the form ",(0,a.kt)("a",{parentName:"p",href:"mailto:xyz@privaterelay.appleid.com"},"xyz@privaterelay.appleid.com"),"), which it shares with your app. If you configured the private email relay service, Apple forwards emails sent to the anonymized address to the user's real email address."),(0,a.kt)("p",null,"Apple only shares user information such as the display name with apps the first time a user signs in. Usually, Firebase stores the display name the first time a user signs in with Apple, which you can get with the above. However, if you previously used Apple to sign a user in to the app without using Firebase, Apple will not provide Firebase with the user's display name."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"The following example demonstrates how to use the above concepts across both Android and iOS using the auth state changed event to listen for the user authentication."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},'FirebaseAuth.service.addEventListener( FirebaseAuthEvent.AUTHSTATE_CHANGED, authState_changedHandler );\n\nif (FirebaseAuth.service.implementation == "Android")\n{\n    FirebaseAuth.service.addEventListener(\n            FirebaseAuthEvent.SIGNIN_WITH_PROVIDER_COMPLETE,\n            startSignInWithProvider_completeHandler\n    );\n    \n    var provider:OAuthProvider = new OAuthProvider( "apple.com" )\n            .setScopes([ "email", "name" ])\n    ;\n    \n    FirebaseAuth.service.startSignInWithProvider( provider );\n}\nelse if (FirebaseAuth.service.implementation == "iOS")\n{\n    AppleSignIn.instance.addEventListener( AppleSignInErrorEvent.ERROR, appleSignIn_errorHandler );\n    AppleSignIn.service.addEventListener( AppleSignInEvent.SUCCESS, appleSignIn_successHandler );\n    \n    var options:AppleSignInOptions = new AppleSignInOptions()\n            .setRequestedScopes([\n                                    AppleSignInScopes.FULL_NAME,\n                                    AppleSignInScopes.EMAIL\n                                ]);\n    \n    AppleSignIn.service.loginWithAppleId( options );\n}\n\n\nfunction startSignInWithProvider_completeHandler( event:FirebaseAuthEvent ):void\n{\n    // End of the Android sign in process\n    trace( "startSignInWithProvider_completeHandler():complete:" + event.success );\n}\n\n\nfunction appleSignIn_successHandler( event:AppleSignInEvent ):void\n{\n    var credential:OAuthCredential =\n                OAuthProvider.getCredential( "apple.com" )\n                    .setIdTokenWithRawNonce(\n                            Base64.decode( event.appleIdCredential.identityToken ),\n                            event.rawNonce\n                    );\n    \n    FirebaseAuth.service.addEventListener( \n            FirebaseAuthEvent.SIGNIN_WITH_CREDENTIAL_COMPLETE, \n            signInWithCredential_completeHandler \n    );\n    \n    FirebaseAuth.service.signInWithCredential( credential );\n}\n\nfunction appleSignIn_errorHandler( event:AppleSignInErrorEvent ):void\n{\n    trace( "errorHandler(): [" + event.errorID + "] :: " + event.text  );\n}\n\n\nfunction signInWithCredential_completeHandler( event:FirebaseAuthEvent ):void\n{\n    // End of the iOS sign in process\n    trace("signInWithCredential_completeHandler(): " + event.success );\n}\n\n\nfunction authState_changedHandler( event:FirebaseAuthEvent ):void\n{\n    // This will be fired on both iOS and Android when the user is authenticated \n    trace( "auth state changed: "+FirebaseAuth.service.isSignedIn() );\n}\n')))}d.isMDXComponent=!0},74473:function(e,n,t){n.Z=t.p+"assets/images/auth_signinwithapple_android-ff7ae3be9f544d0802fb92b57f241841.png"},8211:function(e,n,t){n.Z=t.p+"assets/images/auth_signinwithapple_ios-78e06a686a3b4e77979fbb536058b263.png"}}]);