"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[15289],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>g});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),p=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},l=function(e){var n=p(e.components);return r.createElement(c.Provider,{value:n},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,l=o(e,["components","mdxType","originalType","parentName"]),u=p(t),d=a,g=u["".concat(c,".").concat(d)]||u[d]||h[d]||i;return t?r.createElement(g,s(s({ref:n},l),{},{components:t})):r.createElement(g,s({ref:n},l))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=d;var o={};for(var c in n)hasOwnProperty.call(n,c)&&(o[c]=n[c]);o.originalType=e,o[u]="string"==typeof e?e:a,s[1]=o;for(var p=2;p<i;p++)s[p]=t[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},56026:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var r=t(87462),a=(t(67294),t(3905));const i={title:"Restore Purchases",sidebar_label:"Restore Purchases"},s=void 0,o={unversionedId:"inappbilling/restore-purchases",id:"inappbilling/restore-purchases",title:"Restore Purchases",description:"Restoring purchases is a process that you should allow for user's who have either changed devices",source:"@site/docs/inappbilling/restore-purchases.md",sourceDirName:"inappbilling",slug:"/inappbilling/restore-purchases",permalink:"/docs/inappbilling/restore-purchases",draft:!1,tags:[],version:"current",frontMatter:{title:"Restore Purchases",sidebar_label:"Restore Purchases"},sidebar:"inappbilling",previous:{title:"Pending Purchases",permalink:"/docs/inappbilling/pending-purchases"},next:{title:"Get Purchases",permalink:"/docs/inappbilling/get-purchases"}},c={},p=[],l={toc:p},u="wrapper";function h(e){let{components:n,...t}=e;return(0,a.kt)(u,(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Restoring purchases is a process that you should allow for user's who have either changed devices\nor reinstalled your application and hence need to gain access to their purchases again. It should not be an automatic process but one done through user interaction. "),(0,a.kt)("admonition",{title:"App Store Review",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},(0,a.kt)("strong",{parentName:"p"},"This process must be available to your users and must initiated by user interaction in order to pass App Store review.")),(0,a.kt)("p",{parentName:"admonition"},"To satisfy this requirement, you must provide a button somewhere in your application to initiate this restore process. Generally somewhere like your application settings is an appropriate place to have a restore purchases functionality."),(0,a.kt)("p",{parentName:"admonition"},"For more information on the concepts you can read the Apple documentation ",(0,a.kt)("a",{parentName:"p",href:"https://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/StoreKitGuide/Chapters/Restoring.html"},"here"),".")),(0,a.kt)("p",null,"For retrieving purchases without user interaction see the ",(0,a.kt)("a",{parentName:"p",href:"/docs/inappbilling/get-purchases"},"Get Purchases")," functionality."),(0,a.kt)("p",null,"The restoring purchases process starts by calling the ",(0,a.kt)("inlineCode",{parentName:"p"},"restorePurchases")," function and concludes with either a success (",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBillingEvent.RESTORE_PURCHASES_SUCCESS"),") or failure (",(0,a.kt)("inlineCode",{parentName:"p"},"InAppBillingEvent.RESTORE_PURCHASES_FAILED"),") event. "),(0,a.kt)("p",null,"After calling ",(0,a.kt)("inlineCode",{parentName:"p"},"restorePurchases")," you will a receive ",(0,a.kt)("inlineCode",{parentName:"p"},"PurchaseEvent.PURCHASES_UPDATED")," dispatched\nwhich will contained ",(0,a.kt)("inlineCode",{parentName:"p"},"Purchase")," objects in the restored state having the original purchase\nvariable representing the original purchase transaction."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-actionscript"},"// The service must be setup and a list of products retrieved.\n\n// Make sure you have added your purchases handler\nInAppBilling.service.addEventListener( PurchaseEvent.PURCHASES_UPDATED, purchases_updatedHandler );\n\nInAppBilling.service.addEventListener( InAppBillingEvent.RESTORE_PURCHASES_SUCCESS, restorePurchases_successHandler );\nInAppBilling.service.addEventListener( InAppBillingEvent.RESTORE_PURCHASES_FAILED, restorePurchases_failedHandler );\n\n// Start the restore process\nInAppBilling.service.restorePurchases();\n\n\n//\n//\n//\n\nfunction purchases_updatedHandler( event:PurchaseEvent ):void\n{\n    for each (var purchase:Purchase in event.data)\n    {\n        switch (purchase.transactionState)\n        {\n\n            //  Other states...\n\n\n            case Purchase.STATE_RESTORED:\n                // The originalPurchase property will contain all the \n                // information on the original transaction allowing \n                // you to restore the user's product\n                \n                addPurchaseToInventory( purchase.originalPurchase );\n                InAppBilling.service.finishPurchase( purchase );\n                \n                // Again you could hold on to this purchase and check it against \n                // your application server before calling finishPurchase\n                break;\n\n\n        }\n    }   \n}\n\n\n//\n//  RESTORE PURCHASE EVENTS\n//\n\nfunction restorePurchases_successHandler( event:InAppBillingEvent ):void\n{\n    // Called when all purchases have been restored\n    // This event contains no data\n}\n\nfunction restorePurchases_failedHandler( event:InAppBillingEvent ):void\n{\n    // Called if there was an error restoring purchases\n}\n")))}h.isMDXComponent=!0}}]);