"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[2657],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),h=c(n),d=a,f=h["".concat(s,".").concat(d)]||h[d]||p[d]||i;return n?r.createElement(f,l(l({ref:t},u),{},{components:n})):r.createElement(f,l({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,l=new Array(i);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,l[1]=o;for(var c=2;c<i;c++)l[c]=n[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},81820:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return u},default:function(){return h}});var r=n(87462),a=n(63366),i=(n(67294),n(3905)),l=["components"],o={title:"Testing",sidebar_label:"Testing"},s=void 0,c={unversionedId:"inappbilling/testing",id:"inappbilling/testing",title:"Testing",description:"Test each part of your code to verify that you\u2019ve implemented it correctly.",source:"@site/docs/inappbilling/testing.md",sourceDirName:"inappbilling",slug:"/inappbilling/testing",permalink:"/docs/inappbilling/testing",tags:[],version:"current",frontMatter:{title:"Testing",sidebar_label:"Testing"},sidebar:"inappbilling",previous:{title:"Introductory Prices",permalink:"/docs/inappbilling/introductory-prices"},next:{title:"In App Updates",permalink:"/docs/inappbilling/in-app-updates"}},u=[{value:"Test a Payment Request",id:"test-a-payment-request",children:[],level:3},{value:"Test a Successful Purchase",id:"test-a-successful-purchase",children:[],level:3},{value:"Cancellation",id:"cancellation",children:[],level:3},{value:"Testing Deferred Purchases",id:"testing-deferred-purchases",children:[{value:"Google Play Billing",id:"google-play-billing",children:[],level:4}],level:3},{value:"Test an Interrupted Purchase",id:"test-an-interrupted-purchase",children:[],level:3},{value:"Verify That Purchases Are Finished",id:"verify-that-purchases-are-finished",children:[],level:3}],p={toc:u};function h(e){var t=e.components,o=(0,a.Z)(e,l);return(0,i.kt)("wrapper",(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Test each part of your code to verify that you\u2019ve implemented it correctly."),(0,i.kt)("p",null,"You should try and test as many scenarios as possible to make sure a purchase\nwon't be left in an invalid state. "),(0,i.kt)("p",null,"The following is a list of some common ones that you should test."),(0,i.kt)("h3",{id:"test-a-payment-request"},"Test a Payment Request"),(0,i.kt)("p",null,"Make a call to ",(0,i.kt)("inlineCode",{parentName:"p"},"makePurchase")," using a valid product identifier that you have already tested.\nSet a breakpoint and confirm that the purchase success event handler is called."),(0,i.kt)("p",null,"During testing, it\u2019s OK to finish the transaction immediately without providing the content.\nHowever, even during testing, failing to finish the purchase can cause problems, unfinished\npurchases can remain in the queue indefinitely, which could interfere with later testing."),(0,i.kt)("h3",{id:"test-a-successful-purchase"},"Test a Successful Purchase"),(0,i.kt)("p",null,"Use a test user account, and make a purchase in your app. "),(0,i.kt)("p",null,"Set a breakpoint at the point in your code that adds the purchase to your users inventory,\nand confirm that this code is called in response to a successful purchase."),(0,i.kt)("h3",{id:"cancellation"},"Cancellation"),(0,i.kt)("p",null,"Check that when a user cancels the purchase that your application correctly handles the response\nand returns your application to the normal state."),(0,i.kt)("p",null,"You will need to handle several scenarios here, including a cancelled purchase and a cancelled error."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"/docs/inappbilling/make-a-purchase#handling-user-cancellations"},"Handling User Cancellations")," for implementation details."),(0,i.kt)("h3",{id:"testing-deferred-purchases"},"Testing Deferred Purchases"),(0,i.kt)("h4",{id:"google-play-billing"},"Google Play Billing"),(0,i.kt)("p",null,"You will need to target api 28 or higher for deferred purchases. "),(0,i.kt)("p",null,"When you go to make a purchase ensure you have deployed at least one version to the a test channel (alpha/beta) and are signed in on your device using a test user."),(0,i.kt)("p",null,"Then when the purchase UI is displayed select the payment methods and you should see 4 available options:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(39135).Z,width:"1080",height:"1920"})),(0,i.kt)("p",null,'Select the "Slow test card" and proceed with your test purchase:'),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(49470).Z,width:"1080",height:"1920"})),(0,i.kt)("p",null,"The purchase will return as deferred and in a few minutes another event will trigger when the purchase succeeds. On the second event you should deliver the product and call finish purchase to acknowledge the purchase."),(0,i.kt)("h3",{id:"test-an-interrupted-purchase"},"Test an Interrupted Purchase"),(0,i.kt)("p",null,"On some services, purchases can be interrupted, it is important, particularly on iOS that\nyou can handle interrupted transactions."),(0,i.kt)("p",null,"Set a breakpoint in your code that adds the purchase to your users inventory so you\ncan control whether it delivers the product. "),(0,i.kt)("p",null,"Then make a purchase as usual in the test environment, and use the breakpoint to\ntemporarily ignore the transaction\u2014for example, by returning from the method immediately.\nDo not call ",(0,i.kt)("inlineCode",{parentName:"p"},"finishPurchase"),"."),(0,i.kt)("p",null,"Terminate and relaunch your app. "),(0,i.kt)("p",null,"The extension should dispatch the ",(0,i.kt)("inlineCode",{parentName:"p"},"PURCHASES_UPDATED")," event when you call ",(0,i.kt)("inlineCode",{parentName:"p"},"setup")," the service\nagain shortly after launch; this time, let your app respond normally. "),(0,i.kt)("p",null,"Verify that your app correctly delivers the product and completes the transaction."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"This is only applicable for services that require calling ",(0,i.kt)("inlineCode",{parentName:"p"},"finishPurchase"),", mainly the Apple's In-App Purchases.")),(0,i.kt)("h3",{id:"verify-that-purchases-are-finished"},"Verify That Purchases Are Finished"),(0,i.kt)("p",null,"Locate where your app calls the ",(0,i.kt)("inlineCode",{parentName:"p"},"finishPurchase")," method. You should call this whether or not\nthe service you are using requires it."),(0,i.kt)("p",null,"Verify that all work related to the transaction has been completed before the method\nis called and that the method is called for every transaction, whether it succeeded or failed."))}h.isMDXComponent=!0},39135:function(e,t,n){t.Z=n.p+"assets/images/googleplay_deferredpaymentmethod-ff10ecec41ccc276c3eef4891bfc5b5c.png"},49470:function(e,t,n){t.Z=n.p+"assets/images/googleplay_deferredpaymentmethod_purchase-0cdab7988ee15433061650e89cac1662.png"}}]);