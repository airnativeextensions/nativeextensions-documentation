"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[94725],{28453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>r});var s=t(96540);const i={},o=s.createContext(i);function d(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(o.Provider,{value:n},e.children)}},45684:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/amazon-testing-download-cbaf7b4dce4a7eda734dfe72bee948e2.png"},84389:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"inappbilling/amazon/testing","title":"Testing Amazon IAP","description":"Amazon In-App Purchasing","source":"@site/docs/inappbilling/amazon/testing.md","sourceDirName":"inappbilling/amazon","slug":"/inappbilling/amazon/testing","permalink":"/docs/inappbilling/amazon/testing","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Testing Amazon IAP","sidebar_label":"Testing"},"sidebar":"inappbilling","previous":{"title":"Setup","permalink":"/docs/inappbilling/amazon/amazon-in-app-purchasing"},"next":{"title":"Add the Extension","permalink":"/docs/inappbilling/huawei/add-the-extension"}}');var i=t(74848),o=t(28453);const d={title:"Testing Amazon IAP",sidebar_label:"Testing"},r=void 0,a={},l=[{value:"Amazon In-App Purchasing",id:"amazon-in-app-purchasing",level:2},{value:"Install and Configure the App Tester",id:"install-and-configure-the-app-tester",level:3},{value:"Create a JSON Data File",id:"create-a-json-data-file",level:3},{value:"Verify IAP Items",id:"verify-iap-items",level:3},{value:"Enter sandbox mode",id:"enter-sandbox-mode",level:3},{value:"Next Steps",id:"next-steps",level:3},{value:"Set Installer Package",id:"set-installer-package",level:2},{value:"Amazon Terms",id:"amazon-terms",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"amazon-in-app-purchasing",children:"Amazon In-App Purchasing"}),"\n",(0,i.jsx)(n.p,{children:"Amazon does not provide a complete \"sandbox\" type environment for testing like Google's In-App Billing and Apple's In-App Purchases."}),"\n",(0,i.jsxs)(n.p,{children:["Instead you will need to install and configure the ",(0,i.jsx)(n.strong,{children:"App Tester"})," application and utilise the app to intercept IAP calls."]}),"\n",(0,i.jsx)(n.h3,{id:"install-and-configure-the-app-tester",children:"Install and Configure the App Tester"}),"\n",(0,i.jsx)(n.p,{children:"App Tester allows you to unit test the In-App Purchasing (IAP) functionality of your app in sandbox mode before you submit the app for publication. You download App Tester from the Amazon Appstore onto the same Android device as your app. The App Tester simulates the production environment. You run IAP-related test cases on your app, and App Tester generates API responses (that you configure using a JSON file)."}),"\n",(0,i.jsx)(n.p,{children:"The easiest way is to install the app from the Amazon Appstore:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"On your Android mobile device, start the Amazon Appstore app."}),"\n",(0,i.jsx)(n.li,{children:'Search for "Amazon App Tester".'}),"\n",(0,i.jsx)(n.li,{children:'Select the "Amazon App Tester" app. (Do not select the Web App Tester, which is a different app.)'}),"\n",(0,i.jsx)(n.li,{children:"Tap through the prompts to download and install the app."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can also find the application at the following link:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"http://www.amazon.com/Amazon-App-Tester/dp/B00BN3YZM2/",children:"http://www.amazon.com/Amazon-App-Tester/dp/B00BN3YZM2/"})}),"\n",(0,i.jsx)(n.h3,{id:"create-a-json-data-file",children:"Create a JSON Data File"}),"\n",(0,i.jsx)(n.p,{children:"The App Tester responds to API calls using data stored in a JavaScript Object Notation (JSON) text file. The file contains purchase data for the IAP items."}),"\n",(0,i.jsx)(n.p,{children:"You can automatically create the JSON file through the Apps & Games Developer Portal."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"In a web browser, go to the your app's page on the Apps & Games Developer Portal."}),"\n",(0,i.jsx)(n.li,{children:"Add your IAP purchasable items to your app, if you have not already done so."}),"\n",(0,i.jsxs)(n.li,{children:["Export the IAPs to JSON by selecting: ",(0,i.jsx)(n.strong,{children:"Export Multiple IAPs / JSON"})]}),"\n",(0,i.jsx)(n.li,{children:"Click the link to download your JSON Data File."}),"\n",(0,i.jsx)(n.li,{children:'Name the downloaded file "amazon.sdktester.json".'}),"\n",(0,i.jsxs)(n.li,{children:["Copy the file to ",(0,i.jsx)(n.code,{children:"/mnt/sdcard/"})," folder in your device file system."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"adb push amazon.sdktester.json /mnt/sdcard/amazon.sdktester.json\n"})}),"\n",(0,i.jsx)(n.p,{children:"The location of the download link is as in the following screenshot:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:t(45684).A+"",width:"1186",height:"735"})}),"\n",(0,i.jsx)(n.h3,{id:"verify-iap-items",children:"Verify IAP Items"}),"\n",(0,i.jsxs)(n.p,{children:["You can easily review the contents of the JSON file. From the App Tester main menu, tap the ",(0,i.jsx)(n.strong,{children:"IAP Items in JSON File"})," option to display a human-readable list of the item data in the JSON file."]}),"\n",(0,i.jsx)(n.h3,{id:"enter-sandbox-mode",children:"Enter sandbox mode"}),"\n",(0,i.jsx)(n.p,{children:"Sandbox mode constrains calls that would normally go to the Appstore client to route to the Amazon App Tester app instead. Use this mode only for testing locally."}),"\n",(0,i.jsx)(n.p,{children:"In the same terminal where you connected to your Fire device through ADB, enter sandbox mode:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"adb shell setprop debug.amazon.sandboxmode debug\n"})}),"\n",(0,i.jsxs)(n.p,{children:["(Note that if you need to exit sandbox mode, run the following: ",(0,i.jsx)(n.code,{children:"adb shell setprop debug.amazon.sandboxmode none"}),".)"]}),"\n",(0,i.jsx)(n.p,{children:"Every time you reconnect to your Fire device through ADB, you need to reinitiate sandbox mode."}),"\n",(0,i.jsx)(n.p,{children:"To confirm you have sandbox mode enabled have a look in the adb logs for something like the following line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"D/Kiwi    (12294): AppstoreSDK: Sandbox Mode: Debug build and debug.amazon.sandboxmode property is set on device\n"})}),"\n",(0,i.jsx)(n.p,{children:"If it is in production mode you will see something like the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"D/Kiwi    (11971): AppstoreSDK: Production Mode: Release build or debug.amazon.sandboxmode property is not set on devic\n"})}),"\n",(0,i.jsxs)(n.admonition,{title:"Packaging Target",type:"caution",children:[(0,i.jsxs)(n.p,{children:["It is important the you use a debug build target when testing Amazon applications, ie. you must use ",(0,i.jsx)(n.code,{children:"-target apk-debug"}),". This ensures AIR produces a debug build of your application that allows the Amazon AppstoreSDK to enter debug mode."]}),(0,i.jsxs)(n.p,{children:["If you use a release target eg ",(0,i.jsx)(n.code,{children:"apk-captive-runtime"}),' then you will always see the "Production mode" warning and won\'t be able to test.']})]}),"\n",(0,i.jsx)(n.admonition,{title:"AIR Version",type:"note",children:(0,i.jsx)(n.p,{children:"You must be using a recent release of AIR, version 33.1.1.889 or higher. APK's produced in older versions of AIR are always packaged as release builds. You can work around this by using the AndroidStudioProject output if required however we recommend updating the AIR SDK and using the debug target."})}),"\n",(0,i.jsx)(n.h3,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"Familiarize yourself with the App Tester tool and the test options for IAP:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Read the ",(0,i.jsx)(n.a,{href:"https://developer.amazon.com/docs/in-app-purchasing/iap-app-tester-user-guide.html",children:"App Tester User Guide"})," to learn how to use this tool."]}),"\n",(0,i.jsxs)(n.li,{children:["See ",(0,i.jsx)(n.a,{href:"https://developer.amazon.com/docs/in-app-purchasing/iap-design-test-cases.html",children:"Design and Execute Test Cases for IAP"})," for ideas on how to test your IAP functionality."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For more information on any of the processes here see the ",(0,i.jsx)(n.a,{href:"https://developer.amazon.com/docs/in-app-purchasing/iap-install-and-configure-app-tester.html",children:"Amazon documentation"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"set-installer-package",children:"Set Installer Package"}),"\n",(0,i.jsx)(n.p,{children:"If you are using a non-Amazon device with the Amazon App-Store installed to test you must set the correct installer package in order that the extension can correctly detect that the amazon service is supported."}),"\n",(0,i.jsxs)(n.p,{children:["When installing your application you will need to use the following commands using the ",(0,i.jsx)(n.code,{children:"adb"})," terminal command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'adb push YOURAPP.apk /data/local/tmp/app.apk\nadb shell pm install -i "com.amazon.venezia" -r /data/local/tmp/app.apk\nadb shell rm /data/local/tmp/app.apk\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Change ",(0,i.jsx)(n.code,{children:"YOURAPP.apk"})," to be the path to your application. This command will set the installer package name to be the Amazon AppStore's package name ",(0,i.jsx)(n.code,{children:"com.amazon.venezia"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"If you don't set this and rely on the default detection then you will find debugging may default to the Google Play Billing implementation."}),"\n",(0,i.jsx)(n.h2,{id:"amazon-terms",children:"Amazon Terms"}),"\n",(0,i.jsx)(n.p,{children:"In order to understand the difference between our implementation and the standard Amazon documentation the table belows shows where the associated Amazon methods are called by the extension. Most have a direct relationship between the Amazon call and the extension however there are some minor differences."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Amazon Method"}),(0,i.jsx)(n.th,{}),(0,i.jsx)(n.th,{children:"Extension Method"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"registerListener"})}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"setup"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getProductData"})}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getProducts"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"getPurchaseUpdates"})}),(0,i.jsx)(n.td,{}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getPurchases"})," & ",(0,i.jsx)(n.code,{children:"restorePurchases"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"purchase"})}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"makePurchase"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"notifyFulfillment"})}),(0,i.jsx)(n.td,{children:"entitlement and subscription products"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"finishPurchase"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"consumable products"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"consumePurchase"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Listener callbacks are mapped to extension events depending on the triggered call:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Amazon Listener Callback"}),(0,i.jsx)(n.th,{}),(0,i.jsx)(n.th,{children:"Extension Event(s)"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onProductDataResponse"})}),(0,i.jsx)(n.td,{children:"success"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ProductEvent.PRODUCTS_LOADED"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onProductDataResponse"})}),(0,i.jsx)(n.td,{children:"invalid SKU"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ProductEvent.PRODUCT_INVALID"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onProductDataResponse"})}),(0,i.jsx)(n.td,{children:"failed"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ProductEvent.PRODUCTS_FAILED"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPurchaseResponse"})}),(0,i.jsx)(n.td,{children:"success"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseEvent.PURCHASES_UPDATED"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPurchaseResponse"})}),(0,i.jsx)(n.td,{children:"failed"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseEvent.PURCHASE_FAILED"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPurchaseUpdatesResponse"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getPurchases"})," > success"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseEvent.GET_PURCHASES_COMPLETE"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPurchaseUpdatesResponse"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"getPurchases"})," > failed"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseEvent.GET_PURCHASES_FAILED"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPurchaseUpdatesResponse"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"restorePurchases"})," > success"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseEvent.RESTORE_PURCHASES_SUCCESS"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"onPurchaseUpdatesResponse"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"restorePurchases"})," > failed"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PurchaseEvent.RESTORE_PURCHASES_FAILED"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"This is provided only as a guide of the implementation to better utilise the Amazon documentation. The exact implementation is more complex."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);