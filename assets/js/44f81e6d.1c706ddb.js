"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[24877],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return c}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=d(n),c=o,h=m["".concat(l,".").concat(c)]||m[c]||p[c]||r;return n?a.createElement(h,s(s({ref:t},u),{},{components:n})):a.createElement(h,s({ref:t},u))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var d=2;d<r;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},69282:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return p}});var a=n(87462),o=n(63366),r=(n(67294),n(3905)),s=["components"],i={title:"User Messaging Platform",sidebar_label:"User Messaging Platform"},l=void 0,d={unversionedId:"adverts/user-messaging-platform",id:"adverts/user-messaging-platform",title:"User Messaging Platform",description:"Obtaining Consent with the User Messaging Platform",source:"@site/docs/adverts/user-messaging-platform.md",sourceDirName:"adverts",slug:"/adverts/user-messaging-platform",permalink:"/docs/adverts/user-messaging-platform",draft:!1,tags:[],version:"current",frontMatter:{title:"User Messaging Platform",sidebar_label:"User Messaging Platform"},sidebar:"adverts",previous:{title:"Test Ads",permalink:"/docs/adverts/test-ads"},next:{title:"Consent",permalink:"/docs/adverts/consent"}},u={},p=[{value:"Obtaining Consent with the User Messaging Platform",id:"obtaining-consent-with-the-user-messaging-platform",level:2},{value:"Introduction",id:"introduction",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Usage",id:"usage",level:2},{value:"Request Consent Information",id:"request-consent-information",level:3},{value:"Load a form if available",id:"load-a-form-if-available",level:3},{value:"Present the form if required",id:"present-the-form-if-required",level:3},{value:"Testing",id:"testing",level:2},{value:"Force a geography",id:"force-a-geography",level:3},{value:"Reset",id:"reset",level:3},{value:"Delay app measurement (optional)",id:"delay-app-measurement-optional",level:2},{value:"Android",id:"android",level:4},{value:"iOS",id:"ios",level:4}],m={toc:p};function c(e){var t=e.components,i=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"obtaining-consent-with-the-user-messaging-platform"},"Obtaining Consent with the User Messaging Platform"),(0,r.kt)("p",null,'Before attempting to integrate the SDK you should ensure you have created at least one form in the "Privacy & messaging" tab for your AdMob account.'),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Under the Google EU User Consent Policy, you must make certain disclosures to your users in the European Economic Area (EEA) along with the UK and obtain their consent to use cookies or other local storage, where legally required, and to use personal data (such as AdID) to serve ads. This policy reflects the requirements of the EU ePrivacy Directive and the General Data Protection Regulation (GDPR)."),(0,r.kt)("p",{parentName:"blockquote"},"To support publishers in meeting their duties under this policy, Google offers the User Messaging Platform (UMP) SDK, which replaces the previous open source Consent SDK. The UMP SDK has been updated to support the latest IAB standards. We've also simplified the process of setting up consent forms and listing ad providers. All of these configurations can now conveniently be handled in the Funding Choices UI."),(0,r.kt)("p",{parentName:"blockquote"},"It is a best practice to load a form every time the user launches your app, even if you determine consent is not required, so that the form is ready to display in case the user wishes to change their consent setting.")),(0,r.kt)("p",null,"The following guide only shows usage of the UMP SDK, it does not show you how to setup these forms and what forms you should present to your users."),(0,r.kt)("p",null,"For detailed instructions and guidance on these topics we suggest you read the guides created by Google ",(0,r.kt)("a",{parentName:"p",href:"https://support.google.com/admob/answer/10107561"},"about privacy & messaging"),"."),(0,r.kt)("h2",{id:"dependencies"},"Dependencies"),(0,r.kt)("admonition",{title:"Ad Identifier",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"UMP requires additional dependencies that aren't installed by default with the Adverts extension.\nIf you don't add the advertising identifier library the UMP calls will fail.")),(0,r.kt)("p",null,"UMP uses the advertising identifier which isn't installed by default with the Adverts extension now as it defaults to the new AppSet identifier."),(0,r.kt)("p",null,"In order to use UMP you will need to add the advertising identifier dependencies. We suggest you install the ",(0,r.kt)("a",{parentName:"p",href:"/docs/idfa/"},"IDFA")," extension to achieve this. "),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h3",{id:"request-consent-information"},"Request Consent Information"),(0,r.kt)("p",null,"You retrieve the consent information through the ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsentInformation")," instance accessible via:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"var consentInformation:ConsentInformation = Adverts.service.ump.getConsentInformation();\n")),(0,r.kt)("p",null,"This object has the consent information including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"consentInformation.getConsentStatus()"),": The current user consent status (see ",(0,r.kt)("inlineCode",{parentName:"li"},"ConsentStatus")," constants);"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"consentInformation.getConsentType()"),": The type of consent (see ",(0,r.kt)("inlineCode",{parentName:"li"},"ConsentType")," constants); ",(0,r.kt)("strong",{parentName:"li"},"Android only. This has been removed on iOS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"consentInformation.isConsentFormAvailable()"),": Whether a form is available to be loaded and displayed to the user;")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"It is recommended that you request an update of the consent information at every app launch. This will determine whether or not your user needs to provide consent.")),(0,r.kt)("p",null,"To update consent information call the  ",(0,r.kt)("inlineCode",{parentName:"p"},"requestConsentInfoUpdate()")," function on the consent information object."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"var params:ConsentRequestParameters = new ConsentRequestParameters();\n\nconsentInformation.requestConsentInfoUpdate( params );\n")),(0,r.kt)("p",null,"This will dispatch one of two possible events:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConsentInformationEvent.CONSENT_INFO_UPDATE_SUCCESS"),": When the consent information was updated successfully;"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConsentInformationEvent.CONSENT_INFO_UPDATE_FAILURE"),": When there was an error updating the consent information;")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},'var consentInformation:ConsentInformation = Adverts.service.ump.getConsentInformation();\nconsentInformation.addEventListener( ConsentInformationEvent.CONSENT_INFO_UPDATE_SUCCESS, updateSuccessHandler );\nconsentInformation.addEventListener( ConsentInformationEvent.CONSENT_INFO_UPDATE_FAILURE, updateFailureHandler );\n\n\nvar params:ConsentRequestParameters = new ConsentRequestParameters();\n\nconsentInformation.requestConsentInfoUpdate( params );\n\nfunction updateSuccessHandler( event:ConsentInformationEvent ):void\n{\n    // consent information has been updated\n}\n\nfunction updateFailureHandler( event:ConsentInformationEvent ):void\n{\n    trace( "ERROR: [" + event.error.errorID + "] " + event.error.message );\n}\n')),(0,r.kt)("h3",{id:"load-a-form-if-available"},"Load a form if available"),(0,r.kt)("p",null,"Once you've determined that you will ask a user for consent, the next step is to determine if a form is available."),(0,r.kt)("p",null,"There are a variety of reasons why a form may not be available, such as:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The user has limited ad tracking enabled."),(0,r.kt)("li",{parentName:"ul"},"You tagged the user as under the age of consent.")),(0,r.kt)("p",null,"To check if a form is available, use the ",(0,r.kt)("inlineCode",{parentName:"p"},"isConsentFormAvailable()")," method on the ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsentInformation")," instance. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"if (consentInformation.isConsentFormAvailable())\n{\n    // A form is available to load\n    Adverts.service.ump.addEventListener( UserMessagingPlatformEvent.CONSENT_FORM_LOAD_SUCCESS, loadFormSuccessHandler );\n    Adverts.service.ump.addEventListener( UserMessagingPlatformEvent.CONSENT_FORM_LOAD_FAILURE, loadFormFailureHandler );\n    Adverts.service.ump.loadConsentForm();\n}\n")),(0,r.kt)("p",null,"To load the form call the ",(0,r.kt)("inlineCode",{parentName:"p"},"loadConsentForm()")," of the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserMessagingPlatform")," instance.\nThis will dispatch one of two possible events:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"UserMessagingPlatformEvent.CONSENT_FORM_LOAD_SUCCESS"),": When the form has been loaded and is ready to be shown;"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"UserMessagingPlatformEvent.CONSENT_FORM_LOAD_FAILURE"),": When an error occurred, try again later to load the form successfully before attempting to show;")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"if (consentInformation.isConsentFormAvailable())\n{\n    Adverts.service.ump.addEventListener( UserMessagingPlatformEvent.CONSENT_FORM_LOAD_SUCCESS, loadFormSuccessHandler );\n    Adverts.service.ump.addEventListener( UserMessagingPlatformEvent.CONSENT_FORM_LOAD_FAILURE, loadFormFailureHandler );\n    Adverts.service.ump.loadConsentForm();\n}\n\nfunction loadFormSuccessHandler( event:UserMessagingPlatformEvent ):void\n{\n    // Form loaded and ready to be shown\n}\n\nfunction loadFormFailureHandler( event:UserMessagingPlatformEvent ):void\n{\n    // An error occurred\n}\n")),(0,r.kt)("h3",{id:"present-the-form-if-required"},"Present the form if required"),(0,r.kt)("p",null,"To present the form use the ",(0,r.kt)("inlineCode",{parentName:"p"},"showConsentForm()")," on the ",(0,r.kt)("inlineCode",{parentName:"p"},"UserMessagingPlatform")," instance."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"Adverts.service.ump.showConsentForm();\n")),(0,r.kt)("p",null,"You should determine if the user requires consent prior to presenting the form. To check if consent is required, check the ",(0,r.kt)("inlineCode",{parentName:"p"},"getConsentStatus()")," method on the ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsentInformation")," object, which returns an value from the ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsentStatus")," class. There are four possible values:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConsentStatus.UNKNOWN"),": Unknown consent status."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConsentStatus.REQUIRED"),": User consent required but not yet obtained."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConsentStatus.NOT_REQUIRED"),": User consent not required. For example, the user is not in the EEA or the UK."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ConsentStatus.OBTAINED"),": User consent obtained. Personalization not defined.")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"function loadFormSuccessHandler( event:UserMessagingPlatformEvent ):void\n{\n    // Form loaded and ready to be shown\n    if (Adverts.service.ump.getConsentInformation().getConsentStatus() == ConsentStatus.REQUIRED)\n    {\n        Adverts.service.ump.showConsentForm();\n    }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(1557).Z,width:"720",height:"720"})),(0,r.kt)("p",null,"You can also use the form to give your user the option to change their consent status. You may wish to do this in a settings screen, and call the ",(0,r.kt)("inlineCode",{parentName:"p"},"showConsentForm()")," to present the form so the user can change their consent as required."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"showConsentForm()")," process will dispatch the ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsentInformationEvent.CONSENT_FORM_DISMISSED")," event when the consent form was dismissed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"Adverts.service.ump.addEventListener( UserMessagingPlatformEvent.CONSENT_FORM_DISMISSED, formDismissedHandler );\nAdverts.service.ump.showConsentForm();\n\nfunction formDismissedHandler( event:UserMessagingPlatformEvent ):void \n{\n    // Handle form dismissal\n}\n")),(0,r.kt)("h2",{id:"testing"},"Testing"),(0,r.kt)("h3",{id:"force-a-geography"},"Force a geography"),(0,r.kt)("p",null,"The UMP SDK provides a simple way to test your app's behavior as though the device was located in the EEA or UK using the ",(0,r.kt)("inlineCode",{parentName:"p"},"debugGeography"),"."),(0,r.kt)("p",null,"You will need to provide your test device's hashed ID in your app's debug settings to use the debug functionality. If you call ",(0,r.kt)("inlineCode",{parentName:"p"},"requestConsentUpdate()")," without setting this value, your app will log the required ID hash when run to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/tutorials/device-logs"},"native device log"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},'var params:ConsentRequestParameters = new ConsentRequestParameters()\n        .setTagForUnderAgeOfConsent( false )\n        .setConsentDebugSettings(\n                new ConsentDebugSettings()\n                        .addTestDeviceHashedId( "TEST-DEVICE-HASHED-ID" )\n                        .setDebugGeography( com.distriqt.extension.adverts.ump.DebugGeography.DEBUG_GEOGRAPHY_EEA )\n        )\n;\n\nAdverts.service.ump.getConsentInformation()\n    .requestConsentInfoUpdate( params );\n')),(0,r.kt)("p",null,"To force the SDK to treat the device as though it is not in the EEA or UK, use ",(0,r.kt)("inlineCode",{parentName:"p"},"DEBUG_GEOGRAPHY_NOT_EEA"),".\nNote that debug settings only work on test devices. Emulators do not need to be added to the device id list as they have testing enabled by default."),(0,r.kt)("h3",{id:"reset"},"Reset"),(0,r.kt)("p",null,"In testing your app with the UMP SDK, you may find it helpful to reset the state of the consent SDK so that you can simulate a user's first install experience. The SDK provides the ",(0,r.kt)("inlineCode",{parentName:"p"},"reset()")," method of the ",(0,r.kt)("inlineCode",{parentName:"p"},"ConsentInformation")," interface to do this."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},"Adverts.service.ump.getConsentInformation().reset();\n")),(0,r.kt)("p",null,"You should also call reset if you decide to remove the UMP SDK completely from your project."),(0,r.kt)("h2",{id:"delay-app-measurement-optional"},"Delay app measurement (optional)"),(0,r.kt)("p",null,"By default, the Google Mobile Ads SDK initializes app measurement and begins sending user-level event data to Google immediately when the app starts. This initialization behavior ensures you can enable AdMob user metrics without making additional code changes."),(0,r.kt)("p",null,"However, if your app requires user consent before these events can be sent, you can delay app measurement until you explicitly initialize the Mobile Ads SDK or load an ad."),(0,r.kt)("h4",{id:"android"},"Android"),(0,r.kt)("p",null,"To delay app measurement, add the following ",(0,r.kt)("inlineCode",{parentName:"p"},"<meta-data>")," tag in your manifest additions, inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"<application>")," node:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'\x3c!-- Delay app measurement until MobileAds.initialize() is called. --\x3e\n<meta-data\n    android:name="com.google.android.gms.ads.DELAY_APP_MEASUREMENT_INIT"\n    android:value="true"/>\n')),(0,r.kt)("h4",{id:"ios"},"iOS"),(0,r.kt)("p",null,"To delay app measurement, add the ",(0,r.kt)("inlineCode",{parentName:"p"},"GADDelayAppMeasurementInit")," key with a boolean value of ",(0,r.kt)("inlineCode",{parentName:"p"},"true")," to your app\u2019s InfoAdditions:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},"<key>GADDelayAppMeasurementInit</key>\n<true/>\n")))}c.isMDXComponent=!0},1557:function(e,t,n){t.Z=n.p+"assets/images/ump_consent_form-caa615f26c09e346141aac11553a165d.png"}}]);