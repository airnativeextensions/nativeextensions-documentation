<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.0">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="air native extensions Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="air native extensions Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-188619114-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="air native extensions" href="/opensearch.xml"><title data-react-helmet="true">Peripheral Manager | air native extensions</title><meta data-react-helmet="true" property="og:url" content="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Peripheral Manager | air native extensions"><meta data-react-helmet="true" name="description" content="Acting as a Peripheral"><meta data-react-helmet="true" property="og:description" content="Acting as a Peripheral"><meta data-react-helmet="true" property="og:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.95805f25.css">
<link rel="preload" href="/assets/js/runtime~main.4bf04784.js" as="script">
<link rel="preload" href="/assets/js/main.c166f764.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/ane-icon-black.png" alt="AIR Native Extensions" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/ane-icon-white.png" alt="AIR Native Extensions" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">AIR Native Extensions</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/news/">News</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT"> </span></div><div class="react-toggle-track-x"><span class="toggle_71bT"> </span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/ane-icon-black.png" alt="AIR Native Extensions" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/ane-icon-white.png" alt="AIR Native Extensions" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">AIR Native Extensions</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/news/">News</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/bluetoothle">BluetoothLE</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bluetoothle/add-the-extension">Add the Extension</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bluetoothle/request-authorisation">Request Authorisation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Usage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bluetoothle/adapter-state">Adapter State</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bluetoothle/centrals-and-peripherals">Centrals and Peripherals</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bluetoothle/central-manager">Central Manager</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/bluetoothle/peripheral-manager">Peripheral Manager</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Help</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bluetoothle/migrating-to-androidx">Migrating to AndroidX</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/bluetoothle/changelog">changelog</a></li><li class="menu__list-item"><a href="https://docs.airnativeextensions.com/asdocs/bluetoothle/" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">asdocs</a></li><li class="menu__list-item"><a href="http://github.com/distriqt/ANE-BluetoothLE/issues/new" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN" tabindex="-1">Contact Support</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Peripheral Manager</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="acting-as-a-peripheral"></a>Acting as a Peripheral<a class="hash-link" href="#acting-as-a-peripheral" title="Direct link to heading">#</a></h2><p>In the last section, you learned how to perform the most common types of Bluetooth
low energy tasks from the central side. Here we will go through how to perform the
common Bluetooth low energy tasks from the peripheral side. The code-based examples
that follow will assist you in developing your app to implement the peripheral role
on your local device. Specifically, you will learn how to:</p><ul><li><a href="#set-up-services-and-characteristics">Set Up Services and Characteristics</a></li><li><a href="#publish-services-and-characteristics">Publish Services and Characteristics</a></li><li><a href="#advertise-services">Advertise Services</a></li><li><a href="#read-and-write-requests">Read and Write Requests</a></li><li><a href="#update-subscribed-centrals">Update Subscribed Centrals</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="set-up-services-and-characteristics"></a>Set Up Services and Characteristics<a class="hash-link" href="#set-up-services-and-characteristics" title="Direct link to heading">#</a></h3><p>The first step is to create an array of <code>Service</code>&#x27;s, each with an array of available
<code>Characteristic</code>&#x27;s. You can consider a <code>Service</code> as a group of data values or
<code>Characteristic</code>s. Each <code>Service</code> and <code>Characteristic</code> is uniquely defined by a <code>UUID</code>.</p><p>Though not all UUIDs that identify a service or characteristic are predefined by the
Bluetooth Special Interest Group (SIG), Bluetooth SIG has defined and published a
number of commonly used UUIDs that have been shortened to 16-bits for convenience.
For example, Bluetooth SIG has predefined the 16-bit UUID that identifies a heart
rate service as 180D. This UUID is shortened from its equivalent 128-bit UUID,
0000180D-0000-1000-8000-00805F9B34FB, which is based on the Bluetooth base UUID
that is defined in the Bluetooth 4.0 specification, Volume 3, Part F, Section 3.2.1.
When you use a predefined 16-bit UUID, the extension prefills the rest of 128-bit
UUID with the Bluetooth base UUID</p><p>You may have services and characteristics that are not identified by predefined
Bluetooth UUIDs. If you do, you need to generate your own 128-bit UUIDs to identify them.</p><p>Use the command-line utility uuidgen to easily generate 128-bit UUIDs. To get started,
open a window in Terminal. Next, for each service and characteristic that you need
to identify with a UUID, type uuidgen on the command line to receive a unique 128-bit
value in the form of an ASCII string that is punctuated by hyphens,
as in the following example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">$ uuidgen</span></div><div class="token-line" style="color:#393A34"><span class="token plain">90753043-6E40-4590-AFF6-5B48F6412E2F</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can then use this UUID to create your own Service and Characteristic objects.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = new Characteristic( &quot;E95E787B-9C88-4A8D-9A33-BA63EBC4A3A3&quot; );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">var service:Service = new Service();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">service.uuid = &quot;90753043-6E40-4590-AFF6-5B48F6412E2F&quot;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">service.characteristics.push( characteristic );</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="publish-services-and-characteristics"></a>Publish Services and Characteristics<a class="hash-link" href="#publish-services-and-characteristics" title="Direct link to heading">#</a></h3><p>Once you have created your <code>Service</code>&#x27;s and <code>Characteristic</code>&#x27;s you will then need to
publish these services to add them to the device&#x27;s database of services and
characteristics. This task involves calling the <code>addService</code> function of the <code>peripheralManager</code>.
At this time it is also important to note the <code>removeAllServices</code> function which can
be used to ensure that you don&#x27;t add duplicate services at each launch of your application.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = new Characteristic( &quot;E95E787B-9C88-4A8D-9A33-BA63EBC4A3A3&quot; );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">var service:Service = new Service();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">service.uuid = &quot;90753043-6E40-4590-AFF6-5B48F6412E2F&quot;;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">service.characteristics.push( characteristic );</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( PeripheralManagerEvent.SERVICE_ADD, peripheral_serviceAddHandler );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( PeripheralManagerEvent.SERVICE_ADD_ERROR, peripheral_serviceAddErrorHandler );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">// Remove all to prevent duplicate services (this only removes services added by this application)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.removeAllServices();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addService( service );</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You will receive a success or failure event from the addService call:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_serviceAddHandler( event:PeripheralManagerEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager service added&quot; );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_serviceAddErrorHandler( event:PeripheralManagerEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager service add error&quot; );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p>Note: After you publish a service and any of its associated characteristics to
the peripheral&#x27;s database, the service is cached and you can no longer make
changes to it.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="advertise-services"></a>Advertise Services<a class="hash-link" href="#advertise-services" title="Direct link to heading">#</a></h3><p>When you have published your services and characteristics to your device&#x27;s database
of services and characteristics, you are ready to start advertising some of them
to any centrals that may be listening. To start advertising call the
<code>startAdvertising</code> function on the <code>peripheralManager</code>. The first parameter is a
local name to advertise for the device and the second parameter is a vector array
of <code>Service</code> objects to advertise.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var service:Service = ...; // A previously created and published service</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( PeripheralManagerEvent.START_ADVERTISING, peripheral_startAdvertisingHandler );</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.startAdvertising( &quot;distriqt&quot;, new &lt;Service&gt;[ service ] );</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>When you start advertising some of the data on your local peripheral, the peripheral
manager dispatches the <code>PeripheralManagerEvent.START_ADVERTISING</code> event. Advertising
behavior is also affected when your app is in the background. You must make sure you
have correctly added the application descriptor additions to have permission to
advertise when in the background.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_startAdvertisingHandler( event:PeripheralManagerEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager start advertising&quot; );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Once you begin advertising data, remote centrals can discover and initiate a connection with you.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="read-and-write-requests"></a>Read and Write Requests<a class="hash-link" href="#read-and-write-requests" title="Direct link to heading">#</a></h3><p>After you are connected to one or more remote centrals, you may begin receiving read
or write requests from them. When you do, be sure to respond to those requests in an
appropriate manner. The following examples describe how to handle such requests.</p><p>When a connected central requests to read the value of one of your characteristics,
the peripheral manager dispatches the <code>RequestEvent.READ</code> event. The <code>RequestEvent</code> has
a number of properties that you can use to fulfill the request.</p><p>When you receive a read request you should make sure that the characteristic in
your device&#x27;s database matches the one that the remote central specified in the
original read request. If the characteristics match the next step is to make sure
that the read request isn&#x27;t asking to read from an index position that is outside
the bounds of your characteristic&#x27;s value. If the offset is invalid you should
respond with the <code>Request.INVALID_OFFSET</code> flag as in the example below.</p><p>Assuming the request&#x27;s offset is verified you can use the <code>respondToRequest</code> function
on the <code>peripheralManager</code> to send the data to the central. You should respect the
read offset and send the <code>Request.SUCCESS</code> flag and the requested data, as in the
example below.</p><p>Firstly add a listener for read requests:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = ...; // Some characteristic you have created and added to a published service</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( RequestEvent.READ, peripheral_readRequestHandler );</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then process these read requests when received:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_readRequestHandler( event:RequestEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //  Read requests will only have one object in the requests event</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var request:Request = event.requests[0];</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: read request: &quot; + request.characteristic.uuid );</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //  Handle the read request by first checking the UUID and then responding with the requested data.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //  You need to make sure you correctly handle the offset variable as illustrated below</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (request.characteristic.uuid == characteristic.uuid)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (request.offset &gt; characteristic.value.length)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            BluetoothLE.service.peripheralManager.respondToRequest( request, Request.INVALID_OFFSET );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            characteristic.value.position = 0;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            var data:ByteArray = new ByteArray();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            data.writeBytes( characteristic.value, request.offset, (characteristic.value.length - request.offset) );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            BluetoothLE.service.peripheralManager.respondToRequest( request, Request.SUCCESS, data );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p>Note: If the characteristics&#x27; UUIDs do not match, or if the read can not be
completed for any other reason, you should not attempt to fulfill the request.
Instead, you should call the <code>respondToRequest</code> function immediately with the
appropriate result flag from the <code>Request</code> class.</p></blockquote><p>Handling write requests from a connected central is also straightforward.
When a connected central sends a request to write the value of one or more
of your characteristics, the peripheral manager dispatches the
<code>RequestEvent.WRITE</code> event. With a write event the event may contain more
than one requests and you must process each request and call
<code>respondToRequest</code> <strong>only once</strong>. Be sure to take into account the request&#x27;s
offset property when writing the value of your characteristic</p><p>Add the write request listener:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = ...; // Some characteristic you have created and added to a published service</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( RequestEvent.WRITE, peripheral_writeRequestHandler );</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then handle the request:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_writeRequestHandler( event:RequestEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: write request: &quot; + event.requests.length );</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //  Write requests may have several requests and you should process each one</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //  before calling respondToRequest. You only need to call respondToRequest once</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    //  with the first request in the array</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    for each (var request:Request in event.requests)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        trace( &quot;peripheral manager: write request: &quot; + request.characteristic.uuid +&quot; :: [&quot; + request.offset +&quot;] &quot;+ request.value.readUTFBytes( request.value.length ) );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span></div><div class="token-line" style="color:#393A34"><span class="token plain">        if (request.characteristic.uuid == characteristic.uuid)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            if (request.offset + request.value.length &gt; MAX_VALUE_LENGTH)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                BluetoothLE.service.peripheralManager.respondToRequest( request, Request.INVALID_OFFSET );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                return;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                if (characteristic.value == null) characteristic.value = new ByteArray();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                characteristic.value.position = 0;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                characteristic.value.writeBytes( request.value, request.offset );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    BluetoothLE.service.peripheralManager.respondToRequest( event.requests[0], Request.SUCCESS );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><blockquote><p>You need to call <code>respondToRequest</code> <strong>exactly once</strong> per dispatched <code>RequestEvent</code>
no matter how many requests the event contains.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update-subscribed-centrals"></a>Update Subscribed Centrals<a class="hash-link" href="#update-subscribed-centrals" title="Direct link to heading">#</a></h3><p>Often, connected centrals will subscribe to one or more of your characteristic
values. When they do, you are responsible for sending them notifications when
the value of characteristic they subscribed to changes.</p><p>When a connected central subscribes to the value of one of your characteristics,
the peripheral manager dispatches the <code>CentralEvent.SUBSCRIBE</code> event and
similarly the <code>CentralEvent.UNSUBSCRIBE</code> when the central unsubscribes.
You should use these events as a cue to start/stop sending the updated values
to centrals.</p><p>Make sure you are listening for the events:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = ...; // Some characteristic you have created and added to a published service</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( CentralEvent.SUBSCRIBE, peripheral_central_subscribeHandler );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( CentralEvent.UNSUBSCRIBE, peripheral_central_unsubscribeHandler );</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then process the subscription and unsubscription:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly actionscript"><div tabindex="0" class="prism-code language-actionscript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_central_subscribeHandler( event:CentralEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: central subscribe: &quot; + event.central.uuid  );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // You should use this to track whether you should be periodically sending updates</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // For the moment we&#x27;ll just show as an example sending an update immediately</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    var value:ByteArray = new ByteArray();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    value.writeUTFBytes( &quot;some_updated_value&quot; );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    BluetoothLE.service.peripheralManager.updateValue( characteristic, value );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_central_unsubscribeHandler( event:CentralEvent ):void</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: central unsubscribe: &quot; + event.central.uuid  );</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    // If there are no other centrals subscribed you can stop periodically sending updates</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>updateValue</code> function returns a Boolean value that indicates whether
the update was successfully sent to the subscribed centrals. If the underlying
queue that is used to transmit the updated value is full, the method returns
<code>false</code> and you should wait and try again later.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/bluetoothle/central-manager"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Central Manager</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bluetoothle/migrating-to-androidx"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrating to AndroidX »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#acting-as-a-peripheral" class="table-of-contents__link">Acting as a Peripheral</a><ul><li><a href="#set-up-services-and-characteristics" class="table-of-contents__link">Set Up Services and Characteristics</a></li><li><a href="#publish-services-and-characteristics" class="table-of-contents__link">Publish Services and Characteristics</a></li><li><a href="#advertise-services" class="table-of-contents__link">Advertise Services</a></li><li><a href="#read-and-write-requests" class="table-of-contents__link">Read and Write Requests</a></li><li><a href="#update-subscribed-centrals" class="table-of-contents__link">Update Subscribed Centrals</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">tutorials</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item">twitter</a></li><li class="footer__item"><a href="https://github.com/Gamua/Adobe-Runtime-Support/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">AIR discussions</a></li><li class="footer__item"><a href="https://forum.starling-framework.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">starling</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item">stack overflow</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">news</a></li><li class="footer__item"><a href="https://airnativeextensions.com/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">privacy</a></li><li class="footer__item"><a href="https://airnativeextensions.com/license" target="_blank" rel="noopener noreferrer" class="footer__link-item">license</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><br><a href="https://airnativeextensions.com">airnativeextensions.com</a> copyright © 2021 <br><br><a href="https://distriqt.com"><img src="/img/logo.png" alt="distriqt"></a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.4bf04784.js"></script>
<script src="/assets/js/main.c166f764.js"></script>
</body>
</html>