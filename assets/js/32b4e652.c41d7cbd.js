"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[82954],{28453:(e,i,n)=>{n.d(i,{R:()=>p,x:()=>s});var t=n(96540);const r={},c=t.createContext(r);function p(e){const i=t.useContext(c);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:p(e.components),t.createElement(c.Provider,{value:i},e.children)}},70149:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>p,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"inappbilling/application-receipt","title":"Application Receipt","description":"The concepts here are relevant only to iOS, iPadOS and macOS using Apple\'s In-App Purchasing","source":"@site/docs/inappbilling/application-receipt.mdx","sourceDirName":"inappbilling","slug":"/inappbilling/application-receipt","permalink":"/docs/inappbilling/application-receipt","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Application Receipt","sidebar_label":"Application Receipt"},"sidebar":"inappbilling","previous":{"title":"Promotions","permalink":"/docs/inappbilling/promotions"},"next":{"title":"Subscription Offers","permalink":"/docs/inappbilling/subscription-offers"}}');var r=n(74848),c=n(28453);const p={title:"Application Receipt",sidebar_label:"Application Receipt"},s=void 0,a={},o=[{value:"Checking for support",id:"checking-for-support",level:3},{value:"Fetch the receipt data",id:"fetch-the-receipt-data",level:3},{value:"Refreshing the receipt",id:"refreshing-the-receipt",level:3},{value:"Events",id:"events",level:4},{value:"Callback",id:"callback",level:4}];function l(e){const i={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i.admonition,{type:"note",children:[(0,r.jsx)(i.mdxAdmonitionTitle,{}),(0,r.jsx)(i.p,{children:"The concepts here are relevant only to iOS, iPadOS and macOS using Apple's In-App Purchasing"})]}),"\n",(0,r.jsx)(i.p,{children:"The application receipt provides a record of the sale of an app and any purchases the person makes within the app."}),"\n",(0,r.jsx)(i.p,{children:"You can use this receipt to verify purchases and check expiration of subscriptions."}),"\n",(0,r.jsx)(i.p,{children:"There are two ways to verify a receipt's authenticity:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:["On your server with the App Store. Validating receipts with the App Store requires secure connections between your app and your server, and between your server and the App Store. For more information, see ",(0,r.jsx)(i.a,{href:"https://developer.apple.com/documentation/storekit/in-app_purchase/original_api_for_in-app_purchase/validating_receipts_with_the_app_store?language=objc",children:"Validating receipts with the App Store"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:["Locally, on the device. Validating receipts locally requires code that reads and validates a binary file that Apple encodes and signs as a PKCS #7 container. For more information, see ",(0,r.jsx)(i.a,{href:"https://developer.apple.com/documentation/appstorereceipts/validating_receipts_on_the_device?language=objc",children:"Validating receipts on the device"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"It is up to you to decide if this is required for your situation."}),"\n",(0,r.jsx)(i.admonition,{type:"info",children:(0,r.jsxs)(i.p,{children:['The "Application Receipt" variant performs local validation of the application receipt to retrieve purchase information and makes this information available through the ',(0,r.jsx)(i.a,{href:"get-purchases",children:"Get Purchases"})," API."]})}),"\n",(0,r.jsx)(i.h3,{id:"checking-for-support",children:"Checking for support"}),"\n",(0,r.jsxs)(i.p,{children:["You can check if the current device supports the application receipt by checking the ",(0,r.jsx)(i.code,{children:"isSupported"})," flag:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-actionscript",children:"if (InAppBilling.service.applicationReceipt.isSupported)\n{\n    // Application Receipt functionality is supported\n}\n"})}),"\n",(0,r.jsx)(i.h3,{id:"fetch-the-receipt-data",children:"Fetch the receipt data"}),"\n",(0,r.jsxs)(i.p,{children:["To retrieve the receipt call the ",(0,r.jsx)(i.code,{children:"getAppReceipt()"})," method:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-actionscript",children:"var appReceipt:String = InAppBilling.service.applicationReceipt.getAppReceipt();\n"})}),"\n",(0,r.jsx)(i.p,{children:"This returns the base 64 encoded contents of the application receipt file. Generally this is the string that you will likely send to Apple to verify the receipt."}),"\n",(0,r.jsxs)(i.blockquote,{children:["\n",(0,r.jsx)(i.p,{children:"The app receipt is always present in the production environment on devices running macOS, iOS, and iPadOS. The app receipt is also always present in TestFlight on devices running macOS. In the sandbox environment and in StoreKit Testing in Xcode, the app receipt is present only after the tester makes the first in-app purchase. If the app calls SKReceiptRefreshRequest or restoreCompletedTransactions, the app receipt is present only if the app has at least one in-app purchase."}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["If the receipt is empty i.e. ",(0,r.jsx)(i.code,{children:'appReceipt == ""'})," then you will need to refresh the receipt."]}),"\n",(0,r.jsx)(i.h3,{id:"refreshing-the-receipt",children:"Refreshing the receipt"}),"\n",(0,r.jsxs)(i.p,{children:["To refresh the receipt you call the ",(0,r.jsx)(i.code,{children:"refresh()"})," method:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-actionscript",children:"InAppBilling.service.applicationReceipt.refresh();\n"})}),"\n",(0,r.jsxs)(i.p,{children:["You can specify some properties for the refresh process through the first optional parameter to this function which is an instance of the ",(0,r.jsx)(i.code,{children:"ApplicationReceiptProperties"})," class,"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-actionscript",children:"var props:ApplicationReceiptProperties = new ApplicationReceiptProperties();\nprops.isVolumePurchase = true;\n\nInAppBilling.service.applicationReceipt.refresh( props );\n"})}),"\n",(0,r.jsxs)(i.p,{children:["The default value is ",(0,r.jsx)(i.code,{children:"null"}),"."]}),"\n",(0,r.jsx)(i.p,{children:"You can monitor the result of the refresh call either through the dispatched events or a callback."}),"\n",(0,r.jsx)(i.h4,{id:"events",children:"Events"}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"refresh()"})," method will dispatch one of two possible events:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"ApplicationReceiptEvent.REFRESH_SUCCESS"}),": Dispatched if the refresh succeeded;"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"ApplicationReceiptEvent.REFRESH_FAILED"}),": Dispatched if the refresh failed;"]}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-actionscript",children:'InAppBilling.service.applicationReceipt.addEventListener( \n    ApplicationReceiptEvent.REFRESH_FAILED,\n    refreshFailedHandler );\nInAppBilling.service.applicationReceipt.addEventListener( \n    ApplicationReceiptEvent.REFRESH_SUCCESS,\n    refreshSuccessHandler );\n\nfunction refreshSuccessHandler( event:ApplicationReceiptEvent ):void\n{\n    var appReceipt:String = InAppBilling.service.applicationReceipt.getAppReceipt();\n    trace( "getAppReceipt() = " + appReceipt );\n}\n\nfunction refreshFailedHandler( event:ApplicationReceiptEvent ):void\n{\n    trace( "application receipt refresh failed" + event.error );\n}\n'})}),"\n",(0,r.jsx)(i.h4,{id:"callback",children:"Callback"}),"\n",(0,r.jsxs)(i.p,{children:["You can pass a callback function as the second parameter to the ",(0,r.jsx)(i.code,{children:"refresh()"})," function, which will be called once the refresh process is complete. It must be of the form ",(0,r.jsx)(i.code,{children:"function( success:Boolean, error:Error ):void"})," for the function callback to be successful:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-actionscript",children:"InAppBilling.service.applicationReceipt.refresh( \n    null, \n    function( success:Boolean, error:Error ):void \n    {\n        // refresh complete, check success and error for any issues\n    });\n"})})]})}function h(e={}){const{wrapper:i}={...(0,c.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);