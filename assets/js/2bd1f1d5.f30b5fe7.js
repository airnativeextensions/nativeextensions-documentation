"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[63440],{22027:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"nativewebview/communication","title":"Communication","description":"One of the important aspects of this extension is the ability to communicate from your Actionscript","source":"@site/docs/nativewebview/communication.md","sourceDirName":"nativewebview","slug":"/nativewebview/communication","permalink":"/docs/nativewebview/communication","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Communication","sidebar_label":"Communication"},"sidebar":"nativewebview","previous":{"title":"Screenshot","permalink":"/docs/nativewebview/screenshot"},"next":{"title":"Location Changes","permalink":"/docs/nativewebview/location-changes"}}');var a=t(74848),s=t(28453);const r={title:"Communication",sidebar_label:"Communication"},o=void 0,c={},l=[{value:"Android",id:"android",level:2},{value:"Example",id:"example",level:2},{value:"AIR Bridge Code",id:"air-bridge-code",level:2},{value:"Sending parameters to Javascript",id:"sending-parameters-to-javascript",level:2}];function d(e){const n={code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"One of the important aspects of this extension is the ability to communicate from your Actionscript\ncode to the Javascript in the web page and vice-versa."}),"\n",(0,a.jsxs)(n.p,{children:["To do this there is a function on the actionscript side to run javascript in the page:\n",(0,a.jsx)(n.code,{children:"evaluateJavascript"}),". When this is called your code will be sent and run on the currently loaded\npage and any return value will be available by listening to the event: ",(0,a.jsx)(n.code,{children:"NativeWebViewEvent.JAVASCRIPT_RESPONSE"})]}),"\n",(0,a.jsxs)(n.p,{children:["On the javascript side, we have a helper script to simplify the communication back to the ",(0,a.jsx)(n.code,{children:"WebView"}),".\nCalling the ",(0,a.jsx)(n.code,{children:"AirBridge.message( 'content-for-air' );"})," in your Javascript will cause a\n",(0,a.jsx)(n.code,{children:"NativeWebViewEvent.JAVASCRIPT_MESSAGE"})," event to be dispatched with the data value containing\nthe message, 'content-for-air' in this case."]}),"\n",(0,a.jsx)(n.p,{children:"The two important events here are:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"NativeWebViewEvent.JAVASCRIPT_RESPONSE"}),": Dispatched for a response from an AS3 initiated javascript call;"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"NativeWebViewEvent.JAVASCRIPT_MESSAGE"}),": Dispatched when a message is received from javascript running on the page;"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"android",children:"Android"}),"\n",(0,a.jsxs)(n.p,{children:["On Android the communication channel is only completely setup after the page load is complete. I.e after ",(0,a.jsx)(n.code,{children:"NativeWebViewEvent.COMPLETE"}),". We suggest you wait for this event before attempting to communicate between the page and the application."]}),"\n",(0,a.jsxs)(n.p,{children:["To this end, we suggest implementing a function in your page that you call from AS3 after the ",(0,a.jsx)(n.code,{children:"NativeWebViewEvent.COMPLETE"})," event has fired, which initialises your communication channel."]}),"\n",(0,a.jsx)(n.p,{children:"We have implemented some handlers for this scenario but they may affect loading of the page and we suggest you take the above approach wherever possible."}),"\n",(0,a.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,a.jsx)(n.p,{children:"The following is an example from actionscript:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-actionscript",children:'var webView:WebView = NativeWebView.service.createWebView( new Rectangle( 0, 0, 400, 600 ) ) ;\n\nwebView.addEventListener( NativeWebViewEvent.COMPLETE, webView_completeHandler );\nwebView.addEventListener( NativeWebViewEvent.JAVASCRIPT_RESPONSE, javascriptResponseHandler );\nwebView.addEventListener( NativeWebViewEvent.JAVASCRIPT_MESSAGE, javascriptMessageHandler );\n\nvar file:File = File.applicationStorageDirectory.resolvePath( "example.html" );\n\nwebView.loadURL( "file://"+file.nativePath );\n\n\nfunction completeHandler( event:NativeWebViewEvent ):void\n{\n\twebView.evaluateJavascript( "alert(\'message from AS3\');" );\n}\n\nfunction javascriptResponseHandler( event:NativeWebViewEvent ):void\n{\n\ttrace( "evaluateJavascript response: " + event.data );\n}\n\nfunction javascriptMessageHandler( event:NativeWebViewEvent ):void\n{\n\t// This is the message sent from the javascript \n\t// AirBridge.message i.e. \'content-for-air\' \n\ttrace( "message from JS: " + event.data );\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"communicating with the following html page:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-html",children:'<html>\n<head>\n\t<meta charset="utf-8">\n\t<meta name="viewport" content="width=device-width, initial-scale=1">\n\n\t<script type="text/javascript" src="airbridge.js" ><\/script>\n\t<script>\n\t\t"use strict";\n\t\tfunction sendToAIR()\n\t\t{\n\t\t\tAirBridge.message( "content-for-air" );\n\t\t}\n\t<\/script>\n</head>\n\n<body>\n\t<h1>NativeWebView Example</h1>\n\t<p>\n\t\t<button type="button" onClick="sendToAIR()" >Example Call</button>\t\n\t</p>\n</body>\n\n</html>\n'})}),"\n",(0,a.jsx)(n.h2,{id:"air-bridge-code",children:"AIR Bridge Code"}),"\n",(0,a.jsxs)(n.p,{children:["This is the contents of the ",(0,a.jsx)(n.code,{children:"airbridge.js"})," file"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:'/**\n * Air Bridge interface to communicate to actionscript through the NativeWebView ANE\n */\n\nvar AirBridge = (function () {\n  var instance;\n\n  function createInstance() {\n    var object = {};\n    object.useWindowLocation = true;\n\n    object.isWKWebView = false;\n    if (navigator.platform.substr(0, 2) === "iP") {\n      if (window.indexedDB) {\n        object.isWKWebView = window.webkit && window.webkit.messageHandlers;\n      }\n    }\n\n    object.messageStack = [];\n    object.messageStackInterval = 1; // milliseconds interval\n    object.messageInProgress = false;\n\n    object.message = function (message) {\n      object.messageStack.push(message);\n      if (!object.messageInProgress) {\n        object._checkNextMessageInStackTimeout();\n      }\n    };\n\n    object._sendMessage = function (message) {\n      object.messageInProgress = true;\n\n      try {\n        if (object.isWKWebView) {\n          window.webkit.messageHandlers.airbridge.postMessage(message);\n        } else if (!object.useWindowLocation) {\n          NativeWebView.airBridge(message);\n        } else {\n          window.location = "airBridge:" + message;\n        }\n      } catch (err) {\n        window.location = "airBridge:" + message;\n      }\n\n      setTimeout(\n        object._checkNextMessageInStackTimeout,\n        object.messageStackInterval\n      );\n    };\n\n    object._checkNextMessageInStackTimeout = function () {\n      object.messageInProgress = false;\n\n      if (object.messageStack.length) {\n        object._sendMessage(object.messageStack.shift());\n      }\n    };\n\n    return object;\n  }\n\n  return {\n    setUseWindowLocation: function (shouldUseWindowLocation) {\n      if (!instance) {\n        instance = createInstance();\n      }\n      instance.useWindowLocation = shouldUseWindowLocation;\n    },\n\n    message: function (message) {\n      if (!instance) {\n        instance = createInstance();\n      }\n      instance.message(message);\n    },\n  };\n})();\n'})}),"\n",(0,a.jsx)(n.h2,{id:"sending-parameters-to-javascript",children:"Sending parameters to Javascript"}),"\n",(0,a.jsxs)(n.p,{children:["You can use the ",(0,a.jsx)(n.code,{children:"evaluateJavascript()"})," function to send any Javascript to the loaded page, however sometimes it is useful to call a function in javascript and pass an array of parameters. Below we are going to go through some techniques to communicate parameters with your page."]}),"\n",(0,a.jsx)(n.p,{children:"This first method is the simplest, constructing a String with the function name and parameters laid out:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-actionscript",children:'var javascript:String = "functionName( \'" + param1 + "\' )";\n_webView.evaluateJavascript( javascript );\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.p,{children:"Developing on this you can also construct a utility function that takes a function name and array of parameters:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-actionscript",children:'function callJavascriptFunction( functionName:String, args:Array ):void \n{\n    var params:String = "";\n    for (var i:int = 0; i < args.length; i++) \n\t{\n\t\t// Assuming strings, but you can add switching on type\n        params += "\'"+args[i] + "\'"; \n    }\n    var javascript:String = functionName + "( " + params + " )" ;\n    _webView.evaluateJavascript( javascript );\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsxs)(n.p,{children:["You could use the ",(0,a.jsx)(n.code,{children:"JSON"})," class to encode the parameters into a JSON string:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-actionscript",children:'function callJavascriptFunction( functionName:String, args:Array ):void \n{\n\tvar parametersJSON:String = JSON.stringify(args);\n\tvar javascript:String = functionName + "( " + parametersJSON + " )" ;\n    _webView.evaluateJavascript( javascript );\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Then in your javascript side parse the JSON back into your parameters:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"function myFunction(parametersJSON):void\n{\n     let parametersArray = JSON.parse(parametersJSON);\n     \n\t // Use your parameters as required\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(96540);const a={},s=i.createContext(a);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);