"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[69772],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(t),d=i,v=m["".concat(c,".").concat(d)]||m[d]||u[d]||r;return t?a.createElement(v,o(o({ref:n},p),{},{components:t})):a.createElement(v,o({ref:n},p))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var l=2;l<r;l++)o[l]=t[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},52739:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return l},default:function(){return u}});var a=t(87462),i=t(63366),r=(t(67294),t(3905)),o={title:"Communication",sidebar_label:"Communication"},s=void 0,c={unversionedId:"nativewebview/communication",id:"nativewebview/communication",isDocsHomePage:!1,title:"Communication",description:"One of the important aspects of this extension is the ability to communicate from your Actionscript",source:"@site/docs/nativewebview/communication.md",sourceDirName:"nativewebview",slug:"/nativewebview/communication",permalink:"/docs/nativewebview/communication",tags:[],version:"current",frontMatter:{title:"Communication",sidebar_label:"Communication"},sidebar:"nativewebview",previous:{title:"Screenshot",permalink:"/docs/nativewebview/screenshot"},next:{title:"Location Changes",permalink:"/docs/nativewebview/location-changes"}},l=[{value:"Android",id:"android",children:[]},{value:"Example",id:"example",children:[]},{value:"AIR Bridge Code",id:"air-bridge-code",children:[]},{value:"Sending parameters to Javascript",id:"sending-parameters-to-javascript",children:[]}],p={toc:l};function u(e){var n=e.components,t=(0,i.Z)(e,["components"]);return(0,r.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"One of the important aspects of this extension is the ability to communicate from your Actionscript\ncode to the Javascript in the web page and vice-versa."),(0,r.kt)("p",null,"To do this there is a function on the actionscript side to run javascript in the page:\n",(0,r.kt)("inlineCode",{parentName:"p"},"evaluateJavascript"),". When this is called your code will be sent and run on the currently loaded\npage and any return value will be available by listening to the event: ",(0,r.kt)("inlineCode",{parentName:"p"},"NativeWebViewEvent.JAVASCRIPT_RESPONSE")),(0,r.kt)("p",null,"On the javascript side, we have a helper script to simplify the communication back to the ",(0,r.kt)("inlineCode",{parentName:"p"},"WebView"),".\nCalling the ",(0,r.kt)("inlineCode",{parentName:"p"},"AirBridge.message( 'content-for-air' );")," in your Javascript will cause a\n",(0,r.kt)("inlineCode",{parentName:"p"},"NativeWebViewEvent.JAVASCRIPT_MESSAGE")," event to be dispatched with the data value containing\nthe message, 'content-for-air' in this case."),(0,r.kt)("p",null,"The two important events here are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NativeWebViewEvent.JAVASCRIPT_RESPONSE"),": Dispatched for a response from an AS3 initiated javascript call;"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"NativeWebViewEvent.JAVASCRIPT_MESSAGE"),": Dispatched when a message is received from javascript running on the page;")),(0,r.kt)("h2",{id:"android"},"Android"),(0,r.kt)("p",null,"On Android the communication channel is only completely setup after the page load is complete. I.e after ",(0,r.kt)("inlineCode",{parentName:"p"},"NativeWebViewEvent.COMPLETE"),". We suggest you wait for this event before attempting to communicate between the page and the application."),(0,r.kt)("p",null,"To this end, we suggest implementing a function in your page that you call from AS3 after the ",(0,r.kt)("inlineCode",{parentName:"p"},"NativeWebViewEvent.COMPLETE")," event has fired, which initialises your communication channel."),(0,r.kt)("p",null,"We have implemented some handlers for this scenario but they may affect loading of the page and we suggest you take the above approach wherever possible."),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"The following is an example from actionscript:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},'var webView:WebView = NativeWebView.service.createWebView( new Rectangle( 0, 0, 400, 600 ) ) ;\n\nwebView.addEventListener( NativeWebViewEvent.COMPLETE, webView_completeHandler );\nwebView.addEventListener( NativeWebViewEvent.JAVASCRIPT_RESPONSE, javascriptResponseHandler );\nwebView.addEventListener( NativeWebViewEvent.JAVASCRIPT_MESSAGE, javascriptMessageHandler );\n\nvar file:File = File.applicationStorageDirectory.resolvePath( "example.html" );\n\nwebView.loadURL( "file://"+file.nativePath );\n\n\nfunction completeHandler( event:NativeWebViewEvent ):void\n{\n    webView.evaluateJavascript( "alert(\'message from AS3\');" );\n}\n\nfunction javascriptResponseHandler( event:NativeWebViewEvent ):void\n{\n    trace( "evaluateJavascript response: " + event.data );\n}\n\nfunction javascriptMessageHandler( event:NativeWebViewEvent ):void\n{\n    // This is the message sent from the javascript \n    // AirBridge.message i.e. \'content-for-air\' \n    trace( "message from JS: " + event.data );\n}\n')),(0,r.kt)("p",null,"communicating with the following html page:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'<html>\n<head>\n    <meta charset="utf-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n\n    <script type="text/javascript" src="airbridge.js" ><\/script>\n    <script>\n        "use strict";\n        function sendToAIR()\n        {\n            AirBridge.message( "content-for-air" );\n        }\n    <\/script>\n</head>\n\n<body>\n    <h1>NativeWebView Example</h1>\n    <p>\n        <button type="button" onClick="sendToAIR()" >Example Call</button>  \n    </p>\n</body>\n\n</html>\n')),(0,r.kt)("h2",{id:"air-bridge-code"},"AIR Bridge Code"),(0,r.kt)("p",null,"This is the contents of the ",(0,r.kt)("inlineCode",{parentName:"p"},"airbridge.js")," file"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * Air Bridge interface to communicate to actionscript through the NativeWebView ANE\n */\n\nvar AirBridge = (function () {\n  var instance;\n\n  function createInstance() {\n    var object = {};\n    object.useWindowLocation = true;\n\n    object.isWKWebView = false;\n    if (navigator.platform.substr(0, 2) === "iP") {\n      if (window.indexedDB) {\n        object.isWKWebView = window.webkit && window.webkit.messageHandlers;\n      }\n    }\n\n    object.messageStack = [];\n    object.messageStackInterval = 1; // milliseconds interval\n    object.messageInProgress = false;\n\n    object.message = function (message) {\n      object.messageStack.push(message);\n      if (!object.messageInProgress) {\n        object._checkNextMessageInStackTimeout();\n      }\n    };\n\n    object._sendMessage = function (message) {\n      object.messageInProgress = true;\n\n      try {\n        if (object.isWKWebView) {\n          window.webkit.messageHandlers.airbridge.postMessage(message);\n        } else if (!object.useWindowLocation) {\n          NativeWebView.airBridge(message);\n        } else {\n          window.location = "airBridge:" + message;\n        }\n      } catch (err) {\n        window.location = "airBridge:" + message;\n      }\n\n      setTimeout(\n        object._checkNextMessageInStackTimeout,\n        object.messageStackInterval\n      );\n    };\n\n    object._checkNextMessageInStackTimeout = function () {\n      object.messageInProgress = false;\n\n      if (object.messageStack.length) {\n        object._sendMessage(object.messageStack.shift());\n      }\n    };\n\n    return object;\n  }\n\n  return {\n    setUseWindowLocation: function (shouldUseWindowLocation) {\n      if (!instance) {\n        instance = createInstance();\n      }\n      instance.useWindowLocation = shouldUseWindowLocation;\n    },\n\n    message: function (message) {\n      if (!instance) {\n        instance = createInstance();\n      }\n      instance.message(message);\n    },\n  };\n})();\n')),(0,r.kt)("h2",{id:"sending-parameters-to-javascript"},"Sending parameters to Javascript"),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"evaluateJavascript()")," function to send any Javascript to the loaded page, however sometimes it is useful to call a function in javascript and pass an array of parameters. Below we are going to go through some techniques to communicate parameters with your page."),(0,r.kt)("p",null,"This first method is the simplest, constructing a String with the function name and parameters laid out:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},'var javascript:String = "functionName( \'" + param1 + "\' )";\n_webView.evaluateJavascript( javascript );\n')),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Developing on this you can also construct a utility function that takes a function name and array of parameters:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},'function callJavascriptFunction( functionName:String, args:Array ):void \n{\n    var params:String = "";\n    for (var i:int = 0; i < args.length; i++) \n    {\n        // Assuming strings, but you can add switching on type\n        params += "\'"+args[i] + "\'"; \n    }\n    var javascript:String = functionName + "( " + params + " )" ;\n    _webView.evaluateJavascript( javascript );\n}\n')),(0,r.kt)("hr",null),(0,r.kt)("p",null,"You could use the ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON")," class to encode the parameters into a JSON string:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-actionscript"},'function callJavascriptFunction( functionName:String, args:Array ):void \n{\n    var parametersJSON:String = JSON.stringify(args);\n    var javascript:String = functionName + "( " + parametersJSON + " )" ;\n    _webView.evaluateJavascript( javascript );\n}\n')),(0,r.kt)("p",null,"Then in your javascript side parse the JSON back into your parameters: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"function myFunction(parametersJSON):void\n{\n     let parametersArray = JSON.parse(parametersJSON);\n     \n     // Use your parameters as required\n}\n")))}u.isMDXComponent=!0}}]);