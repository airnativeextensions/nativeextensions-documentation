(window.webpackJsonp=window.webpackJsonp||[]).push([[607],{662:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return p})),t.d(n,"default",(function(){return s}));var i=t(2),r=t(6),a=(t(0),t(821)),l={title:"Billing Service",sidebar_label:"Billing Service"},c={unversionedId:"inappbilling/billing-service",id:"inappbilling/billing-service",isDocsHomePage:!1,title:"Billing Service",description:"Setting up a Billing Service",source:"@site/docs/inappbilling/billing-service.md",slug:"/inappbilling/billing-service",permalink:"/docs/inappbilling/billing-service",version:"current",sidebar_label:"Billing Service",sidebar:"inappbilling",previous:{title:"Add the Extension",permalink:"/docs/inappbilling/add-the-extension"},next:{title:"Products",permalink:"/docs/inappbilling/products"}},p=[{value:"Setting up a Billing Service",id:"setting-up-a-billing-service",children:[{value:"Events",id:"events",children:[]},{value:"Service Type",id:"service-type",children:[]},{value:"Pending Purchases",id:"pending-purchases",children:[]}]}],o={rightToc:p};function s(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},o,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"setting-up-a-billing-service"},"Setting up a Billing Service"),Object(a.b)("p",null,"Before starting here you should make sure you have already setup the service for your application\nas outlined in earlier sections.\nThis is where you would have added products to your application in the appropriate developer console."),Object(a.b)("p",null,"The next step to using the functionality in this extension is to setup a billing (or purchasing) service.\nThis simply requires you to set the service you plan on using and calling ",Object(a.b)("inlineCode",{parentName:"p"},"setup")," with the service key (if required)."),Object(a.b)("p",null,"The following uses the default for the current platform and specifies the Google Play Billing Public License key:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-actionscript"}),"var service:BillingService = new BillingService()\n    .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY );\n\nvar success:Boolean = InAppBilling.service.setup( service );\n")),Object(a.b)("p",null,"This call performs a few things internally "),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Initialises the billing service"),Object(a.b)("li",{parentName:"ul"},"Initialises the purchase queue "),Object(a.b)("li",{parentName:"ul"},"Adds appropriate purchase handlers"),Object(a.b)("li",{parentName:"ul"},"Checks the state of any pending purchases")),Object(a.b)("p",null,"The return value of the ",Object(a.b)("inlineCode",{parentName:"p"},"setup")," function indicates if the configured service type is supported on\nthe current device. This may return ",Object(a.b)("inlineCode",{parentName:"p"},"false")," if you have for example requests Apple In-App Purchases on\nan Android device. "),Object(a.b)("p",null,"Once this is complete the ",Object(a.b)("inlineCode",{parentName:"p"},"InAppBillingEvent.SETUP_SUCCESS")," event will be dispatched and the service\nis available for queries."),Object(a.b)("p",null,"If an error occurred then the ",Object(a.b)("inlineCode",{parentName:"p"},"InAppBillingEvent.SETUP_FAILURE")," event will be dispatched. This is a fatal\nevent and will stop any other functionality from working successfully. Generally this only occurs due\nto a misconfiguration and is to help you get an application working correctly however you should make\nsure that you handle the event appropriately."),Object(a.b)("h3",{id:"events"},"Events"),Object(a.b)("p",null,"We suggest you listen to the following four events before calling setup:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"InAppBillingEvent.SETUP_SUCCESS"),": Dispatched when setup is successfully completed;"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"InAppBillingEvent.SETUP_FAILURE"),": Dispatched when there was an error during setup;"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"PurchaseEvent.PURCHASES_UPDATED"),": Dispatched if there are pending purchases needing to be processed;"),Object(a.b)("li",{parentName:"ul"},Object(a.b)("inlineCode",{parentName:"li"},"PurchaseRequestEvent.SHOULD_ADD_PURCHASE"),": Dispatched if the app was launched from an AppStore promotional purchase (see ",Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"promotions"}),"Promotions"),").")),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-actionscript"}),"InAppBilling.service.addEventListener( InAppBillingEvent.SETUP_SUCCESS, setup_successHandler );\nInAppBilling.service.addEventListener( InAppBillingEvent.SETUP_FAILURE, setup_failureHandler );\nInAppBilling.service.addEventListener( PurchaseEvent.PURCHASES_UPDATED, purchases_updatedHandler );\nInAppBilling.service.addEventListener( PurchaseRequestEvent.SHOULD_ADD_PURCHASE, purchaseRequest_shouldAddPurchaseHandler );\n                        \nInAppBilling.service.setup(\n        new BillingService()\n                .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY )\n);\n")),Object(a.b)("h3",{id:"service-type"},"Service Type"),Object(a.b)("p",null,"The billing service type will be automatically selected based on the default of the current device platform. However we suggest you specify the service type in your ",Object(a.b)("inlineCode",{parentName:"p"},"BillingService")," using ",Object(a.b)("inlineCode",{parentName:"p"},"setServiceType()")," to specify a particular service:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{className:"language-actionscript"}),"var service:BillingService = new BillingService(  )\n    .setServiceType( InAppBillingServiceTypes.GOOGLE_PLAY_INAPP_BILLING )\n    .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY );\n\nvar success:Boolean = InAppBilling.service.setup( service );\n")),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Note"),": "),Object(a.b)("p",{parentName:"blockquote"},"You do not need to call ",Object(a.b)("inlineCode",{parentName:"p"},"setServiceType"),".\nIf you do not call it then the default for the current platform will be used,\ni.e. Apple InApp Purchases on iOS and Google's Play InApp Billing on Android."),Object(a.b)("p",{parentName:"blockquote"},"We suggest that you do specify a service type, particularly on Android where there are multiple stores involved.\nThis is so that you ensure you are utilising the correct store for your application, otherwise you may find that the extension incorrectly assumes you are using the default store on the device (eg Huawei AppGallery on a Huawei device), which may not be what you intend.")),Object(a.b)("h3",{id:"pending-purchases"},"Pending Purchases"),Object(a.b)("p",null,"Note that the pending purchases may not be available to you at the  ",Object(a.b)("inlineCode",{parentName:"p"},"InAppBillingEvent.SETUP_SUCCESS")," event, as they may be updated after setup has completed. This is particularly true on iOS/tvOS where the payment queue update (which populates the pending purchases) will occur a short time after setup succeeds."),Object(a.b)("p",null,"This update will be indicated by a ",Object(a.b)("inlineCode",{parentName:"p"},"PurchaseEvent.PURCHASES_UPDATED"),", indicating there are purchases to process."))}s.isMDXComponent=!0},821:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return h}));var i=t(0),r=t.n(i);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=r.a.createContext({}),s=function(e){var n=r.a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},u=function(e){var n=s(e.components);return r.a.createElement(o.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=r.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,o=p(e,["components","mdxType","originalType","parentName"]),u=s(t),d=i,h=u["".concat(l,".").concat(d)]||u[d]||b[d]||a;return t?r.a.createElement(h,c(c({ref:n},o),{},{components:t})):r.a.createElement(h,c({ref:n},o))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,l=new Array(a);l[0]=d;var c={};for(var p in n)hasOwnProperty.call(n,p)&&(c[p]=n[p]);c.originalType=e,c.mdxType="string"==typeof e?e:i,l[1]=c;for(var o=2;o<a;o++)l[o]=t[o];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);