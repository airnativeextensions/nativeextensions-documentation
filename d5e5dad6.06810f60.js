(window.webpackJsonp=window.webpackJsonp||[]).push([[657],{712:function(e,a,t){"use strict";t.r(a),t.d(a,"frontMatter",(function(){return i})),t.d(a,"metadata",(function(){return o})),t.d(a,"rightToc",(function(){return c})),t.d(a,"default",(function(){return l}));var n=t(2),r=(t(0),t(854));const i={title:"Saving BitmapData to File",sidebar_label:"Saving BitmapData to File"},o={unversionedId:"image/saving-bitmapdata-to-file",id:"image/saving-bitmapdata-to-file",isDocsHomePage:!1,title:"Saving BitmapData to File",description:"Encoding bitmap data to a file can be a slow process when using AS3 operations.",source:"@site/docs/image/saving-bitmapdata-to-file.md",slug:"/image/saving-bitmapdata-to-file",permalink:"/docs/image/saving-bitmapdata-to-file",version:"current",sidebar_label:"Saving BitmapData to File",sidebar:"image",previous:{title:"Request Authorisation",permalink:"/docs/image/request-authorisation"},next:{title:"Loading BitmapData from File",permalink:"/docs/image/loading-bitmapdata-from-file"}},c=[{value:"Caching Internally",id:"caching-internally",children:[]}],s={rightToc:c};function l({components:e,...a}){return Object(r.b)("wrapper",Object(n.a)({},s,a,{components:e,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Encoding bitmap data to a file can be a slow process when using AS3 operations.\nThis extension provides functionality to use the native PNG and JPG encoders to\nsave BitmapData to a file which greatly increases the speed of saving images."),Object(r.b)("p",null,"Most of the operations provided by this ANE can be performed synchronously or\nasynchronously. Synchronous operations may block your UI if you are dealing\nwith large images so we suggest you use the asynchronous versions wherever possible."),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-actionscript"}),'var image:Bitmap = new SampleImage() as Bitmap;\nvar f:File = File.applicationStorageDirectory.resolvePath("test.png");\n\nImage.service.addEventListener( ImageEvent.SAVE_COMPLETE, saveBitmapDataAsync_completeHandler );\nImage.service.addEventListener( ImageEvent.SAVE_ERROR, saveBitmapDataAsync_errorHandler );\n\nvar success:Boolean = Image.service.saveBitmapDataAsync( image.bitmapData, f.nativePath, ImageFormat.PNG );\n')),Object(r.b)("p",null,"When the save operation completes you will receive either an ",Object(r.b)("inlineCode",{parentName:"p"},"ImageEvent.SAVE_COMPLETE"),"\nevent or an ",Object(r.b)("inlineCode",{parentName:"p"},"ImageEvent.SAVE_ERROR")," event:"),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-actionscript"}),'function saveBitmapDataAsync_completeHandler( event:ImageEvent ):void\n{\n    trace( "Save successfully: " + event.identifier );\n}\n\nfunction saveBitmapDataAsync_errorHandler( event:ImageEvent ):void\n{\n    trace( "Save failed: " + event.identifier );\n}\n')),Object(r.b)("h2",{id:"caching-internally"},"Caching Internally"),Object(r.b)("p",null,"In order to avoid crashes when AIR garbage collects the Bitmap Data we make a copy of the image\nand use this cached version internally. "),Object(r.b)("p",null,"If you pass a local variable to the ",Object(r.b)("inlineCode",{parentName:"p"},"saveBitmapDataAsync")," function and we don't cache the\nimage data, AIR isn't aware of the ANE reference and may dealloc the memory we are using\nto save the image. So by default we cache the image internally."),Object(r.b)("p",null,"This can have a small affect on the performance as we need to create a copy of the image."),Object(r.b)("p",null,"If you are concerned about the speed of this function you should try to set ",Object(r.b)("inlineCode",{parentName:"p"},"cacheBitmapInternally"),"\nto ",Object(r.b)("inlineCode",{parentName:"p"},"false")," and make sure that you hold onto a reference to your bitmap data, for example, as\na class variable. "),Object(r.b)("pre",null,Object(r.b)("code",Object(n.a)({parentName:"pre"},{className:"language-actionscript"}),'// Class variable will hold reference to bitmap\nprivate var image:Bitmap;\n\n\nprivate function saveBitmap():void \n{\n    Image.service.addEventListener( ImageEvent.SAVE_COMPLETE, saveBitmapDataAsync_completeHandler );\n    Image.service.addEventListener( ImageEvent.SAVE_ERROR, saveBitmapDataAsync_errorHandler );\n\n    // Set cacheBitmapInternally to false\n    var success:Boolean = Image.service.saveBitmapDataAsync( image.bitmapData, f.nativePath, ImageFormat.PNG, false );\n}\n\nprivate function saveBitmapDataAsync_completeHandler( event:ImageEvent ):void\n{\n    trace( "Save successfully: " + event.identifier );\n    // dispose image if required.\n}\n\nprivate function saveBitmapDataAsync_errorHandler( event:ImageEvent ):void\n{\n    trace( "Save failed: " + event.identifier );\n    // dispose image if required.\n}\n\n\n\n')))}l.isMDXComponent=!0},854:function(e,a,t){"use strict";t.d(a,"a",(function(){return m})),t.d(a,"b",(function(){return v}));var n=t(0),r=t.n(n);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),p=function(e){var a=r.a.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):c(c({},a),e)),t},m=function(e){var a=p(e.components);return r.a.createElement(l.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return r.a.createElement(r.a.Fragment,{},a)}},d=r.a.forwardRef((function(e,a){var t=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=p(t),d=n,v=m["".concat(o,".").concat(d)]||m[d]||u[d]||i;return t?r.a.createElement(v,c(c({ref:a},l),{},{components:t})):r.a.createElement(v,c({ref:a},l))}));function v(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var i=t.length,o=new Array(i);o[0]=d;var c={};for(var s in a)hasOwnProperty.call(a,s)&&(c[s]=a[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var l=2;l<i;l++)o[l]=t[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);