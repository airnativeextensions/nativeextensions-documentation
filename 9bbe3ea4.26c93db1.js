(window.webpackJsonp=window.webpackJsonp||[]).push([[511],{568:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return o})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return p}));var r=t(2),a=t(6),c=(t(0),t(896)),i={title:"Database - Disconnect",sidebar_label:"Disconnect"},o={unversionedId:"firebase/database/disconnect",id:"firebase/database/disconnect",isDocsHomePage:!1,title:"Database - Disconnect",description:"On Disconnect",source:"@site/docs/firebase/database/disconnect.md",slug:"/firebase/database/disconnect",permalink:"/docs/firebase/database/disconnect",version:"current",sidebar_label:"Disconnect",sidebar:"firebase",previous:{title:"Database - Offline",permalink:"/docs/firebase/database/offline"},next:{title:"Firestore - Introduction",permalink:"/docs/firebase/firestore/introduction"}},s=[{value:"On Disconnect",id:"on-disconnect",children:[{value:"Managing Presence",id:"managing-presence",children:[]},{value:"How onDisconnect Works",id:"how-ondisconnect-works",children:[]},{value:"Cancel",id:"cancel",children:[]}]}],l={rightToc:s};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"on-disconnect"},"On Disconnect"),Object(c.b)("p",null,"The ",Object(c.b)("inlineCode",{parentName:"p"},"OnDisconnect")," class is used to manage operations that will be run on the server when this client disconnects.\nIt can be used to add or remove data based on a client's connection status.\nIt is very useful in applications looking for 'presence' functionality. "),Object(c.b)("h3",{id:"managing-presence"},"Managing Presence"),Object(c.b)("p",null,"In realtime applications it is often useful to detect when clients connect and disconnect.\nFor example, you may want to mark a user as 'offline' when their client disconnects."),Object(c.b)("p",null,"Firebase Database clients provide simple primitives that you can use to write to the database\nwhen a client disconnects from the Firebase Database servers. These updates occur whether the\nclient disconnects cleanly or not, so you can rely on them to clean up data even if a connection\nis dropped or a client crashes. All write operations, including setting, updating, and removing,\ncan be performed upon a disconnection."),Object(c.b)("p",null,"Here is a simple example of writing data upon disconnection by using the onDisconnect primitive:"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-actionscript"}),'var presenceRef:DatabaseReference = FirebaseDatabase.service.getReference( "disconnectmessage" );\n\n// Write a string when this client loses connection\npresenceRef.onDisconnect().setValue("I disconnected!");\n')),Object(c.b)("h3",{id:"how-ondisconnect-works"},"How onDisconnect Works"),Object(c.b)("p",null,"When you establish an ",Object(c.b)("inlineCode",{parentName:"p"},"onDisconnect()")," operation, the operation lives on the Firebase Realtime Database server.\nThe server checks security to make sure the user can perform the write event requested, and informs the your\napp if it is invalid. The server then monitors the connection. If at any point the connection times out, or\nis actively closed by the Realtime Database client, the server checks security a second time (to make sure\nthe operation is still valid) and then invokes the event."),Object(c.b)("h3",{id:"cancel"},"Cancel"),Object(c.b)("p",null,"An onDisconnect event can also be canceled by calling ",Object(c.b)("inlineCode",{parentName:"p"},"cancel()"),":"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-actionscript"}),"presenceRef.onDisconnect().cancel();\n")))}p.isMDXComponent=!0},896:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return f}));var r=t(0),a=t.n(r);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),p=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},d=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(t),d=r,f=u["".concat(i,".").concat(d)]||u[d]||b[d]||c;return t?a.a.createElement(f,o(o({ref:n},l),{},{components:t})):a.a.createElement(f,o({ref:n},l))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,i=new Array(c);i[0]=d;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var l=2;l<c;l++)i[l]=t[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);