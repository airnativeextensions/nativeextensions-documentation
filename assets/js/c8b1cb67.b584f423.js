"use strict";(self.webpackChunknativeextensions_documentation=self.webpackChunknativeextensions_documentation||[]).push([[75002],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>f});var n=a(67294);function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){p(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,p=function(e,t){if(null==e)return{};var a,n,p={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(p[a]=e[a]);return p}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(p[a]=e[a])}return p}var o=n.createContext({}),s=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(o.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,p=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(a),h=p,f=u["".concat(o,".").concat(h)]||u[h]||c[h]||i;return a?n.createElement(f,r(r({ref:t},d),{},{components:a})):n.createElement(f,r({ref:t},d))}));function f(e,t){var a=arguments,p=t&&t.mdxType;if("string"==typeof e||p){var i=a.length,r=new Array(i);r[0]=h;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l[u]="string"==typeof e?e:p,r[1]=l;for(var s=2;s<i;s++)r[s]=a[s];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},88367:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var n=a(87462),p=(a(67294),a(3905));const i={title:"Usage",sidebar_label:"Usage"},r=void 0,l={unversionedId:"inappupdates/usage",id:"inappupdates/usage",title:"Usage",description:"Check for update availability",source:"@site/docs/inappupdates/usage.md",sourceDirName:"inappupdates",slug:"/inappupdates/usage",permalink:"/docs/inappupdates/usage",draft:!1,tags:[],version:"current",frontMatter:{title:"Usage",sidebar_label:"Usage"}},o={},s=[{value:"Check for update availability",id:"check-for-update-availability",level:2},{value:"Check update staleness",id:"check-update-staleness",level:3},{value:"Check update priority",id:"check-update-priority",level:3},{value:"Start an update",id:"start-an-update",level:2},{value:"Configure an update with AppUpdateOptions",id:"configure-an-update-with-appupdateoptions",level:3},{value:"Handle a flexible update",id:"handle-a-flexible-update",level:2},{value:"Monitor the flexible update state",id:"monitor-the-flexible-update-state",level:2},{value:"Install a flexible update",id:"install-a-flexible-update",level:3},{value:"Handle an immediate update",id:"handle-an-immediate-update",level:2}],d={toc:s},u="wrapper";function c(e){let{components:t,...i}=e;return(0,p.kt)(u,(0,n.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,p.kt)("h2",{id:"check-for-update-availability"},"Check for update availability"),(0,p.kt)("p",null,"Before requesting an update, check if there is an update available for your app. Use ",(0,p.kt)("inlineCode",{parentName:"p"},"getAppUpdateInfo()")," to retrieve the available update information:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"InAppUpdates.instance.getAppUpdateInfo(\n        function ( appUpdateInfo:AppUpdateInfo ):void\n        {\n            // Process the AppUpdateInfo\n        }\n);\n")),(0,p.kt)("p",null,"The returned ",(0,p.kt)("inlineCode",{parentName:"p"},"AppUpdateInfo")," instance contains the update availability status. Depending on the status of the update, the instance also contains the following:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"If an update is available and the update is allowed, the instance also contains information to start an update."),(0,p.kt)("li",{parentName:"ul"},"If an in-app update is already in progress, the instance also reports the status of the in-progress update (bytes downloaded etc).")),(0,p.kt)("p",null,"The most important flag here is the ",(0,p.kt)("inlineCode",{parentName:"p"},"updateAvailability")," state, which contains a value from ",(0,p.kt)("inlineCode",{parentName:"p"},"UpdateAvailability")," indicating whether an update is available for the app."),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"if (appUpdateInfo.updateAvailability == UpdateAvailability.UPDATE_AVAILABLE)\n{\n    // An update is available\n}\n")),(0,p.kt)("h3",{id:"check-update-staleness"},"Check update staleness"),(0,p.kt)("p",null,"In addition to checking whether an update is available, you might also want to check how much time has passed since the user was last notified of an update through the Play Store. This can help you decide whether you should initiate a flexible update or an immediate update. For example, you might wait a few days before notifying the user with a flexible update, and a few days after that before requiring an immediate update."),(0,p.kt)("p",null,"Use ",(0,p.kt)("inlineCode",{parentName:"p"},"clientVersionStalenessDays")," to check the number of days since the update became available on the Play Store."),(0,p.kt)("h3",{id:"check-update-priority"},"Check update priority"),(0,p.kt)("p",null,"The Google Play Developer API allows you to set the priority of each update. This allows your app to decide how strongly to recommend an update to the user. For example, consider the following strategy for setting update priority:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},"Minor UI improvements: Low-priority update; request neither a flexible update nor an immediate update. Update only when the user isn't interacting with your app."),(0,p.kt)("li",{parentName:"ul"},"Performance improvements: Medium-priority update; request a flexible update."),(0,p.kt)("li",{parentName:"ul"},"Critical security update: High-priority update; request an immediate update.")),(0,p.kt)("p",null,"To determine priority, Google Play uses an integer value between 0 and 5, with 0 being the default and 5 being the highest priority. To set the priority for an update, use the inAppUpdatePriority field under Edits.tracks.releases in the Google Play Developer API. All newly-added versions in the release are considered to be the same priority as the release. Priority can only be set when rolling out a new release and cannot be changed later."),(0,p.kt)("h2",{id:"start-an-update"},"Start an update"),(0,p.kt)("p",null,"After you confirm that an update is available, you can request an update using the ",(0,p.kt)("inlineCode",{parentName:"p"},"startUpdateFlowForResult()")," method."),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"var options:AppUpdateOptions = new AppUpdateOptions( AppUpdateType.IMMEDIATE );\n\nInAppUpdates.instance.startUpdateFlowForResult(\n        options\n);\n")),(0,p.kt)("p",null,"This process will dispatch events based on the user interaction and any errors that occur:"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"InAppUpdatesEvent.IN_APP_UPDATE_STARTED"),": Dispatched when the update process starts - generally this involves presenting UI to the user that asks whether they wish to update;"),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"InAppUpdatesEvent.IN_APP_UPDATE_CANCELLED"),": Dispatched if the user cancels the update process;"),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"InAppUpdatesEvent.IN_APP_UPDATE_FAILED"),": Dispatched if an error occurred during the update process;"),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("inlineCode",{parentName:"li"},"InAppUpdatesEvent.IN_APP_UPDATE_COMPLETE"),": Dispatched when the update process completes (will only occur during a flexible update);")),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},'InAppUpdates.instance.addEventListener( InAppUpdatesEvent.IN_APP_UPDATE_STARTED, inAppUpdatesHandler );\nInAppUpdates.instance.addEventListener( InAppUpdatesEvent.IN_APP_UPDATE_COMPLETE, inAppUpdatesHandler );\nInAppUpdates.instance.addEventListener( InAppUpdatesEvent.IN_APP_UPDATE_CANCELLED, errorHandler );\nInAppUpdates.instance.addEventListener( InAppUpdatesEvent.IN_APP_UPDATE_FAILED, errorHandler );\n\nfunction inAppUpdatesHandler( event:InAppUpdatesEvent ):void\n{\n    trace( "inAppUpdatesHandler: " + event.type );\n\n    if (event.appUpdateInfo == null) return;\n\n    trace( "inAppUpdatesHandler: " + JSON.stringify( event.appUpdateInfo.toObject() ) );\n}\n\n\nfunction errorHandler( event:InAppUpdatesEvent ):void\n{\n    trace( "errorHandler: " + event.type + " :: " + event.error.message );\n}\n')),(0,p.kt)("h3",{id:"configure-an-update-with-appupdateoptions"},"Configure an update with AppUpdateOptions"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"AppUpdateOptions")," contains a field that defines whether the update is allowed to clear asset packs in case of limited device storage. This field is set to false by default, but you can use the ",(0,p.kt)("inlineCode",{parentName:"p"},"setAllowAssetPackDeletion()")," method to set it to true instead:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"var options:AppUpdateOptions = new AppUpdateOptions( AppUpdateType.IMMEDIATE )\n        .setAllowAssetPackDeletion( true );\n")),(0,p.kt)("h2",{id:"handle-a-flexible-update"},"Handle a flexible update"),(0,p.kt)("p",null,"When you start a flexible update, a dialog first appears to the user to request consent. If the user consents, then the download starts in the background, and the user can continue to interact with your app. This section describes how to monitor and complete a flexible in-app update."),(0,p.kt)("p",null,(0,p.kt)("img",{src:a(66937).Z,width:"1384",height:"916"})),(0,p.kt)("h2",{id:"monitor-the-flexible-update-state"},"Monitor the flexible update state"),(0,p.kt)("p",null,"After starting an update, you will receive ",(0,p.kt)("inlineCode",{parentName:"p"},"StateUpdatedEvent")," events indicating the status of the update:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"InAppUpdates.instance.addEventListener( StateUpdatedEvent.UPDATED, stateUpdatedHandler );\n\nfunction stateUpdatedHandler( event:StateUpdatedEvent ):void\n{\n}\n")),(0,p.kt)("p",null,"The ",(0,p.kt)("inlineCode",{parentName:"p"},"StateUpdatedEvent")," contains a ",(0,p.kt)("inlineCode",{parentName:"p"},"state")," object being an instance of the ",(0,p.kt)("inlineCode",{parentName:"p"},"InstallState")," class. This instance contains information about the current ",(0,p.kt)("inlineCode",{parentName:"p"},"installStatus")," (from the ",(0,p.kt)("inlineCode",{parentName:"p"},"InstallStatus")," class) and the bytes downloaded and bytes total.  "),(0,p.kt)("p",null,"You will find the ",(0,p.kt)("inlineCode",{parentName:"p"},"installStatus")," will go through a series of changes: ",(0,p.kt)("inlineCode",{parentName:"p"},"DOWNLOADING")," -> ",(0,p.kt)("inlineCode",{parentName:"p"},"DOWNLOADED")," "),(0,p.kt)("h3",{id:"install-a-flexible-update"},"Install a flexible update"),(0,p.kt)("p",null,"When you detect the ",(0,p.kt)("inlineCode",{parentName:"p"},"InstallStatus.DOWNLOADED")," state, you need to restart the app to install the update."),(0,p.kt)("p",null,"Unlike with immediate updates, Google Play does not automatically trigger an app restart for a flexible update. This is because during a flexible update, the user has an expectation to continue interacting with the app until they decide that they want to install the update."),(0,p.kt)("p",null,"It is recommended that you provide a notification (or some other UI indication) to inform the user that the update is ready to install and request confirmation before restarting the app."),(0,p.kt)("p",null,"When you call ",(0,p.kt)("inlineCode",{parentName:"p"},"completeUpdate()")," in the foreground, the platform displays a full-screen UI that restarts the app in the background. After the platform installs the update, your app restarts into its main activity."),(0,p.kt)("p",null,"If you instead call ",(0,p.kt)("inlineCode",{parentName:"p"},"completeUpdate()")," when your app is in the background, the update is installed silently without obscuring the device UI."),(0,p.kt)("p",null,"Whenever the user brings your app to the foreground, check whether your app has an update waiting to be installed. If your app has an update in the ",(0,p.kt)("inlineCode",{parentName:"p"},"DOWNLOADED")," state, prompt the user to install the update. Otherwise, the update data continues to occupy the user's device storage."),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"InAppUpdates.instance.getAppUpdateInfo(\n        function ( appUpdateInfo:AppUpdateInfo ):void\n        {\n            if (appUpdateInfo.installStatus == InstallStatus.DOWNLOADED) \n            {\n                popupSnackbarForCompleteUpdate();\n            }\n        }\n);\n")),(0,p.kt)("h2",{id:"handle-an-immediate-update"},"Handle an immediate update"),(0,p.kt)("p",null,"When you start an immediate update and the user consents to begin the update, Google Play displays the update progress on top of your app's UI throughout the entire duration of the update. "),(0,p.kt)("p",null,(0,p.kt)("img",{src:a(51158).Z,width:"904",height:"916"})),(0,p.kt)("p",null,"If the user closes or terminates your app during the update, the update should continue to download and install in the background without additional user confirmation."),(0,p.kt)("p",null,"However, when your app returns to the foreground, you should confirm that the update is not stalled in the ",(0,p.kt)("inlineCode",{parentName:"p"},"UpdateAvailability.DEVELOPER_TRIGGERED_UPDATE_IN_PROGRESS")," state. If the update is stalled in this state, resume the update:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-actionscript"},"InAppUpdates.instance.getAppUpdateInfo(\n        function ( appUpdateInfo:AppUpdateInfo ):void\n        {\n            if (appUpdateInfo.installStatus == InstallStatus.DEVELOPER_TRIGGERED_UPDATE_IN_PROGRESS) \n            {\n                // If an in-app update is already running, resume the update.\n                InAppUpdates.instance.startUpdateFlowForResult( \n                    new AppUpdateOptions( AppUpdateType.IMMEDIATE )\n                 );\n            }\n        }\n);\n")),(0,p.kt)("p",null,"If possible, let the user continue without the update and prompt them again later. If your app can't function without the update, consider displaying an informative message before restarting the update flow or prompting the user to close the app. That way, the user understands that they can relaunch your app when they're ready to install the required update."))}c.isMDXComponent=!0},66937:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/flexible_flow-7ecd70b5deb9ef5bb2e9a71781f7ff96.png"},51158:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/immediate_flow-9755a8d44b64b069f92af4c983fbd4d5.png"}}]);