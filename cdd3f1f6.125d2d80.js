(window.webpackJsonp=window.webpackJsonp||[]).push([[567],{622:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return p})),t.d(n,"default",(function(){return o}));var i=t(2),r=t(6),l=(t(0),t(775)),a={title:"Billing Service",sidebar_label:"Billing Service"},c={unversionedId:"inappbilling/billing-service",id:"inappbilling/billing-service",isDocsHomePage:!1,title:"Billing Service",description:"Setting up a Billing Service",source:"@site/docs/inappbilling/billing-service.md",slug:"/inappbilling/billing-service",permalink:"/docs/inappbilling/billing-service",version:"current",sidebar_label:"Billing Service",sidebar:"inappbilling",previous:{title:"Add the Extension",permalink:"/docs/inappbilling/add-the-extension"},next:{title:"Products",permalink:"/docs/inappbilling/products"}},p=[{value:"Setting up a Billing Service",id:"setting-up-a-billing-service",children:[{value:"Events",id:"events",children:[]},{value:"Service Type",id:"service-type",children:[]},{value:"Pending Purchases",id:"pending-purchases",children:[]}]}],s={rightToc:p};function o(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(i.a)({},s,t,{components:n,mdxType:"MDXLayout"}),Object(l.b)("h2",{id:"setting-up-a-billing-service"},"Setting up a Billing Service"),Object(l.b)("p",null,"Before starting here you should make sure you have already setup the service for your application\nas outlined in earlier sections.\nThis is where you would have added products to your application in the appropriate developer console."),Object(l.b)("p",null,"The next step to using the functionality in this extension is to setup a billing (or purchasing) service.\nThis simply requires you to set the service you plan on using and calling ",Object(l.b)("inlineCode",{parentName:"p"},"setup")," with the service key (if required)."),Object(l.b)("p",null,"The following uses the default for the current platform and specifies the Google Play Billing Public License key:"),Object(l.b)("pre",null,Object(l.b)("code",Object(i.a)({parentName:"pre"},{className:"language-actionscript"}),"var service:BillingService = new BillingService()\n    .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY );\n\nvar success:Boolean = InAppBilling.service.setup( service );\n")),Object(l.b)("p",null,"This call performs a few things internally "),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Initialises the billing service"),Object(l.b)("li",{parentName:"ul"},"Initialises the purchase queue "),Object(l.b)("li",{parentName:"ul"},"Adds appropriate purchase handlers"),Object(l.b)("li",{parentName:"ul"},"Checks the state of any pending purchases")),Object(l.b)("p",null,"The return value of the ",Object(l.b)("inlineCode",{parentName:"p"},"setup")," function indicates if the configured service type is supported on\nthe current device. This may return ",Object(l.b)("inlineCode",{parentName:"p"},"false")," if you have for example requests Apple In-App Purchases on\nan Android device. "),Object(l.b)("p",null,"Once this is complete the ",Object(l.b)("inlineCode",{parentName:"p"},"InAppBillingEvent.SETUP_SUCCESS")," event will be dispatched and the service\nis available for queries."),Object(l.b)("p",null,"If an error occurred then the ",Object(l.b)("inlineCode",{parentName:"p"},"InAppBillingEvent.SETUP_FAILURE")," event will be dispatched. This is a fatal\nevent and will stop any other functionality from working successfully. Generally this only occurs due\nto a misconfiguration and is to help you get an application working correctly however you should make\nsure that you handle the event appropriately."),Object(l.b)("h3",{id:"events"},"Events"),Object(l.b)("p",null,"We suggest you listen to the following four events before calling setup:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"InAppBillingEvent.SETUP_SUCCESS"),": Dispatched when setup is successfully completed;"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"InAppBillingEvent.SETUP_FAILURE"),": Dispatched when there was an error during setup;"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"PurchaseEvent.PURCHASES_UPDATED"),": Dispatched if there are pending purchases needing to be processed;"),Object(l.b)("li",{parentName:"ul"},Object(l.b)("inlineCode",{parentName:"li"},"PurchaseRequestEvent.SHOULD_ADD_PURCHASE"),": Dispatched if the app was launched from an AppStore promotional purchase (see ",Object(l.b)("a",Object(i.a)({parentName:"li"},{href:"promotions"}),"Promotions"),").")),Object(l.b)("pre",null,Object(l.b)("code",Object(i.a)({parentName:"pre"},{className:"language-actionscript"}),"InAppBilling.service.addEventListener( InAppBillingEvent.SETUP_SUCCESS, setup_successHandler );\nInAppBilling.service.addEventListener( InAppBillingEvent.SETUP_FAILURE, setup_failureHandler );\nInAppBilling.service.addEventListener( PurchaseEvent.PURCHASES_UPDATED, purchases_updatedHandler );\nInAppBilling.service.addEventListener( PurchaseRequestEvent.SHOULD_ADD_PURCHASE, purchaseRequest_shouldAddPurchaseHandler );\n                        \nInAppBilling.service.setup(\n        new BillingService()\n                .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY )\n);\n")),Object(l.b)("h3",{id:"service-type"},"Service Type"),Object(l.b)("p",null,"The billing service type will be automatically selected based on the default of the current device platform. However if you wish to specify you can set a particular type in the ",Object(l.b)("inlineCode",{parentName:"p"},"BillingService")," constructor to specify a particular platform:"),Object(l.b)("pre",null,Object(l.b)("code",Object(i.a)({parentName:"pre"},{className:"language-actionscript"}),"var service:BillingService = new BillingService( )\n    .setGooglePlayPublicKey( GOOGLE_PLAY_INAPP_BILLING_KEY );\n\nvar success:Boolean = InAppBilling.service.setup( service );\n\n\n// Set the required service type and call setup\nInAppBilling.service.setServiceType( InAppBillingServiceTypes.GOOGLE_PLAY_INAPP_BILLING );\n")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"This must be called before ",Object(l.b)("inlineCode",{parentName:"strong"},"setup()"),".")," Calling it after ",Object(l.b)("inlineCode",{parentName:"p"},"setup()")," will have no affect."),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"Note: "),Object(l.b)("p",{parentName:"blockquote"},"You do not need to call ",Object(l.b)("inlineCode",{parentName:"p"},"setServiceType"),".\nIf you do not call it then the default for the current platform will be used,\ni.e. Apple InApp Purchases on iOS and Google's Play InApp Billing on Android.")),Object(l.b)("h3",{id:"pending-purchases"},"Pending Purchases"),Object(l.b)("p",null,"Note that the pending purchases may not be available to you at the  ",Object(l.b)("inlineCode",{parentName:"p"},"InAppBillingEvent.SETUP_SUCCESS")," event, as they may be updated after setup has completed. This is particularly true on iOS/tvOS where the payment queue update (which populates the pending purchases) will occur a short time after setup succeeds."),Object(l.b)("p",null,"This update will be indicated by a ",Object(l.b)("inlineCode",{parentName:"p"},"PurchaseEvent.PURCHASES_UPDATED"),", indicating there are purchases to process."))}o.isMDXComponent=!0},775:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return h}));var i=t(0),r=t.n(i);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},l=Object.keys(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=r.a.createContext({}),o=function(e){var n=r.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},u=function(e){var n=o(e.components);return r.a.createElement(s.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=r.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,a=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),u=o(t),d=i,h=u["".concat(a,".").concat(d)]||u[d]||b[d]||l;return t?r.a.createElement(h,c(c({ref:n},s),{},{components:t})):r.a.createElement(h,c({ref:n},s))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,a=new Array(l);a[0]=d;var c={};for(var p in n)hasOwnProperty.call(n,p)&&(c[p]=n[p]);c.originalType=e,c.mdxType="string"==typeof e?e:i,a[1]=c;for(var s=2;s<l;s++)a[s]=t[s];return r.a.createElement.apply(null,a)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);