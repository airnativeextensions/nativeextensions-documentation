<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="air native extensions RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="air native extensions Atom Feed">
<link rel="alternate" type="application/json" href="/news/feed.json" title="air native extensions JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-188619114-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="air native extensions" href="/opensearch.xml"><title data-react-helmet="true">Peripheral Manager | air native extensions</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.airnativeextensions.com/img/ane-icon-black.png"><meta data-react-helmet="true" property="og:url" content="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Peripheral Manager | air native extensions"><meta data-react-helmet="true" name="description" content="Acting as a Peripheral"><meta data-react-helmet="true" property="og:description" content="Acting as a Peripheral"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.airnativeextensions.com/docs/bluetoothle/peripheral-manager" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://WGX2M70X7C-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.656b5f46.css">
<link rel="preload" href="/assets/js/runtime~main.5f87a73c.js" as="script">
<link rel="preload" href="/assets/js/main.62c584d3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ane-icon-black.png" alt="AIR Native Extensions" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/ane-icon-white.png" alt="AIR Native Extensions" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">AIR Native Extensions</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/news/">News</a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF"> </span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF"> </span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/bluetoothle">BluetoothLE</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/bluetoothle/add-the-extension">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/bluetoothle/adapter-state">Usage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bluetoothle/adapter-state">Adapter State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bluetoothle/centrals-and-peripherals">Centrals and Peripherals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/bluetoothle/central-manager">Central Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/bluetoothle/peripheral-manager">Peripheral Manager</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/bluetoothle/migrating-to-androidx">Help</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/bluetoothle/changelog">Other</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Peripheral Manager</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="acting-as-a-peripheral">Acting as a Peripheral<a class="hash-link" href="#acting-as-a-peripheral" title="Direct link to heading">​</a></h2><p>In the last section, you learned how to perform the most common types of Bluetooth
low energy tasks from the central side. Here we will go through how to perform the
common Bluetooth low energy tasks from the peripheral side. The code-based examples
that follow will assist you in developing your app to implement the peripheral role
on your local device. Specifically, you will learn how to:</p><ul><li><a href="#set-up-services-and-characteristics">Set Up Services and Characteristics</a></li><li><a href="#publish-services-and-characteristics">Publish Services and Characteristics</a></li><li><a href="#advertise-services">Advertise Services</a></li><li><a href="#read-and-write-requests">Read and Write Requests</a></li><li><a href="#update-subscribed-centrals">Update Subscribed Centrals</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="set-up-services-and-characteristics">Set Up Services and Characteristics<a class="hash-link" href="#set-up-services-and-characteristics" title="Direct link to heading">​</a></h3><p>The first step is to create an array of <code>Service</code>&#x27;s, each with an array of available
<code>Characteristic</code>&#x27;s. You can consider a <code>Service</code> as a group of data values or
<code>Characteristic</code>s. Each <code>Service</code> and <code>Characteristic</code> is uniquely defined by a <code>UUID</code>.</p><p>Though not all UUIDs that identify a service or characteristic are predefined by the
Bluetooth Special Interest Group (SIG), Bluetooth SIG has defined and published a
number of commonly used UUIDs that have been shortened to 16-bits for convenience.
For example, Bluetooth SIG has predefined the 16-bit UUID that identifies a heart
rate service as 180D. This UUID is shortened from its equivalent 128-bit UUID,
0000180D-0000-1000-8000-00805F9B34FB, which is based on the Bluetooth base UUID
that is defined in the Bluetooth 4.0 specification, Volume 3, Part F, Section 3.2.1.
When you use a predefined 16-bit UUID, the extension prefills the rest of 128-bit
UUID with the Bluetooth base UUID</p><p>You may have services and characteristics that are not identified by predefined
Bluetooth UUIDs. If you do, you need to generate your own 128-bit UUIDs to identify them.</p><p>Use the command-line utility uuidgen to easily generate 128-bit UUIDs. To get started,
open a window in Terminal. Next, for each service and characteristic that you need
to identify with a UUID, type uuidgen on the command line to receive a unique 128-bit
value in the form of an ASCII string that is punctuated by hyphens,
as in the following example:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ uuidgen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">90753043-6E40-4590-AFF6-5B48F6412E2F</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can then use this UUID to create your own Service and Characteristic objects.</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = new Characteristic( &quot;E95E787B-9C88-4A8D-9A33-BA63EBC4A3A3&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var service:Service = new Service();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.uuid = &quot;90753043-6E40-4590-AFF6-5B48F6412E2F&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.characteristics.push( characteristic );</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="publish-services-and-characteristics">Publish Services and Characteristics<a class="hash-link" href="#publish-services-and-characteristics" title="Direct link to heading">​</a></h3><p>Once you have created your <code>Service</code>&#x27;s and <code>Characteristic</code>&#x27;s you will then need to
publish these services to add them to the device&#x27;s database of services and
characteristics. This task involves calling the <code>addService</code> function of the <code>peripheralManager</code>.
At this time it is also important to note the <code>removeAllServices</code> function which can
be used to ensure that you don&#x27;t add duplicate services at each launch of your application.</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = new Characteristic( &quot;E95E787B-9C88-4A8D-9A33-BA63EBC4A3A3&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var service:Service = new Service();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.uuid = &quot;90753043-6E40-4590-AFF6-5B48F6412E2F&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service.characteristics.push( characteristic );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( PeripheralManagerEvent.SERVICE_ADD, peripheral_serviceAddHandler );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( PeripheralManagerEvent.SERVICE_ADD_ERROR, peripheral_serviceAddErrorHandler );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Remove all to prevent duplicate services (this only removes services added by this application)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.removeAllServices();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addService( service );</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You will receive a success or failure event from the addService call:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_serviceAddHandler( event:PeripheralManagerEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager service added&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_serviceAddErrorHandler( event:PeripheralManagerEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager service add error&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note: After you publish a service and any of its associated characteristics to
the peripheral&#x27;s database, the service is cached and you can no longer make
changes to it.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="advertise-services">Advertise Services<a class="hash-link" href="#advertise-services" title="Direct link to heading">​</a></h3><p>When you have published your services and characteristics to your device&#x27;s database
of services and characteristics, you are ready to start advertising some of them
to any centrals that may be listening. To start advertising call the
<code>startAdvertising</code> function on the <code>peripheralManager</code>. The first parameter is a
local name to advertise for the device and the second parameter is a vector array
of <code>Service</code> objects to advertise.</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var service:Service = ...; // A previously created and published service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( PeripheralManagerEvent.START_ADVERTISING, peripheral_startAdvertisingHandler );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.startAdvertising( &quot;distriqt&quot;, new &lt;Service&gt;[ service ] );</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When you start advertising some of the data on your local peripheral, the peripheral
manager dispatches the <code>PeripheralManagerEvent.START_ADVERTISING</code> event. Advertising
behavior is also affected when your app is in the background. You must make sure you
have correctly added the application descriptor additions to have permission to
advertise when in the background.</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_startAdvertisingHandler( event:PeripheralManagerEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager start advertising&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Once you begin advertising data, remote centrals can discover and initiate a connection with you.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="read-and-write-requests">Read and Write Requests<a class="hash-link" href="#read-and-write-requests" title="Direct link to heading">​</a></h3><p>After you are connected to one or more remote centrals, you may begin receiving read
or write requests from them. When you do, be sure to respond to those requests in an
appropriate manner. The following examples describe how to handle such requests.</p><p>When a connected central requests to read the value of one of your characteristics,
the peripheral manager dispatches the <code>RequestEvent.READ</code> event. The <code>RequestEvent</code> has
a number of properties that you can use to fulfill the request.</p><p>When you receive a read request you should make sure that the characteristic in
your device&#x27;s database matches the one that the remote central specified in the
original read request. If the characteristics match the next step is to make sure
that the read request isn&#x27;t asking to read from an index position that is outside
the bounds of your characteristic&#x27;s value. If the offset is invalid you should
respond with the <code>Request.INVALID_OFFSET</code> flag as in the example below.</p><p>Assuming the request&#x27;s offset is verified you can use the <code>respondToRequest</code> function
on the <code>peripheralManager</code> to send the data to the central. You should respect the
read offset and send the <code>Request.SUCCESS</code> flag and the requested data, as in the
example below.</p><p>Firstly add a listener for read requests:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = ...; // Some characteristic you have created and added to a published service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( RequestEvent.READ, peripheral_readRequestHandler );</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then process these read requests when received:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_readRequestHandler( event:RequestEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  Read requests will only have one object in the requests event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var request:Request = event.requests[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: read request: &quot; + request.characteristic.uuid );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  Handle the read request by first checking the UUID and then responding with the requested data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  You need to make sure you correctly handle the offset variable as illustrated below</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (request.characteristic.uuid == characteristic.uuid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (request.offset &gt; characteristic.value.length)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BluetoothLE.service.peripheralManager.respondToRequest( request, Request.INVALID_OFFSET );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            characteristic.value.position = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var data:ByteArray = new ByteArray();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data.writeBytes( characteristic.value, request.offset, (characteristic.value.length - request.offset) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BluetoothLE.service.peripheralManager.respondToRequest( request, Request.SUCCESS, data );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>Note: If the characteristics&#x27; UUIDs do not match, or if the read can not be
completed for any other reason, you should not attempt to fulfill the request.
Instead, you should call the <code>respondToRequest</code> function immediately with the
appropriate result flag from the <code>Request</code> class.</p></blockquote><p>Handling write requests from a connected central is also straightforward.
When a connected central sends a request to write the value of one or more
of your characteristics, the peripheral manager dispatches the
<code>RequestEvent.WRITE</code> event. With a write event the event may contain more
than one requests and you must process each request and call
<code>respondToRequest</code> <strong>only once</strong>. Be sure to take into account the request&#x27;s
offset property when writing the value of your characteristic</p><p>Add the write request listener:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = ...; // Some characteristic you have created and added to a published service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( RequestEvent.WRITE, peripheral_writeRequestHandler );</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then handle the request:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_writeRequestHandler( event:RequestEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: write request: &quot; + event.requests.length );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  Write requests may have several requests and you should process each one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  before calling respondToRequest. You only need to call respondToRequest once</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //  with the first request in the array</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for each (var request:Request in event.requests)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        trace( &quot;peripheral manager: write request: &quot; + request.characteristic.uuid +&quot; :: [&quot; + request.offset +&quot;] &quot;+ request.value.readUTFBytes( request.value.length ) );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (request.characteristic.uuid == characteristic.uuid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (request.offset + request.value.length &gt; MAX_VALUE_LENGTH)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                BluetoothLE.service.peripheralManager.respondToRequest( request, Request.INVALID_OFFSET );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (characteristic.value == null) characteristic.value = new ByteArray();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                characteristic.value.position = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                characteristic.value.writeBytes( request.value, request.offset );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BluetoothLE.service.peripheralManager.respondToRequest( event.requests[0], Request.SUCCESS );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p>You need to call <code>respondToRequest</code> <strong>exactly once</strong> per dispatched <code>RequestEvent</code>
no matter how many requests the event contains.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="update-subscribed-centrals">Update Subscribed Centrals<a class="hash-link" href="#update-subscribed-centrals" title="Direct link to heading">​</a></h3><p>Often, connected centrals will subscribe to one or more of your characteristic
values. When they do, you are responsible for sending them notifications when
the value of characteristic they subscribed to changes.</p><p>When a connected central subscribes to the value of one of your characteristics,
the peripheral manager dispatches the <code>CentralEvent.SUBSCRIBE</code> event and
similarly the <code>CentralEvent.UNSUBSCRIBE</code> when the central unsubscribes.
You should use these events as a cue to start/stop sending the updated values
to centrals.</p><p>Make sure you are listening for the events:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">var characteristic:Characteristic = ...; // Some characteristic you have created and added to a published service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( CentralEvent.SUBSCRIBE, peripheral_central_subscribeHandler );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BluetoothLE.service.peripheralManager.addEventListener( CentralEvent.UNSUBSCRIBE, peripheral_central_unsubscribeHandler );</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then process the subscription and unsubscription:</p><div class="codeBlockContainer_I0IT language-actionscript theme-code-block"><div class="codeBlockContent_wNvx actionscript"><pre tabindex="0" class="prism-code language-actionscript codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_central_subscribeHandler( event:CentralEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: central subscribe: &quot; + event.central.uuid  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // You should use this to track whether you should be periodically sending updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // For the moment we&#x27;ll just show as an example sending an update immediately</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var value:ByteArray = new ByteArray();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value.writeUTFBytes( &quot;some_updated_value&quot; );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BluetoothLE.service.peripheralManager.updateValue( characteristic, value );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private function peripheral_central_unsubscribeHandler( event:CentralEvent ):void</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    trace( &quot;peripheral manager: central unsubscribe: &quot; + event.central.uuid  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // If there are no other centrals subscribed you can stop periodically sending updates</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>updateValue</code> function returns a Boolean value that indicates whether
the update was successfully sent to the subscribed centrals. If the underlying
queue that is used to transmit the updated value is full, the method returns
<code>false</code> and you should wait and try again later.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/bluetoothle/central-manager"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Central Manager</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/bluetoothle/migrating-to-androidx"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrating to AndroidX</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#acting-as-a-peripheral" class="table-of-contents__link toc-highlight">Acting as a Peripheral</a><ul><li><a href="#set-up-services-and-characteristics" class="table-of-contents__link toc-highlight">Set Up Services and Characteristics</a></li><li><a href="#publish-services-and-characteristics" class="table-of-contents__link toc-highlight">Publish Services and Characteristics</a></li><li><a href="#advertise-services" class="table-of-contents__link toc-highlight">Advertise Services</a></li><li><a href="#read-and-write-requests" class="table-of-contents__link toc-highlight">Read and Write Requests</a></li><li><a href="#update-subscribed-centrals" class="table-of-contents__link toc-highlight">Update Subscribed Centrals</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/tutorials/">tutorials</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/Gamua/Adobe-Runtime-Support/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>AIR discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://forum.starling-framework.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>starling<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/distriqt" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>stack overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/news">news</a></li><li class="footer__item"><a href="https://airnativeextensions.com/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://airnativeextensions.com/license" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>license<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><br><a href="https://airnativeextensions.com">airnativeextensions.com</a> copyright © 2022 <br><br><a href="https://distriqt.com"><img src="/img/logo.png" alt="distriqt"></a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.5f87a73c.js"></script>
<script src="/assets/js/main.62c584d3.js"></script>
</body>
</html>