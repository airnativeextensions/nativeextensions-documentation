(window.webpackJsonp=window.webpackJsonp||[]).push([[706],{761:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return p}));var i=t(2),r=t(6),a=(t(0),t(869)),o={title:"iOS Signing",sidebar_label:"iOS Signing"},c={unversionedId:"facebookapi/signing",id:"facebookapi/signing",isDocsHomePage:!1,title:"iOS Signing",description:"In some circumstances the AIR SDK doesn't correctly sign all the packaged frameworks in an application.",source:"@site/docs/facebookapi/signing.md",slug:"/facebookapi/signing",permalink:"/docs/facebookapi/signing",version:"current",sidebar_label:"iOS Signing",sidebar:"facebookapi",previous:{title:"Friend Finder Dialog",permalink:"/docs/facebookapi/gamingservices/friend-finder-dialog"},next:{title:"Migrating to Version 9",permalink:"/docs/facebookapi/migrating-to-version-9"}},s=[{value:"Cause",id:"cause",children:[]},{value:"Resign Script",id:"resign-script",children:[]}],l={rightToc:s};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(i.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("p",null,"In some circumstances the AIR SDK doesn't correctly sign all the packaged frameworks in an application. "),Object(a.b)("p",null,"This will result in an error when attempting an AppStore submission and installing development builds will fail with a signature validation error. Something like:"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),'ERROR: Install failed. Got error "ApplicationVerificationFailed" with code 0xe8008001: Failed to verify code signature of\n')),Object(a.b)("p",null,"To get around this, before you upload or install your application you will need to run a script to resign your IPA. This script is available below."),Object(a.b)("div",{className:"admonition admonition-info alert alert--info"},Object(a.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(a.b)("h5",{parentName:"div"},Object(a.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(a.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(a.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(a.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(a.b)("p",{parentName:"div"},"This script will only work on a macOS machine with Xcode installed and your certificate installed in Keychain"))),Object(a.b)("p",null,"Copy this script to a directory in your development environment."),Object(a.b)("p",null,"Firstly edit the script to change the details of the IPA, provisioning profile and signing identity for your application. These details are located at the top of the script."),Object(a.b)("p",null,"Now open a Terminal at the script location. ",Object(a.b)("em",{parentName:"p"},"You will need to run the script from this directory.")),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),"./resign\n")),Object(a.b)("p",null,"This should output a few informational items to the console and then once complete you should have a new IPA file in the directory named: ",Object(a.b)("inlineCode",{parentName:"p"},"yourApp_resigned.ipa"),". If there were any errors or warnings displayed, make sure the information above is all correct."),Object(a.b)("p",null,"This resigned IPA is the file you should use."),Object(a.b)("h2",{id:"cause"},"Cause"),Object(a.b)("p",null,"The cause of this issue has been long standing and we have been in discussions about it with the AIR developers (Adobe and now Harman) for a long time: "),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"https://tracker.adobe.com/#/view/AIR-4198407"}),"https://tracker.adobe.com/#/view/AIR-4198407"))),Object(a.b)("p",null,"Please help us in getting attention to the issue by voting for it here:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/Gamua/Adobe-Runtime-Support/issues/521"}),"https://github.com/Gamua/Adobe-Runtime-Support/issues/521"))),Object(a.b)("h2",{id:"resign-script"},"Resign Script"),Object(a.b)("pre",null,Object(a.b)("code",Object(i.a)({parentName:"pre"},{}),'#!/bin/bash\n\n#####################################\n## CONFIG\n\n# You need to set the values below for your application\n# We suggest they are full paths to the files. \n\n# The path to the ipa generated from your AIR application packaging\nIPA="/path/to/yourApp.ipa"\n\n# The provisioning profile for your application\nPROVISIONING_PROFILE="/path/to/profile.mobileprovision"\n\n# The name of the signing identity. You get this by running the following in a terminal \n# and selecting the name of your certificate:\n# \n# security find-identity -v -p codesigning\nSIGNING_IDENTITY="iPhone Distribution: XXXXXXXXX (XXXXX)"\n\n## END CONFIG\n#####################################\n\n\n\n\nOUTPUT=.\nWORKING_DIR=.tmp\nWORKING_PROFILE="profile.mobileprovision"\nIPA_NAME=$(basename ${IPA%.*})\n\ncp -f "$PROVISIONING_PROFILE" "$WORKING_PROFILE"\n\nrm -rf "$WORKING_DIR"\nunzip -qq -o $IPA -d $WORKING_DIR\nfind . -iname \'$WORKING_DIR/*.DS_Store\' -delete \n\nrm -rf "$WORKING_DIR/Payload/$APP_NAME/_CodeSignature/"\nrm -f "$WORKING_DIR/Payload/$APP_NAME/embedded.mobileprovision"\n\nAPP_NAME=$(ls -1 $WORKING_DIR/Payload)\n\n\n#####################################\necho "Create Signing Entitlements"\nENTITLEMENTS="$OUTPUT/Entitlements.plist"\nrm -f "$ENTITLEMENTS" \nWORKING_PROFILE_PLIST="$OUTPUT/$WORKING_PROFILE.plist"\nsecurity cms -D -i "$WORKING_PROFILE" > "$WORKING_PROFILE_PLIST"\n\n\nTEAM_IDENTIFIER=$(/usr/libexec/Plistbuddy -c "Print :TeamIdentifier:0" "$WORKING_PROFILE_PLIST")\nAPPLICATION_IDENTIFIER_PREFIX=$(/usr/libexec/Plistbuddy -c "Print :ApplicationIdentifierPrefix:0" "$WORKING_PROFILE_PLIST")\nBUNDLE_IDENTIFIER=$(/usr/libexec/Plistbuddy -c "Print :CFBundleIdentifier" "$WORKING_DIR/Payload/$APP_NAME/Info.plist")\nAPS_ENVIRONMENT=$(/usr/libexec/Plistbuddy -c "Print Entitlements:aps-environment" "$WORKING_PROFILE_PLIST")\nBETA_REPORTS=$(/usr/libexec/Plistbuddy -c "Print Entitlements:beta-reports-active" "$WORKING_PROFILE_PLIST")\nPROVISIONING_GET_TASK_ALLOW=$(/usr/libexec/Plistbuddy -c "Print :Entitlements:get-task-allow" "$WORKING_PROFILE_PLIST")\n \necho "  APP_NAME = $APP_NAME"\necho "  TEAM_IDENTIFIER = $TEAM_IDENTIFIER"\necho "  APPLICATION_IDENTIFIER_PREFIX = $APPLICATION_IDENTIFIER_PREFIX"\necho "  BUNDLE_IDENTIFIER = $BUNDLE_IDENTIFIER"\necho "  APS_ENVIRONMENT = $APS_ENVIRONMENT"\necho "  BETA_REPORTS = $BETA_REPORTS"\necho "  PROVISIONING_GET_TASK_ALLOW = $PROVISIONING_GET_TASK_ALLOW"\n\n\n/usr/libexec/PlistBuddy -c "Add :application-identifier string $APPLICATION_IDENTIFIER_PREFIX.$BUNDLE_IDENTIFIER" "$ENTITLEMENTS"\n/usr/libexec/PlistBuddy -c "Add :get-task-allow bool $PROVISIONING_GET_TASK_ALLOW" "$ENTITLEMENTS"\n/usr/libexec/PlistBuddy -c "Add :keychain-access-groups array" "$ENTITLEMENTS"\n/usr/libexec/PlistBuddy -c "Add :keychain-access-groups:0 string $APPLICATION_IDENTIFIER_PREFIX.$BUNDLE_IDENTIFIER" "$ENTITLEMENTS"\nif [ $APS_ENVIRONMENT ]; then\n    echo "Setting aps-environment=$APS_ENVIRONMENT" \n    /usr/libexec/PlistBuddy -c "Add :aps-environment string $APS_ENVIRONMENT" "$ENTITLEMENTS"\nfi\nif [ $BETA_REPORTS ]; then\n    echo "Setting beta-reports-active=$BETA_REPORTS" \n    /usr/libexec/PlistBuddy -c "Add :beta-reports-active bool $BETA_REPORTS" "$ENTITLEMENTS"\nfi\n\n# Apple Sign-In\n#/usr/libexec/PlistBuddy -c "Add :com.apple.developer.applesignin array" "$ENTITLEMENTS"\n#/usr/libexec/PlistBuddy -c "Add :com.apple.developer.applesignin:0 string Default" "$ENTITLEMENTS"\n\ncp "$ENTITLEMENTS" "$WORKING_DIR/Payload/$APP_NAME/archived-expanded-entitlements.xcent"\n\n#####################################\necho "Sign Frameworks" \n\nfunction sign_framework() {\n    FRAMEWORK=$1.framework\n    if [ -d "$WORKING_DIR/Payload/$APP_NAME/Frameworks/$FRAMEWORK" ];\n    then\n        codesign --force --sign "$SIGNING_IDENTITY" --verbose "$WORKING_DIR/Payload/$APP_NAME/Frameworks/$FRAMEWORK"\n    fi\n}\n\n\nsign_framework FBSDKCoreKit\nsign_framework FBSDKLoginKit\nsign_framework FBSDKShareKit\n\n\n\n\n#####################################\necho "Sign Application"\ncodesign --force --entitlements "$ENTITLEMENTS" --sign "$SIGNING_IDENTITY" "$WORKING_DIR/Payload/$APP_NAME" --verbose\ncodesign --verify --verbose --no-strict "$WORKING_DIR/Payload/$APP_NAME"\n\nOUTPUT_IPA="$OUTPUT/"$IPA_NAME"_resigned.ipa"\ncd $WORKING_DIR\nzip -q --symlinks --recurse-paths "../.tmp_output.ipa" .\ncd ..\nmv ".tmp_output.ipa" "$OUTPUT_IPA"\n\n\n# Cleanup\nrm -Rf "$WORKING_DIR"\nrm -f "$ENTITLEMENTS" \nrm -f "$WORKING_PROFILE_PLIST"\nrm -f "$WORKING_PROFILE"\n')))}p.isMDXComponent=!0},869:function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"b",(function(){return b}));var i=t(0),r=t.n(i);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function c(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),p=function(e){var n=r.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):c(c({},n),e)),t},d=function(e){var n=p(e.components);return r.a.createElement(l.Provider,{value:n},e.children)},I={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},u=r.a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(t),u=i,b=d["".concat(o,".").concat(u)]||d[u]||I[u]||a;return t?r.a.createElement(b,c(c({ref:n},l),{},{components:t})):r.a.createElement(b,c({ref:n},l))}));function b(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=u;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c.mdxType="string"==typeof e?e:i,o[1]=c;for(var l=2;l<a;l++)o[l]=t[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,t)}u.displayName="MDXCreateElement"}}]);